<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/image/site/favicon/favicon-16x16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="/image/site/favicon/favicon-32x32.png?v=2.6.2" type="image/png" sizes="32x32"><link rel="apple-touch-icon" href="/image/site/favicon/favicon-180x180.png?v=2.6.2" sizes="180x180"><meta property="og:type" content="website">
<meta property="og:title" content="LonelyTaker&#39;s Blog">
<meta property="og:url" content="https://lonelytaker.cn/index.html">
<meta property="og:site_name" content="LonelyTaker&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="LonelyTaker">
<meta property="article:tag" content="个人博客">
<meta name="twitter:card" content="summary"><title>LonelyTaker's Blog</title><link ref="canonical" href="https://lonelytaker.cn/index.html"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":false,"scrollDownIcon":true},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"复制","copySuccess":"复制成功","copyError":"复制失败"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 6.0.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">归档</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">分类</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">标签</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">LonelyTaker's Blog</div><div class="header-banner-info__subtitle">走好自己的路，迈好自己的步</div></div><div class="header-banner-arrow"><div class="header-banner-arrow__icon"><i class="fas fa-angle-down"></i></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content content-home" id="content"><section class="postlist"><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2022/02/21/%E6%9D%82%E4%B8%83%E6%9D%82%E5%85%AB/">杂七杂八</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2022-02-21</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2022-02-21</span></span></div></header><div class="post-body"><div class="post-excerpt"><p><strong>伪类和伪元素</strong></p>
<p>伪类用 <strong>”:“</strong> 标识，表示一些状态，比如:hover，:focus</p>
<p>伪元素用 <strong>”::“</strong> 标识，表示某元素的子元素，该元素仅逻辑上存在，但不存在DOM树中，比如::before</p>
<hr>
<p><strong>表单验证</strong></p>
<ul>
<li>表单的一些新特性：</li>
</ul>
<ol>
<li><p>HTML5表单中新增类型：</p>
<p>email、url、number、range、date、color、list等</p>
</li>
<li><p>文本框中输入一次，下一次输入会自动提示的特性：autocomplete</p>
</li>
<li><p>初始化页面后，input自动获得焦点：autofocus</p>
</li>
<li><p>表单元素必填：required</p>
</li>
<li><p>表单验证使用正则：pattern</p>
</li>
<li><p>表单中设置了必填，但是提交的时候不验证：novalidate或者formnovalidate，前者在form标签上应用，后者在提交按钮上应用</p>
</li>
</ol>
<ul>
<li><p>约束验证API</p>
<ol>
<li>willValidate属性</li>
<li>validity属性</li>
<li>validationMessage属性</li>
<li>checkValidity()方法</li>
<li>setCustomValidity()方法</li>
</ol>
</li>
<li><p>美化验证</p>
<p>几种常用的伪类：</p>
<ol>
<li>:required和:optional</li>
<li>:in-range和:out-of-range</li>
<li>:valid和:invalid</li>
<li>:read-only和:read-write</li>
</ol>
</li>
</ul>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2022/02/21/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/">浏览器工作原理</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2022-02-21</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2022-02-21</span></span></div></header><div class="post-body"><div class="post-excerpt"><p><strong>进程是资源分配的最小单位，线程是CPU调度的最小单位</strong></p>
<p>早期浏览器是单进程的，单进程导致了许多问题</p>
<ol>
<li><p>不稳定</p>
<p>一个页面卡死会导致整个浏览器不能正常使用</p>
</li>
<li><p>不安全</p>
<p>浏览器之间共享数据</p>
</li>
<li><p>不流畅</p>
<p>一个进程负责太多的事情，效率低</p>
</li>
</ol>
<p>故现在的浏览器采用了<strong>多进程</strong>结构：</p>
<ul>
<li><p>Browser进程（控制进程）</p>
<p>控制浏览器除标签页外的用户界面，包括地址栏、书签、后退和前进按钮，以及负责和浏览器的其他进程协调工作</p>
</li>
<li><p>GPU进程</p>
<p>负责整个浏览器界面的渲染</p>
</li>
<li><p>插件进程</p>
<p>控制网站所使用的所有插件，如Flash</p>
</li>
<li><p>Render进程（渲染器进程）</p>
<p>控制显示tab标签页内的所有内容，浏览器在默认情况下会为每个标签页创建一个进程（<strong>可能</strong>，取决于浏览器选择的进程模型）</p>
<p><strong>渲染器进程是多线程</strong>的：</p>
<ul>
<li>JS引擎线程</li>
<li>GUI渲染线程</li>
<li>事件触发线程</li>
<li>定时触发器线程</li>
<li>异步http请求线程</li>
<li>…</li>
</ul>
</li>
<li><p>…</p>
</li>
</ul>
<hr>
<p>当你在地址输入框输入网址后，会发生什么事情？（以谷歌浏览器为例）</p>
<ol>
<li><p><strong>浏览器进程</strong>的<strong>UI线程</strong>会捕捉输入内容</p>
<p>如果访问的是网址，则UI线程会启动一个<strong>网络线程</strong>请求DNS进行域名解析，接着开始连接服务器获取数据</p>
<p>如果输入的不是网址而是关键词，就会使用默认配置的搜索引擎来查询</p>
</li>
<li><p>当网络线程获取到数据后，会通过<strong>SafeBrowsing</strong>检查站点是否是恶意站点（SafeBrowsing是谷歌内部的一套站点安全系统，通过检测该站点的数据来判断是否安全）</p>
</li>
<li><p>当<strong>网络线程</strong>获取到的数据准备完毕，并通过安全校验时，<strong>UI线程</strong>会启动一个<strong>渲染器进程</strong></p>
</li>
<li><p>浏览器进程通过<strong>IPC管道</strong>将数据（html）传递给<strong>渲染器进程</strong>，正式进入渲染流程</p>
</li>
<li><p>渲染器进程的核心任务就是把html、css、js、image等资源渲染成用户能交互的web页面</p>
</li>
<li><p><strong>渲染器的主线程</strong>将html进行解析，<strong>构造DOM数据结构</strong>，html首先通过<strong>Tokeniser标记化</strong>，通过语法分析将html内容解析成多个标记，根据识别后的标记进行<strong>DOM树构造</strong>，DOM树构造过程中会创建<strong>document对象</strong>，然后以document为<strong>根节点</strong>的DOM树不断进行修改，向其中添加各种元素</p>
<p>html中引入的其他资源，如图片、css、js脚本等，图片和CSS等需要通过<strong>网络下载或者从缓存中</strong>直接加载，这些资源不会阻塞html的解析，因为它们不会影响DOM的生成，但如果解析过程中遇到script标签，就会暂停解析，<strong>先去加载解析并执行js脚本</strong>，因为js中可能会改变当前页面html结构</p>
</li>
<li><p>DOM树创建完成后，主线程需要解析CSS并确定每个DOM节点的<strong>计算样式</strong>（即使你没有自定义样式，浏览器也会有自己默认的样式表），然后进行<strong>Layout布局</strong>，主线程通过遍历dom和计算好的样式来生成<strong>Layout树</strong></p>
<p>注意：DOM树和Layout树并不是一一对应的，如设置了display:none的元素不会出现在Layout树中，而在before伪类中添加了content值的元素，content中的内容会出现在Layout树中，不会出现在DOM树中。这是因为DOM树是根据解析html所得，并不关心样式。而Layout树是根据DOM和计算好的样式来生成，和最终展示在页面上的节点是对应的</p>
</li>
<li><p>为了在页面上正确显示层级，主线程遍历Layout树，创建一个<strong>绘制记录表</strong>，该表记录绘制的顺序，这个阶段称为<strong>绘制(Paint)</strong></p>
</li>
<li><p>主线程遍历Layout树，生成<strong>Layer(图层)树</strong></p>
</li>
<li><p>当Layer树生成完毕和绘制顺序确认后，主线程将这些信息传递给<strong>合成器线程</strong>，合成器线程将每个图层<strong>栅格化(光栅化)<strong>，由于一层可能像页面的整个长度一样大，因此合成器线程将他们切分为许多图块(tiles)，然后将每个图块发送给</strong>栅格线程</strong>，栅格线程栅格化每个图块，并将它们存储在GPU内存中，当栅格化完成后，合成器线程将收集称为<strong>Draw Quads</strong>的图块信息，并根据图块信息生成<strong>合成器帧</strong></p>
<p>早期的栅格化方案：只栅格化页面显示的内容，当页面滚动时，再栅格化更多的内容来填充缺失的部分，这种方式会导致展示延迟</p>
<p>现在的Chrome采用更为复杂的栅格化方案，称为<strong>合成</strong>：将页面内的各个部分分成多个图层，分别对其进行栅格化，并在合成器线程中单独合成页面。上述操作即采用该方案</p>
</li>
<li><p>合成器帧通过IPC传送给<strong>浏览器进程</strong>，接着浏览器进程将合成器帧传送到<strong>GPU</strong>，最终渲染展示到屏幕上</p>
<p>当页面发生变化，如滚动，则会生成一个新的合成器帧，再重复上述操作</p>
<p>当改变一个元素的尺寸位置属性时，会重新进行样式计算、布局(Layout)、绘制(Paint)以及后面的所有流程，这个行为称为<strong>重排</strong></p>
<p>当改变某个元素的颜色属性时，不会重新触发布局(Layout)，但还是会触发样式计算和绘制，这个称为<strong>重绘</strong></p>
<p>注意：重绘和重排都会占用主线程，同时js也在主线程运行，那么就会出现抢占执行时间的问题</p>
</li>
</ol>
<blockquote>
<p>参考资料：</p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://blog.csdn.net/BonJean/article/details/78453547">https://blog.csdn.net/BonJean/article/details/78453547</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1x54y1B7RE">https://www.bilibili.com/video/BV1x54y1B7RE</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/47407398">https://zhuanlan.zhihu.com/p/47407398</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</blockquote>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2022/02/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/">计算机网络</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2022-02-21</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2022-02-21</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="一-计算机网络概述">
          <a href="#一-计算机网络概述" class="heading-link"><i class="fas fa-link"></i></a><a href="#一-计算机网络概述" class="headerlink" title="一.计算机网络概述"></a>一.计算机网络概述</h1>
      
        <h2 id="1-计算机网络基本概念">
          <a href="#1-计算机网络基本概念" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-计算机网络基本概念" class="headerlink" title="1.计算机网络基本概念"></a>1.计算机网络基本概念</h2>
      <p>计算机网络是<strong>互连</strong>的、<strong>自治</strong>的计算机的集合</p>
<ul>
<li><p><strong>协议</strong></p>
<p>协议是网络通信实体之间在数据交换过程中需要遵循的规则或约定，包括三个基本要素：</p>
<p>语法、语义、时序</p>
</li>
<li><p><strong>功能</strong></p>
<ul>
<li>硬件资源共享</li>
<li>软件资源共享</li>
<li>信息资源共享</li>
</ul>
</li>
<li><p><strong>分类</strong></p>
<ul>
<li><p>按照覆盖范围：个域网、局域网、城域网、广域网</p>
</li>
<li><p>按照拓扑结构：星形、总线型、环形、网状、树形、混合拓扑结构</p>
</li>
<li><p>按照交换方式：电路交换网络、报文交换网络、分组交换网络</p>
</li>
<li><p>按照网络用户属性：公用网、私有网</p>
</li>
</ul>
</li>
</ul>

        <h2 id="2-计算机网络结构">
          <a href="#2-计算机网络结构" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-计算机网络结构" class="headerlink" title="2.计算机网络结构"></a>2.计算机网络结构</h2>
      <ul>
<li><p><strong>网络边缘</strong></p>
</li>
<li><p><strong>接入网络</strong></p>
<ul>
<li>电话拨号</li>
<li>非对称用户数字线ADSL</li>
<li>混合光纤同轴电缆HFC</li>
<li>局域网</li>
<li>移动接入网络</li>
</ul>
</li>
<li><p><strong>网络核心</strong></p>
<p>网络核心是由通信链路互连的分组交换设备构成的网络。作用是实现网络边缘中主机之间的数据中继和转发</p>
</li>
</ul>

        <h2 id="3-数据交换技术">
          <a href="#3-数据交换技术" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-数据交换技术" class="headerlink" title="3.数据交换技术"></a>3.数据交换技术</h2>
      <ul>
<li><p><strong>电路交换</strong></p>
<p>首先需要通过中间交换结点为两台主机之间建立一条专用的通信线路，称为电路，然后再利用该电路进行通信，通信结束后再拆除电路。</p>
<ul>
<li><p>优点：</p>
<p><strong>实时性高</strong>，时延和时延抖动都较少</p>
</li>
<li><p>缺点：</p>
<p>对于突发性数据传输，<strong>信道利用率低</strong>，传输速率单一</p>
</li>
</ul>
</li>
<li><p><strong>报文交换</strong></p>
<p>以报文为单位在交换网络各结点之间以<strong>存储-转发</strong>的方式传送</p>
<ul>
<li><p>优点：</p>
<p><strong>不需要建立连接</strong>；只有当报文被转发时才占用相应的信道</p>
</li>
<li><p>缺点：</p>
<p>报文都需要缓冲存储，报文需要排队，<strong>增加了延时</strong></p>
</li>
</ul>
</li>
<li><p><strong>分组交换</strong></p>
<p>分组交换将一个完整报文拆分成若干个分组，分组传输过程通常也需要采用<strong>存储-转发</strong>交换方式</p>
<ul>
<li><p>优点：</p>
<p>交换设备<strong>存储容量要求低</strong></p>
<p>交换<strong>速度快</strong></p>
<p>可靠传输<strong>效率高</strong></p>
<p>更加<strong>公平</strong></p>
</li>
<li><p>分组长度确定：</p>
<p>分组长度与<strong>延迟时间</strong></p>
<p>分组长度与<strong>误码率</strong></p>
</li>
</ul>
</li>
</ul>

        <h2 id="4-网络性能">
          <a href="#4-网络性能" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-网络性能" class="headerlink" title="4.网络性能"></a>4.网络性能</h2>
      <ul>
<li><p><strong>速率和带宽</strong></p>
<p><strong>速率</strong>：指网络单位时间内传送的数据量，也称为数据传输速率或数据速率。基本单位是bit/s（位每秒）</p>
<p><strong>带宽</strong>：原本是指信号具有的频带宽度，即信号成分的最高频率和最低频率之差，单位是Hz（赫兹）</p>
</li>
<li><p><strong>时延</strong></p>
<p>时延是指数据从网络的一个结点(主机或交换设备等)到达另一结点所需要的时间</p>
<p>分组的每跳传输过程主要产生4类时间延迟：</p>
<ul>
<li>节点处处理时延</li>
<li>排队时延</li>
<li>传输时延</li>
<li>传播时延</li>
</ul>
</li>
<li><p><strong>时延带宽积</strong></p>
<p>一段物理链路的传播时延与链路带宽的乘积</p>
<p>表示一段链路可以容纳的数据位数，也称为以位为单位的链路长度</p>
</li>
<li><p><strong>丢包率</strong></p>
<p>丢包率常被用于评价和衡量网络性能的指标，在很大程度上可以反应网络的<strong>拥塞程度</strong></p>
<p>丢包率 = 丢失分组总数 / 发送分组总数</p>
</li>
<li><p><strong>吞吐量</strong></p>
<p>单位时间内源主机通过网络向目的主机实际送达的数据量</p>
</li>
</ul>

        <h2 id="5-计算机网络体系结构">
          <a href="#5-计算机网络体系结构" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-计算机网络体系结构" class="headerlink" title="5.计算机网络体系结构"></a>5.计算机网络体系结构</h2>
      <p><strong>分层思想</strong></p>
<ul>
<li><p><strong>OSI参考模型</strong></p>
<p>物理层、数据链路层、网络层、传输层、会话层、展示层、应用层（从下而上）</p>
</li>
<li><p><strong>TCP/IP参考模型</strong></p>
<p>网络接口层、网际层、运输层、应用层</p>
</li>
<li><p><strong>五层参考模型</strong></p>
<p>物理层、链路层、网络层、传输层、应用层</p>
</li>
</ul>
<p><strong>单位</strong></p>
<p>比特流（物理层）</p>
<p>帧（链路层）</p>
<p>数据报（网络层）</p>
<p>段（传输层）</p>
<p>报文（应用层）</p>

        <h1 id="二-网络应用">
          <a href="#二-网络应用" class="heading-link"><i class="fas fa-link"></i></a><a href="#二-网络应用" class="headerlink" title="二.网络应用"></a>二.网络应用</h1>
      
        <h2 id="1-计算机网络应用体系结构">
          <a href="#1-计算机网络应用体系结构" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-计算机网络应用体系结构" class="headerlink" title="1.计算机网络应用体系结构"></a>1.计算机网络应用体系结构</h2>
      <ul>
<li><p><strong>客户/服务器（C/S）结构</strong></p>
<p>最主要的特征是通信只在客户与服务器之间进行，客户与客户之间不进行直接通信。</p>
</li>
<li><p><strong>P2P（Peer to Peer）结构</strong></p>
<p>每个对等端都同时具备C/S应用的客户与服务器的特征，是一个服务器和客户的结合体，对等端之间可以直接通信。</p>
</li>
<li><p><strong>混合结构</strong></p>
<p>既有中心服务器的存在，又有对等端（客户）间的直接通信。</p>
</li>
</ul>

        <h2 id="2-网络应用通信基本原理">
          <a href="#2-网络应用通信基本原理" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-网络应用通信基本原理" class="headerlink" title="2.网络应用通信基本原理"></a>2.网络应用通信基本原理</h2>
      <p><strong>C/S通信基本原理</strong></p>
<p>​    服务端运行的是服务器进程，被动地等待客户请求服务。</p>
<p>​    客户端运行的是客户进程，主动发起通信，请求服务器进程提供服务。</p>
<p>​    应用进程间遵循<strong>应用层协议</strong>交换应用层报文</p>

        <h2 id="3-域名系统（DNS）">
          <a href="#3-域名系统（DNS）" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-域名系统（DNS）" class="headerlink" title="3.域名系统（DNS）"></a>3.域名系统（DNS）</h2>
      <p><strong>（1）层次化域名空间</strong></p>
<p>层次树状结构的命名方法：</p>
<ol>
<li>国家顶级域名nTLD</li>
<li>通用顶级域名gTLD</li>
<li>接触结构域名</li>
</ol>
<p><strong>（2）域名服务器</strong></p>
<p><strong>域名解析：</strong>将域名映射为IP地址的过程</p>
<p><strong>域名服务器：</strong>为了实现域名解析，需要建立分布式数据库，存储网络中域名与IP地址的映射关系数据，这些数据库存储在域名服务器上，域名服务器根据用户的请求提供域名解析服务</p>
<p><strong>（3）域名服务器分类</strong></p>
<ul>
<li>根域名服务器</li>
<li>顶级域名服务器</li>
<li>权限域名服务器</li>
<li>本地域名服务器</li>
</ul>
<p><strong>（4）域名解析过程</strong></p>
<ul>
<li><p><strong>递归查询</strong></p>
<p>代替查询主机或者其他域名服务器，进行进一步的域名查询，并将最终解析结果发送给查询主机或服务器</p>
</li>
<li><p><strong>迭代查询</strong></p>
<p>只是将下一步要查询的服务器告知给主机或服务器</p>
</li>
</ul>

        <h2 id="4-万维网应用">
          <a href="#4-万维网应用" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-万维网应用" class="headerlink" title="4.万维网应用"></a>4.万维网应用</h2>
      <p><strong>（1）应用结构</strong></p>
<p>​        Web服务器、浏览器、超文本传输协议（HTTP）</p>
<p><strong>（2）HTTP</strong></p>
<ul>
<li>概念：超文本传输协议，定义浏览器如何向Web服务器发送请求以及Web服务器如何向浏览器进行响应</li>
<li>版本：HTTP/1.0 和 HTTP/1.1</li>
<li>连接：非持久连接，持久连接</li>
</ul>
<p>​        <strong>非持久连接：</strong></p>
<p>​            两种方式：</p>
<p>​                串行方式请求每个对象，且每次都要新建立TCP连接</p>
<p>​                并行方式请求每个对象，每个请求建立一个TCP连接</p>
<p>​        <strong>持久连接：</strong>建立一个TCP连接，传输多个对象</p>
<p>​            两种方式：</p>
<p>​                非流水方式</p>
<p>​                流水方式</p>
<ul>
<li><p>HTTP报文：</p>
<p>请求报文——客户向服务器发送请求报文</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">请求行	  [方法][ ][URL][ ][版本][CRLF]</span><br><span class="line">		[首部行字段名][:][ ][值][CRLF]</span><br><span class="line">		...</span><br><span class="line">        [首部行字段名][:][ ][值][CRLF]</span><br><span class="line">		[CRLF]</span><br><span class="line">		[实体主体]</span><br></pre></td></tr></table></div></figure>

<p>响应报文——从服务器到客户的回答</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">状态行	  [版本][ ][状态码][ ][短语][CRLF]</span><br><span class="line">		[首部行字段名][:][ ][值][CRLF]</span><br><span class="line">		...</span><br><span class="line">		[首部行字段名][:][ ][值][CRLF]</span><br><span class="line">		[CRLF]</span><br><span class="line">		[实体主体]</span><br></pre></td></tr></table></div></figure>

<p>HTTP状态码分类</p>
<div class="table-container"><table>
<thead>
<tr>
<th align="left">状态码</th>
<th>作用</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1XX</td>
<td>信息提示</td>
<td>通告信息，可能还需要进一步交互</td>
</tr>
<tr>
<td align="left">2XX</td>
<td>成功</td>
<td>成功完成客户请求的操作，并进行响应</td>
</tr>
<tr>
<td align="left">3XX</td>
<td>重定向</td>
<td>表示资源已移走，需要向新URL发请求</td>
</tr>
<tr>
<td align="left">4XX</td>
<td>客户端错误</td>
<td>由于客户端请求错误，无法成功响应</td>
</tr>
<tr>
<td align="left">5XX</td>
<td>服务器端错误</td>
<td>由于服务器端错误，无法成功响应</td>
</tr>
</tbody></table></div>
</li>
</ul>
<p><strong>（3）Cookie</strong></p>
<p>​        小型文本文件，指某些网站为了辨别用户身份、进行会话跟踪而存储在用户本地终端上的数据</p>
<p>​        弥补了HTTP协议无状态性的不足，有利于进行用户跟踪并提供针对性的服务，但也会带来一些安全问题</p>

        <h2 id="5-电子邮件">
          <a href="#5-电子邮件" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-电子邮件" class="headerlink" title="5.电子邮件"></a>5.电子邮件</h2>
      <p>电子邮件系统主要包括：</p>
<ul>
<li>邮件服务器</li>
<li>简单邮件传输协议（SMTP）</li>
<li>用户代理</li>
<li>邮件读取协议</li>
</ul>

        <h2 id="6-FTP">
          <a href="#6-FTP" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-FTP" class="headerlink" title="6.FTP"></a>6.FTP</h2>
      <p>文件传送协议（FTP）：在互联网的两个主机间实现文件互传的应用层协议</p>
<p>C/S模式，采用<strong>控制连接</strong>（21端口）传输控制命令，<strong>数据连接</strong>（20端口）传输文件内容</p>

        <h2 id="7-P2P应用">
          <a href="#7-P2P应用" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-P2P应用" class="headerlink" title="7.P2P应用"></a>7.P2P应用</h2>
      <p>优势：充分聚集利用了端系统（对等方主机）的计算能力以及网络传输宽带，对服务器的依赖很小</p>

        <h1 id="三-传输层">
          <a href="#三-传输层" class="heading-link"><i class="fas fa-link"></i></a><a href="#三-传输层" class="headerlink" title="三.传输层"></a>三.传输层</h1>
      
        <h2 id="1-传输层的基本服务">
          <a href="#1-传输层的基本服务" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-传输层的基本服务" class="headerlink" title="1.传输层的基本服务"></a>1.传输层的基本服务</h2>
      <p>核心任务是为应用进程之间提供<strong>端到端</strong>的逻辑通信服务</p>
<ul>
<li><p><strong>功能：</strong></p>
<ul>
<li>传输层寻址</li>
<li>应用层报文的分段和重组</li>
<li>报文的差错检测</li>
<li>进程间的端到端可靠数据传输控制</li>
<li>面向应用层实现复用与分解</li>
<li>端到端的流量控制</li>
<li>拥塞控制</li>
</ul>
<p>传输层协议提供逻辑通信服务</p>
<p>传输层协议只需在<strong>端系统</strong>中实现</p>
<p>通信的真正端点并不是主机，而是主机中运行的<strong>应用进程</strong></p>
</li>
<li><p><strong>寻址与端口</strong></p>
<ul>
<li><p>用统一的寻址方式对应用进程进行标识——端口号</p>
</li>
<li><p>在全网范围内利用<strong>IP地址+端口号</strong>唯一标识一个通信端点（应用进程）</p>
</li>
<li><p>传输层端口号为16位整数，包含三类端口：</p>
<ul>
<li>熟知端口号，数值0~1023</li>
<li>登记端口号，数值1023~49151，为没有熟知端口号的应用程序使用。使用这个范围的端口号必须在IANA登记，防止重复</li>
<li>客户端口号或短暂端口号，数值49152~65535，留给用户进程选择短暂时使用</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>无连接服务与面向连接服务</strong></p>
<ul>
<li><p>无连接服务——数据传输之前无需与对端进行任何信息交换（握手），直接构造传输层报文段并向接收端发送</p>
<p>——<strong>UDP</strong></p>
</li>
<li><p>面向连接服务</p>
<p>在数据传输之前，需要双方交换一些控制信息，<strong>建立逻辑连接</strong>，然后再<strong>传输数据</strong>，数据传输结束后还需要再<strong>拆除连接</strong></p>
<p>——<strong>TCP</strong></p>
</li>
</ul>
</li>
</ul>

        <h2 id="2-传输层的复用与分解">
          <a href="#2-传输层的复用与分解" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-传输层的复用与分解" class="headerlink" title="2.传输层的复用与分解"></a>2.传输层的复用与分解</h2>
      <p>是传输层的一项基本功能，支持众多应用进程共用同一个传输层协议，并且能够将接收到的数据准确交付给不同的应用进程。</p>
<ul>
<li><p>无连接的多路复用与多路分解</p>
<p>UDP套接字：&lt;目的IP地址，目的端口号&gt;</p>
</li>
<li><p>面向连接的多路复用与多路分解</p>
<p>TCP套接字（标识一条TCP连接）：&lt;源IP地址，源端口号，目的IP地址，目的端口号&gt;</p>
</li>
</ul>

        <h2 id="3-停-等协议与滑动窗口协议">
          <a href="#3-停-等协议与滑动窗口协议" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-停-等协议与滑动窗口协议" class="headerlink" title="3.停-等协议与滑动窗口协议"></a>3.停-等协议与滑动窗口协议</h2>
      <p><strong>实现可靠数据传输的措施：</strong></p>
<ol>
<li><p>差错检测：利用差错编码实现数据包传输过程中的比特差错检测</p>
</li>
<li><p>确认：接收方向发送方反馈接收状态</p>
</li>
<li><p>重传：发送方重新发送接收方没有正确接收的数据</p>
</li>
<li><p>序号：确保数据按序提交</p>
</li>
<li><p>计时器：解决数据丢失问题</p>
</li>
</ol>
<p><strong>（1）停-等协议</strong></p>
<ul>
<li><p>特点：每发送一个报文后就停下来等接收方的确认</p>
</li>
<li><p>基本工作过程：</p>
<ol>
<li>发送并等待确认</li>
<li>接收并确认/否认</li>
<li>继续发送/重发</li>
</ol>
</li>
<li><p>问题：降低了信道利用率</p>
</li>
<li><p>解决方法：<strong>流水线协议</strong>或<strong>管道协议</strong>——允许发送方在没有收到确认前连续发送多个分组</p>
</li>
<li><p>流水线协议的改进：</p>
<p>增加分组序号范围</p>
<p>发送方和(或)接收方必须缓存多个分组</p>
</li>
<li><p>典型的流水线协议：滑动窗口协议</p>
</li>
</ul>
<p><strong>（2）滑动窗口协议</strong></p>
<p>两种最有代表性的滑动窗口协议：</p>
<ul>
<li>回退N步（GBN）协议</li>
<li>选择重传（SR）协议</li>
</ul>

        <h2 id="4-用户数据报协议（UDP）">
          <a href="#4-用户数据报协议（UDP）" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-用户数据报协议（UDP）" class="headerlink" title="4.用户数据报协议（UDP）"></a>4.用户数据报协议（UDP）</h2>
      <p>用户数据报协议UDP提供无连接、不可靠、数据报尽力传输服务</p>
<p><strong>（1）数据结构：</strong></p>
<img src="/2022/02/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/UDP.jpg" class>

<p><strong>（2）计算校验和：</strong></p>
<pre><code>      1. 对所有参与运算的内容（包括UDP报文段）按16位 求和
      2. 求和过程中遇到的进位都被回卷（即进位与和的最低位再加）
      3. 最后得到的和取反码
</code></pre>

        <h2 id="5-传输控制协议（TCP）">
          <a href="#5-传输控制协议（TCP）" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-传输控制协议（TCP）" class="headerlink" title="5.传输控制协议（TCP）"></a>5.传输控制协议（TCP）</h2>
      <p><strong>（1）数据结构：</strong></p>
<img src="/2022/02/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/TCP.jpg" class>

<p><strong>（2）连接管理：</strong></p>
<ul>
<li>连接建立——<strong>三次握手</strong><ol>
<li>SYN连接请求(客户端)</li>
<li>SYNACK确认(服务端)</li>
<li>ACK确认(客户端)</li>
</ol>
</li>
<li>断开连接——<strong>四次挥手</strong><ol>
<li>FIN请求(客户端)</li>
<li>ACK确认(服务端)</li>
<li>FINACK确认(服务端)</li>
<li>ACK确认(客户端)</li>
</ol>
</li>
</ul>
<p><strong>（3）可靠数据传输</strong></p>
<ol>
<li><p>TCP的可靠数据传输实现机制包括<strong>差错编码、确认、序号、重传、计时器</strong>等</p>
</li>
<li><p>基于<strong>滑动窗口协议</strong>，但是发送窗口大小动态变化</p>
<p>总结：</p>
<ol>
<li>封装TCP报文段</li>
<li>发出一个报文段后启动一个计时器</li>
<li>通过校验和发现数据差错</li>
<li>通过序号重新排序，丢弃重复的报文段</li>
<li>流量控制</li>
</ol>
</li>
</ol>
<p><strong>（4）流量控制</strong></p>
<ol>
<li><p>TCP协议利用窗口机制实现流量控制，但不是简单的滑动窗口协议</p>
</li>
<li><p>TCP连接建立时，双方都为之分配固定大小的缓冲空间；TCP的接收端只允许另一端发送其缓冲区所能接纳的数据</p>
<ol>
<li><p>接收端在给发送端发送确认段时，通告接收窗口大小</p>
</li>
<li><p>发送端在接下来发送数据段时，确保未确认段的应用层数据总量不超过接收端通告的接收窗口大小，从而确保接收端不会发生缓存溢出</p>
</li>
</ol>
</li>
</ol>
<p><strong>（5）拥塞控制</strong></p>
<ol>
<li><p>窗口机制</p>
<p>通过调节窗口的大小实现对发送数据速率的调整</p>
</li>
<li><p>窗口调整的基本策略</p>
<p><strong>AIMD（加性增加，乘性减小）</strong></p>
<p>网络未发生拥塞时，逐渐“加性”增大窗口大小，当网络拥塞时“乘性”快速减少窗口大小</p>
</li>
<li><p>TCP的拥塞控制算法</p>
<p>包括了慢启动、拥塞避免、快速重传和快速恢复4部分</p>
</li>
</ol>

        <h1 id="四-网络层">
          <a href="#四-网络层" class="heading-link"><i class="fas fa-link"></i></a><a href="#四-网络层" class="headerlink" title="四.网络层"></a>四.网络层</h1>
      
        <h2 id="1-网络层服务">
          <a href="#1-网络层服务" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-网络层服务" class="headerlink" title="1.网络层服务"></a>1.网络层服务</h2>
      <p>主要作用是将网络层数据报从<strong>源主机</strong>送达<strong>目的主机</strong></p>
<p>主要功能包括：</p>
<ol>
<li>转发：分组从输入接口转移到输出接口</li>
<li>路由选择：决定分组经过的路由或路径</li>
</ol>

        <h2 id="2-数据报网络与虚电路网络">
          <a href="#2-数据报网络与虚电路网络" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-数据报网络与虚电路网络" class="headerlink" title="2.数据报网络与虚电路网络"></a>2.数据报网络与虚电路网络</h2>
      <ul>
<li><p>数据报网络：按照目的主机地址进行路由选择的网络</p>
<p>特点：</p>
<ol>
<li>无连接</li>
<li>每个分组作为独立的数据报进行传送，路径也可能不同</li>
<li>分组可能出现乱序和丢失</li>
</ol>
</li>
<li><p>虚电路网络：在网络层提供面向连接的分组交换服务</p>
<p>特点：</p>
<ol>
<li>建立一条网络层逻辑连接</li>
<li>不需要为每条虚电路分配独享资源（区别于电路交换）</li>
<li>根据虚电路号沿虚电路路径按序发送分组</li>
</ol>
</li>
</ul>

        <h2 id="3-网络互连与网络互连设备">
          <a href="#3-网络互连与网络互连设备" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-网络互连与网络互连设备" class="headerlink" title="3.网络互连与网络互连设备"></a>3.网络互连与网络互连设备</h2>
      <p><strong>（1）异构网络互连</strong></p>
<p>异构网络：两个网络的通信技术和运行的协议不同</p>
<p>异构网络互连的基本策略：</p>
<ol>
<li>协议转换</li>
<li>构建虚拟互联网络</li>
</ol>
<p><strong>（2）路由器</strong></p>
<ul>
<li><p>输入端口</p>
<p>接收-&gt;物理层处理-&gt;数据链路层处理-&gt;网络层处理、分组排队、查表和转发-&gt;交换结构</p>
</li>
<li><p>输出端口</p>
<p>交换结构-&gt;网络层处理、分组排队、缓存管理-&gt;数据链路层处理-&gt;物理层处理-&gt;输出</p>
</li>
<li><p>交换结构</p>
<ol>
<li>基于内存交换</li>
<li>基于总线交换</li>
<li>基于网络交换</li>
</ol>
</li>
</ul>

        <h2 id="4-网络层拥塞控制">
          <a href="#4-网络层拥塞控制" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-网络层拥塞控制" class="headerlink" title="4.网络层拥塞控制"></a>4.网络层拥塞控制</h2>
      <ul>
<li><p>拥塞：一种持续过载的网络状态，此时用户对网络资源（包括链路带宽、存储空间和处理器处理能力等）的总需求超过了网络固有的容量</p>
</li>
<li><p>原因：</p>
</li>
</ul>
<ol>
<li>缓冲区容量有限</li>
<li>传输线路的带宽有限</li>
<li>网络结点的处理能力有限</li>
<li>网络中某些部分发生了故障</li>
</ol>
<ul>
<li><p>解决方式：</p>
<ul>
<li><p>流量感知路由</p>
<p>根据网络负载动态调整，将网络流量引导到不同的链路上，均衡网络负载，从而延缓或避免拥塞发生</p>
<p>解决网络负载的震荡现象：</p>
<ol>
<li><p>多路径路由</p>
</li>
<li><p>缓慢转移流量至另一链路</p>
</li>
</ol>
</li>
<li><p>准入控制</p>
<p>是一种广泛应用于虚电路网络的拥塞预防技术</p>
</li>
<li><p>流量调节</p>
<ol>
<li>感知拥塞</li>
<li>处理拥塞：将拥塞信息通知到其上游结点</li>
</ol>
<p>处理方法：</p>
<ol>
<li>抑制分组：给拥塞数据报<strong>源主机</strong>返回一个抑制分组</li>
<li>背压：让抑制分组再从拥塞结点到源结点的路径上的<strong>每一跳</strong>，都发挥抑制作用</li>
</ol>
</li>
<li><p>负载脱落</p>
<p>路由器主动丢弃某些数据报</p>
<ol>
<li>丢弃新分组：如GBN</li>
<li>丢弃新分组：如实时视频流</li>
</ol>
</li>
</ul>
</li>
</ul>

        <h2 id="5-Internet网络层">
          <a href="#5-Internet网络层" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-Internet网络层" class="headerlink" title="5.Internet网络层"></a>5.Internet网络层</h2>
      <ul>
<li><p>IPv4协议</p>
<ul>
<li><p>IP数据报格式：首部固定部分20字节</p>
<img src="/2022/02/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/IPv4.jpg" class></li>
<li><p>IP数据报分片</p>
</li>
</ul>
<p><strong>标识</strong>：判断这些分片是否属于同一个IP数据报</p>
<p><strong>标志</strong>：判读那是否为最后一个分片</p>
<p><strong>片偏移</strong>：判断各分片的先后顺序</p>
<ul>
<li><p>IPv4地址长度：<strong>32位二进制</strong></p>
<p>点分十进制标价法：11000000 10101000 00000001 01100101 -&gt; 192.168.1.101</p>
</li>
<li><p>地址分类：A、B、C、D、E五类</p>
<img src="/2022/02/21/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/IPv4%E7%BC%96%E5%9D%80.jpg" class>

<p><strong>同一个网络中所有主机要有同一个网络号</strong></p>
</li>
<li><p>子网划分</p>
</li>
<li><p>路由聚合：将相同路由的连续子网合并</p>
</li>
</ul>
</li>
</ul>

        <h2 id="6-路由算法与路由协议">
          <a href="#6-路由算法与路由协议" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-路由算法与路由协议" class="headerlink" title="6.路由算法与路由协议"></a>6.路由算法与路由协议</h2>
      <ul>
<li><p>路由算法</p>
<ul>
<li><p>链路状态路由选择算法</p>
<p>一种<strong>全局式</strong>路由选择算法。每个路由器通过从其他路由器获得的链路状态信息构造出整个网络拓扑图</p>
</li>
<li><p>距离向量路由选择算法</p>
<p>每个结点基于其与邻居结点间的直接链路距离，以及邻居交换过来的距离向量，计算并更新其到达每个目的结点的最短距离，然后将新的距离向量再通告给其所有邻居，知道距离向量不再改变</p>
</li>
<li><p><strong>层次化路由选择</strong></p>
<p>实现大规模网络路由选择最有效的、可行的解决方案</p>
<p>划分自治系统：</p>
<ul>
<li>网关路由器</li>
<li>自治系统间路由协议</li>
</ul>
</li>
</ul>
</li>
<li><p>路由协议</p>
<ul>
<li>内部网关协议：RIP、OSPF</li>
<li>外部网关协议：BGP</li>
</ul>
</li>
</ul>

        <h1 id="五-数据链路层与局域网">
          <a href="#五-数据链路层与局域网" class="heading-link"><i class="fas fa-link"></i></a><a href="#五-数据链路层与局域网" class="headerlink" title="五.数据链路层与局域网"></a>五.数据链路层与局域网</h1>
      
        <h2 id="1-数据链路层服务">
          <a href="#1-数据链路层服务" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-数据链路层服务" class="headerlink" title="1.数据链路层服务"></a>1.数据链路层服务</h2>
      <p>链路：通信链路连接的<strong>相邻结点</strong>的通信信道</p>
<p>链路层数据单元：帧</p>
<p>主要功能包括：</p>
<ul>
<li>组帧</li>
<li>链路接入：点对点链路、广播链路</li>
<li>可靠交付（可靠传输方法多用于高出错率链路）</li>
<li>差错控制</li>
</ul>

        <h2 id="2-差错控制">
          <a href="#2-差错控制" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-差错控制" class="headerlink" title="2.差错控制"></a>2.差错控制</h2>
      <ul>
<li><p>基本方式：</p>
<ol>
<li>检错重发</li>
<li>前向纠错：接收端进行差错纠正</li>
<li>反馈校验：接收端将收到的数据原封不动发回发送方</li>
<li>检错丢弃</li>
</ol>
</li>
<li><p>差错编码的基本原理</p>
<p>香农信道编码定理：理论上可以通过编码使得数据传输过程不发生错误，或者将错误概率控制在很小的数值之下</p>
</li>
<li><p>差错编码的检错与纠错能力</p>
<p>汉明距离：两个等长码字之间，对应位不同的位数</p>
<p>编码集的汉明距离：该编码集中任意两个码字之间汉明距离的<strong>最小值</strong></p>
<ul>
<li>检错编码：如果编码集的汉明距离d=r+1，则该差错编码可以检测r位的差错</li>
<li>纠错编码：如果编码集的汉明距离d=2r+1，则该差错编码可以纠正r位的差错</li>
</ul>
</li>
<li><p>典型的差错编码</p>
<ul>
<li>奇偶校验码</li>
<li>汉明码</li>
<li>循环冗余码</li>
</ul>
</li>
</ul>

        <h2 id="3-多路访问控制协议">
          <a href="#3-多路访问控制协议" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-多路访问控制协议" class="headerlink" title="3.多路访问控制协议"></a>3.多路访问控制协议</h2>
      <ul>
<li><p>信道划分MAC协议</p>
<p>多路访问控制MAC：广播信道上用于协调各个结点的数据发送</p>
<p>信道划分MAC协议：</p>
<ol>
<li>频分多路复用</li>
<li>时分多路复用</li>
<li>波分多路复用</li>
<li>码分多路复用</li>
</ol>
</li>
<li><p>随机访问MAC协议</p>
<ol>
<li><p>ALOHA协议</p>
<p>纯ALOHA：直接发送-&gt;信道监听-&gt;冲突重发</p>
<p>时隙ALOHA：时隙开始时发送-&gt;信道侦听-&gt;冲突则下一时隙以概率P重发</p>
</li>
<li><p>载波监听多路访问协议CSMA</p>
<p>发送前监听信道是否空闲</p>
<p>（1）非坚持CSMA：忙则等待随机时间后再侦听</p>
<p>（2）1-坚持CSMA：忙则持续监听</p>
<p>（3）P-坚持CSMA：闲则概率P在最近时隙发送</p>
</li>
<li><p>带冲突检测的载波监听多路访问协议CSMA/CD</p>
<p>监听空闲后发送，<strong>发送时检测碰撞</strong>，碰撞后等待重发</p>
</li>
</ol>
</li>
<li><p>受控接入MAC协议</p>
<ol>
<li><p>集中式控制</p>
<p>由一个主机负责调度其他通信站接入信道，从而避免冲突</p>
<p>主要方法：轮询技术，又分为轮叫轮询和传递轮询</p>
</li>
<li><p>分散式控制</p>
<p>典型方法：令牌技术，如令牌环网</p>
</li>
</ol>
</li>
</ul>

        <h2 id="4-局域网">
          <a href="#4-局域网" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-局域网" class="headerlink" title="4.局域网"></a>4.局域网</h2>
      <ul>
<li><p>数据链路层寻址与ARP</p>
<ul>
<li><p>MAC地址</p>
<p>每个接口对应一个MAC地址，且全球唯一</p>
<p>长度48位</p>
</li>
<li><p>地址解析协议</p>
<p>根据本网内目的主机或默认网关的IP地址获取其MAC地址</p>
</li>
</ul>
</li>
<li><p>以太网</p>
<ul>
<li>IEEE802.3标准</li>
<li>采用CSMA/CD访问控制方法</li>
<li>以太网技术<ul>
<li>10Base-5，10Base-T</li>
<li>快速以太网100Base-TX，100Base-T4,100Base-FX</li>
<li>千兆以太网</li>
<li>万兆以太网</li>
</ul>
</li>
</ul>
</li>
<li><p>交换机</p>
<ul>
<li><p>转发与过滤</p>
<p>可以依靠接收到的链路层帧的目的MAC地址，选择性地转发到相应的端口</p>
<p>以目标MAC地址为主键，查找交换表</p>
</li>
<li><p>自学习</p>
<p>交换机通过自学习构建交换表</p>
</li>
<li><p>优点</p>
<ol>
<li>消除冲突，提高性能</li>
<li>支持异质链路</li>
<li>易于进行网络管理</li>
</ol>
</li>
</ul>
</li>
<li><p>虚拟局域网（VLAN）</p>
<ol>
<li>一种基于交换机的逻辑分割广播域的局域网应用形式</li>
<li>不受物理位置的限制，以软件的方式划分和管理局域网中的工作组</li>
<li>能够抑制广播风暴</li>
<li>划分方法：<ul>
<li>基于交换机端口</li>
<li>基于MAC地址</li>
<li>基于上层协议类型或地址</li>
</ul>
</li>
</ol>
</li>
</ul>

        <h2 id="5-点对点链路协议">
          <a href="#5-点对点链路协议" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-点对点链路协议" class="headerlink" title="5.点对点链路协议"></a>5.点对点链路协议</h2>
      <ul>
<li><p>点对点协议——PPP</p>
<p>能够处理差错检测、支持多种上层协议、允许连接时协商IP地址、允许身份认证</p>
<p>典型应用：拨号上网</p>
<p>功能：</p>
<ol>
<li>成帧</li>
<li>链路控制协议LCP</li>
<li>网络控制协议NCP</li>
</ol>
</li>
<li><p>HDLC协议</p>
<p>高级数据链路控制——HDLC协议：</p>
<p>可应用于点对点链路和点对多点链路</p>
<p>帧定界：帧的定界符是01111110</p>
<p>位填充：</p>
<p>​    发送端：只要发现数据字段5个连续的1，就立刻插入一个0，保证数据字段不会出现连续的6个1</p>
<p>​    接收端：发现数据流中5个连续的1，就删除其后的0，还原成原来的信息</p>
</li>
</ul>

        <h1 id="六-物理层">
          <a href="#六-物理层" class="heading-link"><i class="fas fa-link"></i></a><a href="#六-物理层" class="headerlink" title="六.物理层"></a>六.物理层</h1>
      
        <h2 id="1-数据通信基础">
          <a href="#1-数据通信基础" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-数据通信基础" class="headerlink" title="1.数据通信基础"></a>1.数据通信基础</h2>
      <ul>
<li><p>基本概念</p>
<ol>
<li>消息：人类能够感知的描述</li>
<li>信息：信息是对事物状态或存在方式的不确定性表述，<strong>信息是可以度量的</strong></li>
<li>通信：本质就是在一点精确或近似地再生另一点的信息</li>
<li>通信系统：能够实现通信功能的各种技术、设备和方法的总体</li>
<li>信号：通信系统中，在传输通道中传播的信息的载体</li>
<li>数据：对客观事物的性质状态以及相互关系等进行记载的<strong>符号</strong>及其组合</li>
<li>信道：信道是以传输介质为基础的信号通道</li>
</ol>
</li>
<li><p>数据通信系统模型</p>
<ol>
<li><p>构成</p>
<p>信源、发送设备、信道、接收设备、新宿和噪声源等部分</p>
</li>
<li><p>模拟通信</p>
<p>模拟信号：信号的因变量是连续的</p>
</li>
<li><p>数字通信</p>
<p>数字信号：因变量是离散的</p>
</li>
<li><p>数据通信方式</p>
<ol>
<li>单向通信、双向交替通信和双向同时通信</li>
<li>并行通信和串行通信</li>
<li>异步通信和同步通信</li>
</ol>
</li>
<li><p>通信系统的功能</p>
<ol>
<li>信道利用</li>
<li>接口及信号产生</li>
<li>同步</li>
<li>差错检测与纠正</li>
<li>寻址与路由</li>
<li>网络管理</li>
<li>安全保证</li>
</ol>
</li>
</ol>
</li>
</ul>

        <h2 id="2-物理介质">
          <a href="#2-物理介质" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-物理介质" class="headerlink" title="2.物理介质"></a>2.物理介质</h2>
      <ul>
<li>导引型传输介质<ol>
<li>架空明线</li>
<li>双绞线</li>
<li>同轴电缆</li>
<li>光纤</li>
</ol>
</li>
<li>非导引型传输介质<ol>
<li>地波传播</li>
<li>天波传播</li>
<li>视线传播</li>
</ol>
</li>
</ul>

        <h2 id="3-通信与信道容量">
          <a href="#3-通信与信道容量" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-通信与信道容量" class="headerlink" title="3.通信与信道容量"></a>3.通信与信道容量</h2>
      
        <h2 id="4-基带传输">
          <a href="#4-基带传输" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-基带传输" class="headerlink" title="4.基带传输"></a>4.基带传输</h2>
      
        <h2 id="5-频带传输">
          <a href="#5-频带传输" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-频带传输" class="headerlink" title="5.频带传输"></a>5.频带传输</h2>
      
        <h2 id="6-物理层接口规程">
          <a href="#6-物理层接口规程" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-物理层接口规程" class="headerlink" title="6.物理层接口规程"></a>6.物理层接口规程</h2>
      </div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/">执行上下文、作用域、作用域链和闭包</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2022-02-20</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2022-02-21</span></span></div></header><div class="post-body"><div class="post-excerpt"><p>执行上下文、作用域、作用域链、闭包这四个概念联系非常紧密，所以放到同一篇博客中记录。现在网上的很多文章和视频都很难把这几个概念讲清楚，我看了之后，结合自己的理解记录这篇博客。如有错误，欢迎指正。</p>

        <h1 id="一-执行上下文">
          <a href="#一-执行上下文" class="heading-link"><i class="fas fa-link"></i></a><a href="#一-执行上下文" class="headerlink" title="一.执行上下文"></a>一.执行上下文</h1>
      
        <h2 id="1-概念">
          <a href="#1-概念" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-概念" class="headerlink" title="1.概念"></a>1.概念</h2>
      <p>执行上下文（execution context）：当前JavaScript代码<strong>被解析</strong>和<strong>执行</strong>时存在的环境。它是为了方便理解提出来的一种抽象概念，并非真实存在。</p>

        <h2 id="2-类型">
          <a href="#2-类型" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-类型" class="headerlink" title="2.类型"></a>2.类型</h2>
      <p>在ES6版本下，有四种情况会创建执行上下文：</p>
<ul>
<li>进入全局代码（全局执行上下文）</li>
<li>进入function函数体代码（函数执行上下文）</li>
<li>进入eval函数参数指定的代码（eval执行上下文）</li>
<li>进入module代码（module执行上下文）</li>
</ul>
<p>我们重点关注前两种执行上下文：<code>全局执行上下文</code>和<code>函数执行上下文</code></p>

        <h2 id="3-执行上下文栈">
          <a href="#3-执行上下文栈" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-执行上下文栈" class="headerlink" title="3.执行上下文栈"></a>3.执行上下文栈</h2>
      <p>全局执行上下文只会存在一个，而函数执行上下文可以存在无数个。<code>每当函数被调用，就会创建一个新的函数执行上下文</code>。即使是同一个函数被多次调用，也会创建多个执行上下文。</p>
<p>那么该如何管理这些上下文呢？这就有了<code>执行上下文栈</code>的概念，也叫<code>执行栈</code>或<code>调用栈</code>（如果了解js的事件循环机制，那对于调用栈并不陌生，我个人理解调用栈和执行上下文栈本质是同一个东西，只不过在事件循环机制中，我们更关注于代码的执行，也就是下文将提到的创建执行上下文的执行阶段）。</p>
<p>执行栈具有<code>LIFO</code>（Last In First Out）的特点。当JS代码首次运行，都会创建一个<strong>全局执行上下文</strong>压入执行栈，之后每当有函数被调用，都将创建一个新的<strong>函数执行上下文</strong>压入栈中，当最顶层函数执行完毕，一步步出栈。</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    f2();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    f3();</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">f3</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">3</span>);</span><br><span class="line">&#125;;</span><br><span class="line">f1();<span class="comment">//3 2 1</span></span><br></pre></td></tr></table></div></figure>

<p>那么执行上下文究竟做了哪些事情呢？接下来我们重点讲一下。</p>

        <h2 id="4-执行上下文的生命周期">
          <a href="#4-执行上下文的生命周期" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-执行上下文的生命周期" class="headerlink" title="4.执行上下文的生命周期"></a>4.执行上下文的生命周期</h2>
      <p>执行上下文的生命周期分为三个阶段：<strong>创建阶段</strong>、<strong>执行阶段</strong>、<strong>销毁阶段</strong>。</p>
<p>由于标准的不断更新，对于执行上下文的内容也有了很大出入，首先将以ES3标准介绍执行上下文，比较容易理解，之后再讲解ES5标准。</p>

        <h3 id="1-创建阶段">
          <a href="#1-创建阶段" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-创建阶段" class="headerlink" title="(1) 创建阶段"></a>(1) 创建阶段</h3>
      <p>执行上下文的创建阶段被称为<code>预处理</code>或<code>预编译</code>，指在代码<strong>运行前</strong>js引擎所作的处理，ES3标准中执行上下文的创建阶段主要有三个部分：</p>
<ul>
<li>创建变量对象/活动对象</li>
<li>创建作用域链</li>
<li>this绑定</li>
</ul>

        <h4 id="1）创建变量对象-活动对象">
          <a href="#1）创建变量对象-活动对象" class="heading-link"><i class="fas fa-link"></i></a><a href="#1）创建变量对象-活动对象" class="headerlink" title="1）创建变量对象/活动对象"></a>1）创建变量对象/活动对象</h4>
      <p>每个执行上下文都有一个表示变量的对象——<code>变量对象(variable object，简称VO)</code>，刚刚说了，执行上下文又分为全局执行上下文和函数执行上下文，它们的变量对象是有区别的。</p>
<p>全局执行上下文的变量对象叫做<code>全局对象(global object，简称GO)</code>，在浏览器环境JS引擎会整合<code>&lt;script&gt;</code>标签中的内容，产生<code>window对象</code>，这个window对象就是全局对象。在<code>&lt;script&gt;</code>标签中声明的变量称为<code>全局变量</code>，<strong>全局变量会作为window对象的属性存在</strong>。</p>
<figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> a = <span class="number">100</span>;</span></span><br><span class="line"><span class="javascript">	<span class="built_in">console</span>.log(a);	<span class="comment">// 100</span></span></span><br><span class="line"><span class="javascript">	<span class="built_in">console</span>.log(<span class="built_in">window</span>.a);	<span class="comment">// 100</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="built_in">window</span>);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(a);	<span class="comment">// 100</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="built_in">window</span>.a);	<span class="comment">// 100</span></span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></div></figure>

<p>在<code>&lt;script&gt;</code>标签中的声明的函数为<code>全局函数</code>，<strong>全局函数会作为window对象的方法存在</strong>。</p>
<figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">	<span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="number">1</span>);</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="built_in">window</span>);</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></div></figure>

<p>当函数<strong>被调用</strong>时，会创建函数执行上下文，函数执行上下文的变量对象叫做<code>活动对象(activation object，简称AO)</code>。在函数内部声明的变量称为<code>局部变量</code>，<strong>局部变量会作为AO的属性存在</strong>。在函数内部声明的函数叫<code>局部函数</code>，<strong>局部函数会作为AO的方法存在</strong>。</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 通过控制台断点查看</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    b();</span><br><span class="line">&#125;</span><br><span class="line">a();</span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>其实，变量对象、全局对象、活动对象是一个东西，只不过是不同状态和阶段而已。全局执行上下文中的变量对象叫全局对象，函数执行上下文中的变量对象叫活动对象。</p>
<p>另外，下文中的<code>GO对象</code>就是<code>GO</code>，<code>AO对象</code>就是<code>AO</code>，只是我个人习惯在后面加一个对象，不妨碍阅读。</p>
</blockquote>
<p>接下来，我们来看一段经典的代码：</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(a);	<span class="comment">// undefined</span></span><br><span class="line"><span class="keyword">var</span> a;</span><br></pre></td></tr></table></div></figure>

<p>为什么输出打印的结果是undefined，接下去我们就来详细讲讲。</p>
<p>首先，在全局执行上下文的创建阶段中（严格来讲，是创建阶段的变量对象部分），JS引擎会做这些事情：</p>
<ol>
<li>生成window对象，也就是GO对象</li>
<li>查找（全局）变量声明，作为GO对象的属性名，值为undefined</li>
<li>查找（全局）函数声明，作为GO对象的方法名，值为function</li>
</ol>
<p>变量声明：通过<code>var</code>关键字声明变量</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a;	<span class="comment">// 变量声明</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">100</span>;	<span class="comment">// 变量声明+变量赋值</span></span><br></pre></td></tr></table></div></figure>

<p>函数声明：通过<code>function</code>关键字声明函数</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;&#125;	<span class="comment">// 函数声明</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;&#125;	<span class="comment">// 注意：这种情况并不是函数声明，而是函数表达式。相当于变量声明，只不过这个变量在执行代码时被赋予一个函数</span></span><br></pre></td></tr></table></div></figure>

<p><strong>注意：</strong></p>
<ol>
<li>当查找函数声明并初始化时，创建了一个与之对应的函数对象，并被它引用</li>
<li>如果变量和函数同名，函数声明会覆盖掉变量声明，也就是说结果为function</li>
</ol>
<blockquote>
<p>对于注意点2，有些人的说法是var的优先级高，因为JS引擎会优先找var声明，另一些人的说法是function优先级高，因为如果出现同名，JS引擎会选择function。其实这两种说法只是理解角度不同而已，最终结果都是function。下方的示例2就是演示这一点。</p>
</blockquote>
<p>示例1：</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="number">100</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	1.产生window对象</span></span><br><span class="line"><span class="comment">	2.查找变量声明：a，作为GO的属性名，初始化为undefined</span></span><br><span class="line"><span class="comment">	3.查找函数声明：b，作为GO的方法名，初始化为function(实际上是创建了一个函数对象，并让b引用)</span></span><br><span class="line"><span class="comment">	GO：&#123;</span></span><br><span class="line"><span class="comment">		a:undefined,</span></span><br><span class="line"><span class="comment">		b:function</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></div></figure>

<p>用图像来表示：</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E5%85%A8%E5%B1%80%E9%A2%84%E7%BC%96%E8%AF%91.png" class>

<blockquote>
<p>黄色虚线表示逻辑关系，红色实线表示真实的内存地址引用，下文同</p>
</blockquote>
<p>实例2：</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(a);	<span class="comment">// function</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>到此为止，全局执行上下文的创建阶段结束。</p>
<blockquote>
<p>严格来讲，是全局执行上下文创建阶段中的变量对象部分结束，但是在这一章节的学习中，我们会发现创建阶段的变量对象这一部分对我们理解来说是最重要的，所以这一章节中，变量对象初始化完毕后，我们就认为创建阶段结束，作用域链和this绑定我们暂不讨论。</p>
</blockquote>
<p>接着讲解下函数执行上下文的创建阶段（严格来讲，是创建阶段的变量对象部分），JS引擎会做这些事情：</p>
<ol>
<li>在函数<strong>被调用</strong>时，为当前函数产生AO对象</li>
<li>查找（局部）变量声明和形参，作为AO对象的属性名，值为undefined</li>
<li>使用实参的值改变形参的值</li>
<li>查找（局部）函数声明，作为AO对象的方法名，值为function</li>
</ol>
<p>示例：</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">	<span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	b();</span><br><span class="line">&#125;</span><br><span class="line">a(<span class="number">1</span>);</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	创建全局执行上下文，并压入栈</span></span><br><span class="line"><span class="comment">	1.产生window对象</span></span><br><span class="line"><span class="comment">	2.查找变量声明：无</span></span><br><span class="line"><span class="comment">	3.查找函数声明:a，作为GO的方法名，初始化为function</span></span><br><span class="line"><span class="comment">	GO：&#123;</span></span><br><span class="line"><span class="comment">		a:function</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	到此为止全局执行上下文的创建阶段结束</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	开始执行代码(这部分是执行上下文的执行阶段，但由于函数执行上下文只有在被调用时才会创建，所以需要执行，我们将在下文再接着讲执行阶段)</span></span><br><span class="line"><span class="comment">	运行到a(1)</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	创建函数执行上下文，并压入栈</span></span><br><span class="line"><span class="comment">	1.产生函数AO对象</span></span><br><span class="line"><span class="comment">	2.查找函数内变量声明和形参：x、i，作为AO的属性名，初始化为undefined</span></span><br><span class="line"><span class="comment">	3.将实参1赋值给形参x，x:1</span></span><br><span class="line"><span class="comment">	4.查找函数内函数声明：b，作为AO的方法名，初始化为function</span></span><br><span class="line"><span class="comment">	AO:&#123;</span></span><br><span class="line"><span class="comment">		x:1,</span></span><br><span class="line"><span class="comment">		i:undefined,</span></span><br><span class="line"><span class="comment">		b:function</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></div></figure>

<p>同样用图像来表示：</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E5%87%BD%E6%95%B0%E9%A2%84%E7%BC%96%E8%AF%91.png" class>

<p>通过浏览器的调试工具查看：</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E5%87%BD%E6%95%B0%E9%A2%84%E7%BC%96%E8%AF%91-%E8%B0%83%E8%AF%95%E5%B7%A5%E5%85%B7.png" class>

<p>到此为止，函数执行上下文的创建阶段结束。</p>
<p>了解完这部分后，我们会发现之前所谓的<code>变量提升</code>和<code>函数提升</code>就是指查找变量声明和函数声明。</p>
<hr>

        <h4 id="2）创建作用域链">
          <a href="#2）创建作用域链" class="heading-link"><i class="fas fa-link"></i></a><a href="#2）创建作用域链" class="headerlink" title="2）创建作用域链"></a>2）创建作用域链</h4>
      <p>作用域和作用域链我将在下一章节重点讲，这里就先略过。</p>
<hr>

        <h4 id="3）绑定this">
          <a href="#3）绑定this" class="heading-link"><i class="fas fa-link"></i></a><a href="#3）绑定this" class="headerlink" title="3）绑定this"></a>3）绑定this</h4>
      <p>如果是全局执行上下文，this其实就是全局对象，即window对象，如果是函数执行上下文，那就要确认<code>当前可执行代码块的调用者</code>， 并将调用者信息<code>this value</code>存入当前执行上下文，否则默认为全局对象调用。有关this的问题，可另行查看，本文不过多介绍，并且不再提及。</p>
<hr>
<p>综上，在执行上下文的创建阶段，变量对象是最主要的内容。</p>

        <h3 id="2-执行阶段">
          <a href="#2-执行阶段" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-执行阶段" class="headerlink" title="(2) 执行阶段"></a>(2) 执行阶段</h3>
      <p>所谓执行阶段，反而比创建阶段更好理解，就是运行JS代码。</p>
<p>在执行阶段中，JS代码会被<strong>逐条执行</strong>，如果有赋值语句，就对应地去赋值……</p>
<p>示例：</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params">x</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(i);	<span class="comment">// undefined</span></span><br><span class="line">	<span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(i);	<span class="comment">// 0</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	b();</span><br><span class="line">&#125;</span><br><span class="line">a(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	创建全局执行上下文，并压入栈</span></span><br><span class="line"><span class="comment">	1.产生window对象</span></span><br><span class="line"><span class="comment">	2.查找变量声明：无</span></span><br><span class="line"><span class="comment">	3.查找函数声明：a，初始化为function</span></span><br><span class="line"><span class="comment">	GO:&#123;</span></span><br><span class="line"><span class="comment">		a:function</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	全局执行上下文创建阶段结束，开始执行代码</span></span><br><span class="line"><span class="comment">	执行到a(1)</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	创建a函数执行上下文，并压入栈</span></span><br><span class="line"><span class="comment">	1.产生AO对象</span></span><br><span class="line"><span class="comment">	2.查找形参和变量声明：x、i，并初始化为undefined</span></span><br><span class="line"><span class="comment">	3.将实参1赋值给形参x，x:1</span></span><br><span class="line"><span class="comment">	4.查找函数声明：b，并初始化为function</span></span><br><span class="line"><span class="comment">	AO:&#123;</span></span><br><span class="line"><span class="comment">		x:1,</span></span><br><span class="line"><span class="comment">		i:undefined,</span></span><br><span class="line"><span class="comment">		b:function</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	函数执行上下文创建阶段结束，开始执行代码</span></span><br><span class="line"><span class="comment">	console.log(i)</span></span><br><span class="line"><span class="comment">	此时还没有执行赋值语句，所以i还是undefined</span></span><br><span class="line"><span class="comment">	继续执行 var i = 0</span></span><br><span class="line"><span class="comment">	此时AO:&#123; x:1, i:0, b:function &#125;</span></span><br><span class="line"><span class="comment">	再继续执行 console.log(i)</span></span><br><span class="line"><span class="comment">	输出的自然是0</span></span><br><span class="line"><span class="comment">	跳过函数声明，继续执行b()</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	创建b函数执行上下文，并压入栈</span></span><br><span class="line"><span class="comment">	1.产生新的AO对象</span></span><br><span class="line"><span class="comment">	2.查找形参和变量声明：无</span></span><br><span class="line"><span class="comment">	3.查找函数声明：无</span></span><br><span class="line"><span class="comment">	AO:&#123;&#125;</span></span><br><span class="line"><span class="comment">	函数执行上下文创建阶段结束，开始执行代码</span></span><br><span class="line"><span class="comment">	console.log(1)</span></span><br><span class="line"><span class="comment">	输出打印1</span></span><br><span class="line"><span class="comment">	b函数执行完毕，接着就是执行上下文的销毁阶段</span></span><br><span class="line"><span class="comment">	b函数执行上下文将从执行栈中弹出并销毁，对应的AO对象也被释放</span></span><br><span class="line"><span class="comment">	然后继续执行a函数代码，a函数执行完毕，a函数执行上下文将从执行栈中弹出并销毁，对应的AO对象被释放</span></span><br><span class="line"><span class="comment">	继续执行全局代码</span></span><br><span class="line"><span class="comment">	注意：即使代码全部执行完毕，全局执行上下文也不会从执行栈中弹出，直到关闭该页面</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></div></figure>

<p>以上代码请结合画图理解</p>

        <h3 id="3-销毁阶段">
          <a href="#3-销毁阶段" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-销毁阶段" class="headerlink" title="(3) 销毁阶段"></a>(3) 销毁阶段</h3>
      <p>当函数代码执行完后，当前执行上下文<strong>（局部环境）</strong>会被弹出执行上下文栈并销毁，对应的变量对象也被释放，控制权被重新交给执行栈上一层的执行上下文。</p>
<blockquote>
<p>这是一般情况，但如果产生了闭包，会有所不同。闭包将在下面的篇章中介绍。</p>
</blockquote>

        <h2 id="5-总结">
          <a href="#5-总结" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-总结" class="headerlink" title="5.总结"></a>5.总结</h2>
      <p>至此，执行上下文的所有内容都介绍完毕</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87-%E6%80%9D%E7%BB%B4%E5%AF%BC%E5%9B%BE.png" class>

<p>练习：</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一题</span></span><br><span class="line"><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;foo1&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">foo();</span><br><span class="line"><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;foo2&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">foo();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二题</span></span><br><span class="line">foo();</span><br><span class="line"><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;foo1&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;foo2&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">foo();</span><br></pre></td></tr></table></div></figure>

<p>接下去我们讲解一下作用域与作用域链。</p>

        <h1 id="二-作用域与作用域链">
          <a href="#二-作用域与作用域链" class="heading-link"><i class="fas fa-link"></i></a><a href="#二-作用域与作用域链" class="headerlink" title="二.作用域与作用域链"></a>二.作用域与作用域链</h1>
      
        <h2 id="1-作用域">
          <a href="#1-作用域" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-作用域" class="headerlink" title="1.作用域"></a>1.作用域</h2>
      <p>域，顾名思义就是区域、范围的意思。那么作用域，就是指<code>当前代码对变量的访问区域</code>，或者说<code>可访问变量的集合</code>。</p>
<p>作用域分为三类：</p>
<ul>
<li>全局作用域</li>
<li>局部作用域（函数作用域）</li>
<li>块级作用域</li>
</ul>
<p>早期ES标准中并没有块级作用域的概念，我将在下文ES5标准中介绍块级作用域，这里我们只考虑<code>全局作用域</code>和<code>局部作用域</code>。从代码编写的角度可以这样理解：</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E4%BD%9C%E7%94%A8%E5%9F%9F.jpg" class>

<p>上面红色框表示的就是局部作用域，黄色框表示全局作用域。结合我们上面执行上下文中所学的内容，<code>JS引擎对变量的访问实际上就是从GO或者AO对象上查找属性</code>，那么也就是说：</p>
<ul>
<li>全局作用域本质上就是GO对象</li>
<li>局部作用域本质上就是AO对象</li>
</ul>

        <h2 id="2-作用域链">
          <a href="#2-作用域链" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-作用域链" class="headerlink" title="2.作用域链"></a>2.作用域链</h2>
      <p>那么什么是作用域链呢？以下面的代码为例：</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    i++;</span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br><span class="line">a();</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	我们还是按照执行上下文来分析这段代码</span></span><br><span class="line"><span class="comment">	首先创建全局执行上下文，并压入执行栈</span></span><br><span class="line"><span class="comment">	1.产生window对象</span></span><br><span class="line"><span class="comment">	2.查找变量声明：i，并初始化为undefined</span></span><br><span class="line"><span class="comment">	3.查找函数声明：a，并初始化为function</span></span><br><span class="line"><span class="comment">	GO:&#123;</span></span><br><span class="line"><span class="comment">		i:undefined,</span></span><br><span class="line"><span class="comment">		a:function</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	全局执行上下文创建完毕，开始执行代码</span></span><br><span class="line"><span class="comment">	var i = 0</span></span><br><span class="line"><span class="comment">	将O赋值给GO对象中的i，此时的GO:&#123; i:0, a:function &#125;</span></span><br><span class="line"><span class="comment">	继续执行 a()</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	创建a函数执行上下文，并压入执行栈</span></span><br><span class="line"><span class="comment">	1.产生AO对象</span></span><br><span class="line"><span class="comment">	2.查找形参和变量声明：无</span></span><br><span class="line"><span class="comment">	3.查找函数声明：无</span></span><br><span class="line"><span class="comment">	AO:&#123;&#125;</span></span><br><span class="line"><span class="comment">	函数执行上下文创建完毕，开始执行代码</span></span><br><span class="line"><span class="comment">	i++</span></span><br><span class="line"><span class="comment">	这个时候，JS引擎会先从函数作用域(也就是AO对象)中上查找i，发现函数作用域中并没有，于是就向上级作用域查找，这里代码的上级作用域就是全局作用域(GO对象)，发现i为0，那么执行i++。此时GO:&#123; i:1, a:function &#125;</span></span><br><span class="line"><span class="comment">	继续执行 console.log(i)</span></span><br><span class="line"><span class="comment">	查找过程同上，输出i为1。函数执行完毕</span></span><br><span class="line"><span class="comment">	...(销毁阶段省略)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></div></figure>

<p>这样一个查找过程形成的链式结构，就叫<code>作用域链</code>。</p>
<p>那么问题来了，函数a在执行中怎么确定上级作用域是谁呢？</p>
<p>其实，在函数声明的时候，创建的函数对象中包含了一个<code>隐藏属性[[scope]]</code>，这个属性记录了当前的执行环境。上面的代码用图像表示：</p>
<ol>
<li><p>首先创建全局执行上下文并压入栈；产生GO对象；查找变量声明：i，初始化undefined；查找函数声明：a，初始化function，即创建一个函数对象，并被a引用。这个时候函数对象中的[[scope]]属性就记录了当前的执行环境，它是一个数组，而当前正处于全局执行上下文，那么这个数组的第1位就是GO对象：a.[[scope]] = [GO]</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-1.png" class>

<blockquote>
<p>图上这么画其实不准确，数组也是一个对象，所以[[scope]]属性应该要引用这个对象的地址，而这个对象要引用GO对象，但为了避免线条过多造成的视觉影响，所以采用图上的画法。</p>
<p>另外提醒一点，[[scope]]属性只有JS引擎能够访问，下文所有与[[scope]]相关的代码都是伪代码，比如：a.[[scope]]其实是不能运行的。</p>
</blockquote>
</li>
<li><p>全局执行上下文的创建结束，开始执行代码var a = 0。</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-2.png" class></li>
<li><p>继续执行a()，此时函数被调用，创建函数执行上下文，并压入执行栈；产生a函数的AO对象；没有形参、变量声明和函数声明，AO对象为空对象。</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-3.png" class></li>
<li><p>还记得执行上下文创建阶段中有一个创建作用域链吗？当<strong>函数执行上下文创建</strong>时，除了创建变量对象，JS引擎还会根据函数的[[scope]]属性去<strong>创建作用域链</strong>，将当前产生的<code>AO对象</code>添加到作用域链的<strong>最前端</strong>，也就是说当前执行上下文的作用域链为<code>[aAO,GO]</code>，即JS引擎访问变量的顺序就是<code>aAO-&gt;GO</code>。</p>
<p><strong>注意：</strong></p>
<ol>
<li>作用域链也是个数组，但它和[[scope]]是不同的，后者是函数对象中的属性，表示函数创建时的执行环境；前者是执行上下文的一部分，表示当前执行上下文中JS引擎访问变量的查找过程。</li>
<li>作用域链 = AO + [[scope]]，AO会添加在作用域链的最前面：作用域链 = [AO].concat([[scope]])</li>
<li>全局执行上下文的作用域链就是[GO]</li>
</ol>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-4.png" class></li>
<li><p>此时函数执行上下文创建完毕，开始执行代码 i++，顺着作用域链查找并执行赋值语句。然后继续执行 console.log(i)，输出打印1。</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-5.png" class></li>
<li><p>函数执行完毕，a函数执行上下文弹出并销毁，aAO被释放。</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-6.png" class></li>
<li><p>继续执行全局代码，直至页面关闭，全局执行上下文弹出并销毁。</p>
</li>
</ol>
<p>我们可以通过下面这个例子加深理解：</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(i);</span><br><span class="line">        &#125;</span><br><span class="line">        c();</span><br><span class="line">    &#125;</span><br><span class="line">    b();</span><br><span class="line">&#125;</span><br><span class="line">a();</span><br></pre></td></tr></table></div></figure>

<p>当c函数执行上下文创建时的图应该是这个样子：</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-7.png" class>

<blockquote>
<p>b函数是在a函数中声明的，b函数创建时[[scope]]属性的赋值，其实和a函数执行上下文创建作用域链的步骤是一样的，都是复制a函数的[[scope]]属性中的对象，将a函数执行上下文产生的AO对象添加到数组的第一位，也就是说b函数的[[scope]]属性和a函数执行上下文的作用域链内容是一样的，但是表示的含义不同。</p>
<p>[[scope]]所谓的保存当前执行环境，其实就是保存了变量对象到其中。</p>
</blockquote>
<p>再一次强调：<strong>函数创建时，就会保存当前的执行环境。</strong>所以有一句话叫：<code>函数的作用域在函数创建的时候决定而不是在调用的时候决定</code>。</p>
<blockquote>
<p>我个人认为，这句话的准确说法应该是：函数执行上下文的 作用域链，在函数创建的时候决定而不是调用的时候决定。（AO+[[scope]]）</p>
<p>因为现在一直在讲作用域链，突然提及<code>函数的作用域</code>，感觉有点奇怪。我们刚刚说了函数的作用域本质上是AO对象，那这句话里的<code>函数的作用域</code>要是按照AO对象去理解的话显然说不通，它指的应该是函数的[[scope]]属性。</p>
<p>无论你怎么理解，总归都是一句话：当函数创建时，它体内就保存了当时的执行环境。</p>
</blockquote>
<p>我们再用一个例子强化这个理解：</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">3</span>;</span><br><span class="line">    foo();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line">bar();</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	结果：console.log打印输出2，而不是3</span></span><br><span class="line"><span class="comment">	过程：</span></span><br><span class="line"><span class="comment">	创建全局执行上下文，并压入栈</span></span><br><span class="line"><span class="comment">	1.产生window对象</span></span><br><span class="line"><span class="comment">	2.查找变量声明：a，初始化为undefined</span></span><br><span class="line"><span class="comment">	3.查找函数声明:foo、bar，初始化为function</span></span><br><span class="line"><span class="comment">	GO:&#123;</span></span><br><span class="line"><span class="comment">		a:undefined,</span></span><br><span class="line"><span class="comment">		foo:function</span></span><br><span class="line"><span class="comment">		bar:function</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	同时</span></span><br><span class="line"><span class="comment">	foo.[[scope]] = [GO]</span></span><br><span class="line"><span class="comment">	bar.[[scope]] = [GO]</span></span><br><span class="line"><span class="comment">	创建作用域链:因为是全局执行上下文，所以就是[GO]</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	全局执行上下文创建完毕，开始执行代码</span></span><br><span class="line"><span class="comment">	var a = 2</span></span><br><span class="line"><span class="comment">	此时GO:&#123; a:2, foo:function, bar:function &#125;</span></span><br><span class="line"><span class="comment">	继续执行bar()</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	创建bar函数执行上下文，并压入栈</span></span><br><span class="line"><span class="comment">	1.产生AO对象(简称bAO)</span></span><br><span class="line"><span class="comment">	2.查找形参、变量声明：a，初始化为undefined</span></span><br><span class="line"><span class="comment">	3.没有形参，所以不用将实参赋值给形参</span></span><br><span class="line"><span class="comment">	4.查找函数声明：无</span></span><br><span class="line"><span class="comment">	bAO：&#123;</span></span><br><span class="line"><span class="comment">		a:undefined</span></span><br><span class="line"><span class="comment">	&#125;</span></span><br><span class="line"><span class="comment">	创建作用域链:[bAO,GO]</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	bar函数执行上下文创建完毕，开始执行代码</span></span><br><span class="line"><span class="comment">	var a = 3</span></span><br><span class="line"><span class="comment">	此时bAO:&#123; a:3 &#125;</span></span><br><span class="line"><span class="comment">	继续执行foo()</span></span><br><span class="line"><span class="comment">	这里要注意，foo并不是在bar函数中声明的，bAO中没有foo属性，那么JS引擎就会顺着作用域链去GO中查找，找到foo并执行</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	创建foo函数执行上下文，并压入栈</span></span><br><span class="line"><span class="comment">	1.产生AO对象(简称fAO)</span></span><br><span class="line"><span class="comment">	2.查找形参、变量声明：无</span></span><br><span class="line"><span class="comment">	3.查找函数声明：无</span></span><br><span class="line"><span class="comment">	fAO:&#123;&#125;</span></span><br><span class="line"><span class="comment">	创建作用域链:[fAO,GO]</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	foo函数执行上下文创建完毕，开始执行代码</span></span><br><span class="line"><span class="comment">	console.log(a)</span></span><br><span class="line"><span class="comment">	由于fAO中并没有a属性，所以沿着作用域链查找GO，发现GO中的a为2，所以输出打印2而不是3</span></span><br><span class="line"><span class="comment">	...(销毁阶段省略)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></div></figure>

<p>如果用图像表示：</p>
<ol>
<li><p>创建全局执行上下文并压入栈；产生GO对象；查找变量声明：a，并初始化为undefined；查找函数声明：foo、bar，并初始化为function。foo、bar函数的[[scope]]值为[GO]，另外全局执行上下文的作用域链就是[GO]。</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-8.png" class></li>
<li><p>全局执行上下文创建完毕，开始执行代码 var a = 2。</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-9.png" class></li>
<li><p>继续执行bar()。</p>
</li>
<li><p>函数被调用，创建bar函数执行上下文；产生AO对象（图中的bAO）；有一个变量声明a，初始化为undefined，没有形参，也没有函数声明。</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-10.png" class></li>
<li><p>接着创建bar函数执行上下文的作用域链，bar函数的[[scope]]为[GO]，所以bar函数执行上下文的作用域链为[bAO, GO]。</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-11.png" class></li>
<li><p>bar函数执行上下文创建完毕，开始执行代码 var a = 3。</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-12.png" class></li>
<li><p>继续执行foo()。因为bAO中并没有foo属性，JS引擎将顺着作用域链查找，在GO中查找到foo并调用。</p>
</li>
<li><p>创建foo函数执行上下文；产生AO对象（图中的fAO）；没有形参、变量声明、函数声明。</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-13.png" class></li>
<li><p>接着创建foo函数执行上下文的作用域链，foo函数的[[scope]]为[GO]，所以foo函数执行上下文的作用域链为[fAO, GO]。</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE-14.png" class></li>
<li><p>foo函数执行上下文创建完毕，开始执行代码 console.log(a)。由于fAO中并没有a属性，所以沿着作用域链查找，找到GO中有a属性，输出打印2。</p>
</li>
<li><p>…（销毁阶段省略）</p>
</li>
</ol>
<p>从上面的图可以看出来，JS引擎并非按照执行上下文的调用顺序形成作用域链（如果是按照调用顺序决定作用域链，那foo函数执行上下文的作用域链应该是fAO-&gt;bAO-&gt;GO，显然并不是），而是根据函数创建时的执行环境形成作用域链。最直观的，我们可以直接通过函数的书写位置来判断作用域链。因此JS的作用域被称为<code>词法作用域</code>。</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E8%AF%8D%E6%B3%95%E4%BD%9C%E7%94%A8%E5%9F%9F.jpg" class>




        <h2 id="3-总结">
          <a href="#3-总结" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-总结" class="headerlink" title="3.总结"></a>3.总结</h2>
      <p>作用域和作用域链的部分讲完了。这部分比较难理解，概念比较多，需要花时间消化。</p>
<p>另外，不同人对于相同的词可能有不同的理解，这就导致很多博客和教学视频对于执行上下文、作用域和作用域链等概念解释得并不相同。上文仅代表我个人理解，对你或许会有帮助。</p>
<p>练习：</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一题</span></span><br><span class="line"><span class="keyword">var</span> foo = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(foo);</span><br><span class="line">    <span class="keyword">var</span> foo = <span class="number">10</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(foo);</span><br><span class="line">&#125;</span><br><span class="line">bar();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二题</span></span><br><span class="line"><span class="keyword">var</span> foo = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(foo);</span><br><span class="line">    foo = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line">bar();</span><br><span class="line"><span class="built_in">console</span>.log(foo);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第三题</span></span><br><span class="line"><span class="keyword">var</span> foo = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">bar</span> (<span class="params">foo</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(foo);</span><br><span class="line">    foo = <span class="number">234</span>;</span><br><span class="line">&#125;</span><br><span class="line">bar(<span class="number">123</span>);</span><br><span class="line"><span class="built_in">console</span>.log(foo);</span><br></pre></td></tr></table></div></figure>




        <h1 id="三-闭包">
          <a href="#三-闭包" class="heading-link"><i class="fas fa-link"></i></a><a href="#三-闭包" class="headerlink" title="三.闭包"></a>三.闭包</h1>
      
        <h2 id="1-概念-1">
          <a href="#1-概念-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-概念-1" class="headerlink" title="1.概念"></a>1.概念</h2>
      <p>这部分应该是JS当中最难理解的一部分，但有了之前学到的基础，这部分理解起来就会容易一些。</p>
<p>还是通过一个例子引出：</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(i);</span><br><span class="line">&#125;</span><br><span class="line">test();</span><br></pre></td></tr></table></div></figure>

<p>如果用图像来表示：</p>
<ol>
<li><p>…（全局执行上下文的创建阶段和执行阶段省略）</p>
</li>
<li><p>…（test函数执行上下文的创建阶段和执行阶段省略）</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E9%97%AD%E5%8C%85-1.png" class></li>
<li><p>当函数执行完时，test函数执行上下文从栈中弹出并销毁，对应的AO对象会被释放（图中蓝色框部分），那么我们将不再能够访问到变量i</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E9%97%AD%E5%8C%85-2.png" class></li>
</ol>
<p>那么我们想一想，有没有办法将这个AO对象保存下来呢？</p>
<p>答案肯定是有的。如果我们在<strong>函数内部</strong>再去声明一个函数，那么这个函数对象的<code>[[scope]]</code>是不是就<strong>保留了当前的执行环境</strong>，也就是说它的体内<strong>存在对当前AO对象的引用</strong>。</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">inner</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">test()</span><br></pre></td></tr></table></div></figure>

<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E9%97%AD%E5%8C%85-3.png" class>

<p>但是这样还不够，当test函数执行上下文弹出并销毁时，图中的蓝色框部分一样会被释放掉，因为没有存在外部引用，这一部分<strong>不可被访问到</strong>。</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E9%97%AD%E5%8C%85-4.png" class>

<blockquote>
<p>关于垃圾回收机制，可以参考这篇博客：</p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000018605776">https://segmentfault.com/a/1190000018605776</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</blockquote>
<p>解决办法就是在全局环境下声明一个变量，并将test函数内的inner函数<strong>返回</strong>给它，那么就可以通过全局变量去访问内部函数，进而可以访问到AO对象。这种情况下，AO对象不会被释放。以下面的代码为例：</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">inner</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> inner</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> a = test()</span><br><span class="line">a()	<span class="comment">// 输出打印0</span></span><br></pre></td></tr></table></div></figure>

<ol>
<li><p>创建全局执行上下文，并压入栈；产生GO对象；查找变量声明：a，初始化为undefined；查找函数声明：test，初始化为funticon，test.[[scope]] = [GO]；创建作用域链：[GO]</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E9%97%AD%E5%8C%85-5.png" class></li>
<li><p>全局执行上下文创建完毕，开始执行代码 var a = test()</p>
</li>
<li><p>test函数被调用，创建test函数执行上下文，并压入栈；产生AO对象：tAO；查找形参：无；查找变量声明：i，初始化为undefined；查找函数声明：inner，初始化为function，inner.[[scope]] = [tAO，GO]；创建作用域链：[tAO，GO]</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E9%97%AD%E5%8C%85-6.png" class></li>
<li><p>test函数执行上下文创建完毕，开始执行代码 var i = 0，<strong>return inner</strong></p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E9%97%AD%E5%8C%85-7.png" class></li>
<li><p>test函数执行完毕，函数上下文从执行栈中弹出并销毁，注意全局执行上下文中var a = test()还未执行完，需要将test函数的返回值赋值给变量a，a保存对inner函数对象的引用</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E9%97%AD%E5%8C%85-8.png" class>

<p>这时候由于tAO仍能被访问，所以它不会被释放</p>
</li>
<li><p>继续执行全局代码a()，也就是调用inner函数</p>
</li>
<li><p>创建inner函数执行上下文，并压入栈；产生AO对象：iAO；查找形参：无；查找变量声明：无；查找函数声明：无；<strong>创建作用域链：</strong>因为inner函数[[scope]]为[tAO，GO]，所以作用域链为[iAO，tAO，GO]</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E9%97%AD%E5%8C%85-9.png" class></li>
<li><p>inner函数执行上下文创建完毕，开始执行代码console.log(i)。JS引擎会顺着作用域链查找变量，在tAO中找到，输出打印0</p>
</li>
<li><p>inner函数执行完毕，从执行栈中弹出并销毁，对应的iAO被释放</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/%E9%97%AD%E5%8C%85-10.png" class></li>
</ol>
<p>这就是<code>闭包</code>。百度百科上的解释是：<code>闭包就是能够读取其他函数内部变量的函数</code>。按照这样的解释，我们上面代码中的inner函数就是闭包。由于在javascript中，只有函数内部的子函数才能读取局部变量，所以说，闭包可以简单理解成“定义在一个函数内部的函数”。所以在本质上，<code>闭包是将函数内部和函数外部连接起来的桥梁</code>。</p>

        <h2 id="2-作用">
          <a href="#2-作用" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-作用" class="headerlink" title="2.作用"></a>2.作用</h2>
      <p>闭包最大的作用有两个：</p>
<ol>
<li><p>可以让<strong>外部环境</strong>读取到函数内部的变量</p>
<p>刚刚的例子中，我们在全局执行上下文中，可以读取到test函数内的变量i。</p>
</li>
<li><p>可以让这些变量的值始终保存在内存中，延长它们的生命周期</p>
<p>刚刚的例子中，变量i始终没有被释放。</p>
</li>
</ol>

        <h2 id="3-问题">
          <a href="#3-问题" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-问题" class="headerlink" title="3.问题"></a>3.问题</h2>
      <p>凡事都有两面性，闭包带来好处的同时，必然会带来一些问题。其实我们刚刚讲到的闭包作用之一：延迟局部变量的生命周期。这就容易导致<strong>内存泄漏</strong>，将不必要的局部变量保存在内存当中。</p>
<p>解决方案：在不使用局部变量后将其释放。如果是刚刚的例子，可以在代码最后加上<code>a = null</code>释放掉。</p>

        <h2 id="4-总结">
          <a href="#4-总结" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-总结" class="headerlink" title="4.总结"></a>4.总结</h2>
      <p>在这一章节中，我们介绍了闭包的概念、作用和带来的问题。我们总结一下闭包形成的条件：</p>
<ol>
<li><p>函数嵌套</p>
<p>上面的例子中，test函数嵌套了inner函数，test函数称为<code>外部函数</code>，inner函数称为<code>内部函数</code>。为什么需要返回一个函数？因为函数是个对象，如果返回的仅仅是原始数据类型，变量a只会简单复制返回的值，而不是对一个对象的引用。</p>
</li>
<li><p>内部函数使用了外部函数的变量</p>
<p>闭包的目的就是为了让外部环境读取到函数内部的变量，如果内部函数不使用外部函数的变量，那返回内部函数也没有意义。</p>
</li>
<li><p>内部函数需要被外部环境引用</p>
<p>如果不被引用，内部函数将在外部函数运行完被释放。</p>
</li>
</ol>
<p>练习：</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一题</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> bar = foo();</span><br><span class="line">bar();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第二题</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(a++)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> bar = foo();</span><br><span class="line">bar();</span><br><span class="line">bar();</span><br><span class="line">bar();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 第三题</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(i++)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> c = b()</span><br><span class="line">    c()</span><br><span class="line">&#125;</span><br><span class="line">a()</span><br></pre></td></tr></table></div></figure>




        <h1 id="四-ES5标准下的执行上下文">
          <a href="#四-ES5标准下的执行上下文" class="heading-link"><i class="fas fa-link"></i></a><a href="#四-ES5标准下的执行上下文" class="headerlink" title="四.ES5标准下的执行上下文"></a>四.ES5标准下的执行上下文</h1>
      <p>从ES5标准开始，执行上下文与ES3有了很大的变化，最大的改变就是去除了变量对象的概念，以<strong>词法环境组件</strong>和<strong>变量环境组件</strong>替代。</p>
<p>在ES5中执行上下文创建阶段主要做三件事：</p>
<ul>
<li>创建词法环境组件</li>
<li>创建变量环境组件</li>
<li>绑定this</li>
</ul>
<p>接下来我们聊一聊这些新名词。</p>

        <h2 id="1-词法环境-变量环境">
          <a href="#1-词法环境-变量环境" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-词法环境-变量环境" class="headerlink" title="1.词法环境/变量环境"></a>1.词法环境/变量环境</h2>
      
        <h3 id="1-词法环境">
          <a href="#1-词法环境" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-词法环境" class="headerlink" title="(1) 词法环境"></a>(1) 词法环境</h3>
      <p>词法环境（Lexical Environment），是一种持有<strong>标志符—变量的映射</strong>的结构（标志符就是指变量/函数名，变量是对实际对象或原始数据的引用）。看不懂没关系，我们先继续。</p>
<p>词法环境的内部有两个组件：</p>
<ul>
<li>环境记录器（Environment Record）：是存储变量和函数声明的实际位置</li>
<li>外部环境的引用（outer）：意味着它可以访问其父级词法环境</li>
</ul>
<p>如果用伪代码看起来是这样的：</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LexicalEnvironment: &#123;		<span class="comment">// 词法环境</span></span><br><span class="line">    <span class="attr">EnvironmentRecord</span>: &#123;&#125;,	<span class="comment">// 环境记录器</span></span><br><span class="line">    <span class="attr">outer</span>: &lt;<span class="literal">null</span>&gt;			<span class="comment">// 外部环境的引用</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>这么一看，词法环境中的环境记录器像不像我们ES3中的变量对象，因为它们的作用是一样的。如果用图像表示，大概就像这样：</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/ES5-%E8%AF%8D%E6%B3%95%E7%8E%AF%E5%A2%83.png" class>

<p>另外，我们会发现在ES5规范的执行上下文的创建阶段，没有了ES3时候的创建作用域链，这其实是将作用域链的概念转移到了outer中。</p>

        <h3 id="2-变量环境">
          <a href="#2-变量环境" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-变量环境" class="headerlink" title="(2) 变量环境"></a>(2) 变量环境</h3>
      <p>变量环境（Variable Environment），它也是一个<strong>词法环境</strong>，所以它有着词法环境的所有特性，包括环境记录器和对外部环境的引用。</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">VariableEnvironment: &#123;		<span class="comment">// 变量环境</span></span><br><span class="line">    <span class="attr">EnvironmentRecord</span>: &#123;&#125;,	<span class="comment">// 环境记录器</span></span><br><span class="line">    <span class="attr">outer</span>: &lt;<span class="literal">null</span>&gt;			<span class="comment">// 外部环境的引用</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>既然它就是一个词法环境，为什么要单独提出一个变量环境的概念呢？之所以在ES5的规范里要单独分出一个变量环境的概念是为ES6服务的：在ES6中词法环境用来存储<strong>let、const变量声明</strong>，而变量环境用来存储<strong>var变量声明</strong>和<strong>函数声明</strong>。如果用图像表示，大概这样：</p>
<blockquote>
<p>在ES5中，还没有let、const声明，以及待会要讲到的块级作用域，在ES6中它们才出现。但是这些概念已经提出来了，ES5中执行上下文的很多内容其实是在为ES6服务。</p>
</blockquote>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/ES5-%E5%8F%98%E9%87%8F%E7%8E%AF%E5%A2%83.png" class>




        <h3 id="3-环境记录器">
          <a href="#3-环境记录器" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-环境记录器" class="headerlink" title="(3) 环境记录器"></a>(3) 环境记录器</h3>
      <p>环境记录器（Environment Record），它是存储变量和函数声明的实际位置。</p>
<p>在全局环境和函数环境中，环境记录器又有所区别，它有两种类型：</p>
<ul>
<li>对象环境记录器（在全局环境中）</li>
<li>声明式环境记录器（在函数环境中）</li>
</ul>
<p>声明式环境记录器相比对象环境记录器，还包含一个传递给函数的<code>arguments</code>对象和传递给函数的<code>参数的length</code>。</p>

        <h3 id="4-外部环境的引用">
          <a href="#4-外部环境的引用" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-外部环境的引用" class="headerlink" title="(4) 外部环境的引用"></a>(4) 外部环境的引用</h3>
      <p>外部环境的引用（outer），它的作用是访问父级词法环境。</p>
<ul>
<li>在全局执行上下文中，该值为null</li>
<li>在函数执行上下文中，该值为全局对象，或者为父级词法环境（作用域）</li>
</ul>

        <h2 id="2-执行上下文的生命周期">
          <a href="#2-执行上下文的生命周期" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-执行上下文的生命周期" class="headerlink" title="2.执行上下文的生命周期"></a>2.执行上下文的生命周期</h2>
      <p>ES5标准中执行上下文的执行阶段和销毁阶段与ES3基本无异，故重点还是关注创建阶段。</p>
<ul>
<li>全局执行上下文的创建阶段，JS引擎会做这些事情：</li>
</ul>
<ol>
<li><p>创建词法环境，对外部环境的引用为<code>null</code></p>
<ol>
<li>查找<strong>顶级</strong>let、const变量声明，存入词法环境的环境记录器，但<strong>不初始化</strong></li>
</ol>
</li>
<li><p>创建变量环境，对外部环境的引用为<code>null</code></p>
<ol>
<li>查找<strong>非函数内</strong>的var声明，存入变量环境的环境记录器，初始化为undefined</li>
<li>查找<strong>顶级</strong>函数声明，存入变量环境的环境记录器，初始化为function</li>
<li>查找<strong>代码块</strong>中的<strong>与上述几条非重名</strong>的函数声明，存入变量环境的环境记录器，初始化为undefined</li>
</ol>
</li>
<li><p>绑定this（这点在本文中不介绍）</p>
</li>
</ol>
<ul>
<li>函数执行上下文的创建阶段，JS引擎会做这些事情：</li>
</ul>
<ol>
<li><p>创建词法环境，对外部环境的引用为<code>父级词法环境</code></p>
<ol>
<li>查找<strong>函数内非块中</strong>的let、const变量声明，存入词法环境的环境记录器，但<strong>不初始化</strong></li>
</ol>
</li>
<li><p>创建变量环境，对外部环境的引用为<code>父级词法环境</code></p>
<ol>
<li>查找<strong>函数内</strong>的var声明，存入变量环境的环境记录器，初始化为undefined</li>
<li>查找形参，存入变量环境的环境记录器，并将实参赋值给形参</li>
<li>查找<strong>函数内非块中</strong>的函数声明，存入变量环境的环境记录器，初始化为function</li>
<li>查找<strong>代码块</strong>中的<strong>与上述几条非重名</strong>的函数声明，存入变量环境的环境记录器，初始化为undefined</li>
</ol>
</li>
<li><p>绑定this（这点在本文中不介绍）</p>
</li>
</ol>
<p><strong>注意：</strong></p>
<ol>
<li><p>函数执行上下文和全局执行上下文的最主要区别就是对形参的处理，其他都是一致的。</p>
</li>
<li><p>let、const声明的变量，是不初始化的。所以下面的代码会报错。之所以说let、const声明的变量没有变量提升，就是这个原因。</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(a);</span><br><span class="line"><span class="keyword">let</span> a;</span><br></pre></td></tr></table></div></figure>

<p>但是，如果两行代码如果换一下位置，是不会报错的。这是因为在执行上下文的执行阶段，当JS引擎运行到<code>let a</code>这行代码，发现a未初始化，就会初始化为undefined。</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> a;</span><br><span class="line"><span class="built_in">console</span>.log(a);		<span class="comment">// undefined</span></span><br></pre></td></tr></table></div></figure></li>
<li><p>不允许同一作用域下出现和let、const声明的变量同名的变量或函数，否则会报错。</p>
</li>
<li><p>在执行上下文的创建阶段过程中，我非常强调<code>顶级、非函数内、代码块、函数内非块中</code>等词语，这是因为let、const声明的变量存在<strong>块级作用域</strong>的概念，而var声明的变量并没有，而对代码块中的函数声明和非代码块中的函数声明，JS引擎又有不同的处理方式。这些内容我将在下一小节中讲解。</p>
</li>
</ol>

        <h2 id="3-块级作用域">
          <a href="#3-块级作用域" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-块级作用域" class="headerlink" title="3.块级作用域"></a>3.块级作用域</h2>
      
        <h3 id="1-概念-2">
          <a href="#1-概念-2" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-概念-2" class="headerlink" title="(1) 概念"></a>(1) 概念</h3>
      <p>从ES6开始，加入了块级作用域。从代码编写的角度来看，块级作用域可以这么理解：</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/ES5-%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F.jpg" class>

<p>蓝色框表示的就是块级作用域。用<code>&#123;&#125;</code>包裹起来的代码称之为<code>代码块</code>，每个代码块都有一个块级作用域。</p>

        <h3 id="2-let、const变量">
          <a href="#2-let、const变量" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-let、const变量" class="headerlink" title="(2) let、const变量"></a>(2) let、const变量</h3>
      <p>我们知道var声明的变量是没有块级作用域的概念的，而let、const声明的变量存在块级作用域。为了更好理解let和var的不同，我们可以看下面这个例子：</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a = <span class="string">&#x27;global a&#x27;</span>;</span><br><span class="line"><span class="keyword">let</span> b = <span class="string">&#x27;global b&#x27;</span>;</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">let</span> b = <span class="string">&#x27;block b&#x27;</span>;</span><br><span class="line">    <span class="keyword">var</span> c = <span class="string">&#x27;block c&#x27;</span>;</span><br><span class="line">    <span class="keyword">let</span> d = <span class="string">&#x27;block d&#x27;</span>;</span><br><span class="line">    <span class="built_in">console</span>.log(a);</span><br><span class="line">    <span class="built_in">console</span>.log(b);</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(b);</span><br><span class="line"><span class="built_in">console</span>.log(c);</span><br><span class="line"><span class="built_in">console</span>.log(d);</span><br></pre></td></tr></table></div></figure>

<p>为了方便理解和观看，我将不再细分环境记录器和外部环境的引用，直接将词法环境当做整体来使用。</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/ES5-%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F-1.png" class>

<p>同样用画图来表示上面的代码：</p>
<ol>
<li><p>创建全局执行上下文，并压入栈。</p>
</li>
<li><p>创建词法环境，查找<strong>顶级</strong>const、let变量声明。</p>
<p>所谓顶级的const、let变量声明，指的是<code>不在代码块中且不在函数中</code>的const、let变量声明。</p>
<p>找到变量b，加入词法环境，但<strong>不初始化</strong>。</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/ES5-%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F-2.png" class></li>
<li><p>创建变量环境，查找<strong>非函数</strong>内的var变量声明。</p>
<p>因为var变量没有块级作用域的概念，所以无论是否在代码块中声明，都需要找出来。</p>
<p>找到变量a、c，加入变量环境，初始化为undefined。</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/ES5-%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F-3.png" class></li>
<li><p>没有函数声明。全局执行上下文创建完毕，开始执行代码。</p>
</li>
<li><p>执行<code>var a = &quot;global a&quot;</code>和<code>let b = &quot;global b&quot;</code>。</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/ES5-%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F-4.png" class></li>
<li><p>继续执行代码，这时遇到了代码块。</p>
<p><strong>注意：</strong></p>
<ul>
<li><p>执行代码块是<strong>不创建</strong>执行上下文的！</p>
</li>
<li><p>JS引擎会将代码块中声明的let、const变量和函数存储在一个单独的区域。这块特殊区域就可以理解成<strong>块级作用域</strong>。</p>
</li>
<li><p>当代码块中的代码执行完，如果不存在外部引用，这块区域将<strong>被释放</strong>。</p>
</li>
<li><p>块级作用域也是一个词法环境。</p>
</li>
</ul>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/ES5-%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F-5.png" class></li>
<li><p>查找代码块中的let、const变量声明。</p>
<p>找到变量b、d，加入到块级作用域，但不初始化。</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/ES5-%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F-6.png" class></li>
<li><p>没有函数声明。继续执行代码。</p>
</li>
<li><p>执行完<code>let b = &quot;block b&quot;</code>，执行<code>var c = &quot;block c&quot;</code>。</p>
<p><strong>注意：</strong></p>
<ul>
<li>在一个执行上下文中，JS引擎的访问顺序是从词法环境到变量环境。</li>
<li>当执行到代码块中的语句时，则从块级作用域到词法环境再到变量环境。</li>
<li>如果存在代码块嵌套，则从最内部代码块生成的块级作用域到上一层代码块生成的块级作用域，一直到变量环境。</li>
<li>当代码块执行完毕，当前执行上下文将不再访问该块级作用域。</li>
</ul>
<p>在变量环境中找到变量c并赋值。</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/ES5-%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F-7.png" class></li>
<li><p>继续执行<code>let d = &quot;block d&quot;</code>。</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/ES5-%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F-8.png" class></li>
<li><p>然后开始输出打印，按照上面所说的访问顺序查找变量a、b，输出打印<code>global a</code>和<code>block b</code>。</p>
</li>
<li><p>代码块执行完毕，由于不存在外部引用，块级作用域被释放。</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/ES5-%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F-9.png" class></li>
<li><p>继续执行<code>console.log(b)</code>，输出打印<code>global b</code>。执行<code>console.log(c)</code>，输出打印<code>block c</code>。执行<code>console.log(d)</code>，由于找不到d，所以这一步会报错。最终结果：</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/ES5-%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F-10.png" class></li>
</ol>

        <h3 id="3-块级作用域中的函数声明">
          <a href="#3-块级作用域中的函数声明" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-块级作用域中的函数声明" class="headerlink" title="(3) 块级作用域中的函数声明"></a>(3) 块级作用域中的函数声明</h3>
      <p>JS引擎在创建执行上下文时，对于代码块中的函数声明和非代码块中的函数声明有不同的处理方式：</p>
<ul>
<li><p>非代码块中的函数声明：</p>
<p>将函数名添加到变量环境，并初始化为function。</p>
</li>
<li><p>代码块中的函数声明：</p>
<p>如果当前执行上下文中的词法环境和变量环境中存在同名变量或函数，则<strong>不进行任何操作</strong>。否则，将函数名添加到变量环境，并初始化为<strong>undefined</strong>。</p>
</li>
</ul>
<p>我们用几个例子演示一下：</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例1</span></span><br><span class="line"><span class="built_in">console</span>.log(test);	<span class="comment">// 输出的是undefined</span></span><br><span class="line"><span class="keyword">var</span> test = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例2</span></span><br><span class="line"><span class="built_in">console</span>.log(test);	<span class="comment">// 报错，test未初始化</span></span><br><span class="line"><span class="keyword">let</span> test = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例3</span></span><br><span class="line"><span class="built_in">console</span>.log(test);	<span class="comment">// 输出的是代码块外面的函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例4</span></span><br><span class="line"><span class="built_in">console</span>.log(test);	<span class="comment">// 输出的是undefined</span></span><br><span class="line"><span class="keyword">if</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>接着在执行上下文的执行阶段，当执行到代码块时，查找代码块中的函数声明，添加到块级作用域，并初始化为function。当代码块执行完，查找<strong>变量环境</strong>中是否存在同名变量，如果存在，让它<strong>引用该函数对象</strong>。</p>
<p>用画图的方式解释一下：</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">    <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">test();</span><br></pre></td></tr></table></div></figure>

<ol>
<li><p>创建全局执行上下文并压入栈。</p>
</li>
<li><p>创建词法环境，查找顶级let、const声明的变量：无。</p>
</li>
<li><p>创建变量环境，查找非函数体内var声明的变量：无。查找函数声明：找到块中的test函数，由于处于代码块当中，所以将函数名添加到变量环境中，并初始化为undefined。</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/ES5-%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F-11.png" class></li>
<li><p>全局执行上下文创建完毕，开始执行代码。</p>
</li>
<li><p>执行到代码块，生成块作用域。查找代码块中的let、const声明：i，但不初始化；查找函数声明，找到test函数，初始化为function。</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/ES5-%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F-12.png" class></li>
<li><p>继续执行代码<code>let i = 0</code>。</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/ES5-%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F-13.png" class></li>
<li><p>代码块执行完毕，查找变量环境中是否存在test变量，存在则让其引用test函数对象。</p>
<p>注意：由于函数创建时会保存当时的执行环境，所以test函数体内存在对if块作用域的引用，而变量环境中的test又引用了test函数对象，所以即使这个代码块执行完，if块作用域也不会被释放。这就和我们上面讲闭包时一样。</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/ES5-%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F-14.png" class></li>
<li><p>继续执行代码，调用test函数。</p>
<p>注意：代码块执行完后，全局上下文就不能访问块级作用域了，所以这个test函数是变量环境中的test函数，而不是if块作用域中的test函数。</p>
</li>
<li><p>创建test函数执行上下文，并压入栈。</p>
</li>
<li><p>…（test函数执行上下文创建过程省略）</p>
<img src="/2022/02/20/%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E3%80%81%E4%BD%9C%E7%94%A8%E5%9F%9F%E9%93%BE%E5%92%8C%E9%97%AD%E5%8C%85/ES5-%E5%9D%97%E7%BA%A7%E4%BD%9C%E7%94%A8%E5%9F%9F-15.png" class></li>
<li><p>开始执行代码<code>console.log(i)</code>，在if块作用域中找到变量i，输出打印<code>0</code>。</p>
</li>
<li><p>…（test函数执行上下文销毁阶段省略）</p>
</li>
</ol>
<p>有兴趣的可以同样用画图的方式，理解一下以下代码：</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 示例1</span></span><br><span class="line"><span class="built_in">console</span>.log(test);	<span class="comment">// 输出的是undefined</span></span><br><span class="line"><span class="keyword">var</span> test = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(test);	<span class="comment">// 输出的是function</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例2</span></span><br><span class="line"><span class="keyword">let</span> test = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(test);	<span class="comment">// 输出的是0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 示例3</span></span><br><span class="line"><span class="built_in">console</span>.log(test);	<span class="comment">// 输出的是代码块外面的函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="literal">true</span>)&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(test);	<span class="comment">// 输出的是代码块内部的函数</span></span><br></pre></td></tr></table></div></figure>




        <h2 id="4-总结-1">
          <a href="#4-总结-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-总结-1" class="headerlink" title="4.总结"></a>4.总结</h2>
      <p>我们会发现，ES5标准的执行上下文与ES3标准并无太多区别，只是用词法环境/变量环境去替代了变量对象，多了一个针对let、const声明的变量的处理，以及块级作用域的处理。在ES5标准中，可以将作用域理解成词法环境。</p>
<p>随着ES标准的不断更新，执行上下文的内容也在发生变化，比如：在最新的ES6标准中，词法环境用于存储<strong>函数声明</strong>和const、let声明的变量，而变量环境只存储var声明的变量；而ES9中的执行上下文又与上文有所区别。感兴趣的可以自行了解。以上内容仅供理解，如有错误，欢迎指正。</p>

        <h1 id="五-Q-amp-A">
          <a href="#五-Q-amp-A" class="heading-link"><i class="fas fa-link"></i></a><a href="#五-Q-amp-A" class="headerlink" title="五.Q&amp;A"></a>五.Q&amp;A</h1>
      <ol>
<li><p>作用域和执行上下文有什么区别？</p>
<p>答：我个人认为这两个是包含关系，执行上下文中包含了作用域，同时还有其他像this绑定等内容。</p>
</li>
<li><p>什么是作用域？</p>
<p>答：根据不同的标准，对作用域的理解是不同的，ES3的标准中，作用域可以理解为变量对象；而在ES5标准中，作用域可以理解为词法环境。</p>
</li>
<li><p>函数的作用域链是什么时候建立的？</p>
<p>答：我认为，函数没有作用域链的概念，作用域链是执行上下文中的内容。而函数只有一个[[scope]]属性，它在函数创建的时候就保存了当时的执行环境。当函数被调用时，函数执行上下文会根据[[scope]]创建作用域链。这个问题中的作用域链，应该指的是函数[[scope]]属性，它是在函数创建的时候建立的。</p>
</li>
</ol>
<blockquote>
<p>参考视频：</p>
<p>ES3标准：<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1C54y1r7VS">https://www.bilibili.com/video/BV1C54y1r7VS</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>ES5标准：<span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1wD4y1D7Pp">https://www.bilibili.com/video/BV1wD4y1D7Pp</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p>参考文章：</p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://www.cnblogs.com/echolun/p/11438363.html">https://www.cnblogs.com/echolun/p/11438363.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://juejin.cn/post/7043408377661095967">https://juejin.cn/post/7043408377661095967</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://blog.csdn.net/feral_coder/article/details/106447013">https://blog.csdn.net/feral_coder/article/details/106447013</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://www.zhihu.com/question/36751764">https://www.zhihu.com/question/36751764</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2009/08/learning_javascript_closures.html">http://www.ruanyifeng.com/blog/2009/08/learning_javascript_closures.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000018605776">https://segmentfault.com/a/1190000018605776</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</blockquote>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2022/01/31/git/">git</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2022-01-31</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2022-02-21</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="1-本地库初始化">
          <a href="#1-本地库初始化" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-本地库初始化" class="headerlink" title="1.本地库初始化"></a>1.本地库初始化</h1>
      <ul>
<li><strong>命令：</strong></li>
</ul>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></div></figure>

<ul>
<li><strong>注意：</strong>.git目录中存放的是本地库相关的子目录和文件</li>
</ul>

        <h1 id="2-设置签名">
          <a href="#2-设置签名" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-设置签名" class="headerlink" title="2.设置签名"></a>2.设置签名</h1>
      <ul>
<li><p><strong>形式：</strong></p>
<p>用户名：xxx</p>
<p>Email地址：<span class="exturl"><a class="exturl__link" href="mailto:&#x78;&#x78;&#x78;&#64;&#120;&#120;&#x2e;&#120;&#x78;&#x78;">&#x78;&#x78;&#x78;&#64;&#120;&#120;&#x2e;&#120;&#x78;&#x78;</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</li>
<li><p><strong>作用：</strong>区分不同开发人员的身份</p>
</li>
<li><p><strong>辨析：</strong>这里设置的签名和登录远程库（代码托管中心）的账号、密码没有任何关系</p>
</li>
<li><p><strong>命令：</strong></p>
</li>
</ul>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 项目级别/仓库级别：仅在当前本地库范围内有效</span></span><br><span class="line">git config user.name xxx</span><br><span class="line">git config user.email xxx@xx.xxx</span><br><span class="line"><span class="meta">#</span><span class="bash"> 用户级别：登录当前操作系统的用户范围</span></span><br><span class="line">git config --global user.name xxx</span><br><span class="line">git config --global user.email xxx@xx.xxx</span><br><span class="line"><span class="meta">#</span><span class="bash"> 优先级：就近原则（项目级别 &gt; 用户级别）</span></span><br></pre></td></tr></table></div></figure>


        <h1 id="3-添加提交以及查看状态">
          <a href="#3-添加提交以及查看状态" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-添加提交以及查看状态" class="headerlink" title="3.添加提交以及查看状态"></a>3.添加提交以及查看状态</h1>
      <ul>
<li><strong>命令：</strong></li>
</ul>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看状态</span></span><br><span class="line">git status</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将工作区的新建/修改 添加至 暂存区</span></span><br><span class="line">git add [file name]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 从暂存区撤回</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> git rm --cached [file name]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将暂存区内容 提交至 本地库</span></span><br><span class="line">git commit -m &quot;commit message&quot; [file name]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 对于已追踪的文件，可以直接添加至本地库</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> git commit -a</span></span><br></pre></td></tr></table></div></figure>


        <h1 id="4-版本前进-后退">
          <a href="#4-版本前进-后退" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-版本前进-后退" class="headerlink" title="4.版本前进/后退"></a>4.版本前进/后退</h1>
      <ul>
<li><strong>命令：</strong></li>
</ul>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看版本记录</span></span><br><span class="line">git log</span><br><span class="line"><span class="meta">#</span><span class="bash"> 简要显示版本记录</span></span><br><span class="line">git log --pretty=oneline</span><br><span class="line">git log --oneline</span><br><span class="line">git reflog</span><br><span class="line"><span class="meta">#</span><span class="bash"> 前进/后退 基于索引值操作（推荐）</span></span><br><span class="line">git reset --hard [hash]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 后退 使用^/~符号</span></span><br><span class="line">git reset --hard HEAD^	# 后退1步，n个^后退n个版本</span><br><span class="line">git reset --hard HEAD~n # 后退n步</span><br></pre></td></tr></table></div></figure>

<ul>
<li><p><strong>reset命令的三个参数对比：</strong></p>
<p><code>--soft</code>：</p>
<p>​    仅仅在本地库移动HEAD指针</p>
<p><code>--mixed</code>：</p>
<p>​    在本地库移动HEAD指针并且重置暂存区</p>
<p><code>--hard</code>：</p>
<p>​    在本地库移动HEAD指针、重置暂存区并且重置工作区</p>
</li>
</ul>

        <h1 id="5-文件差异">
          <a href="#5-文件差异" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-文件差异" class="headerlink" title="5.文件差异"></a>5.文件差异</h1>
      <ul>
<li><strong>命令：</strong></li>
</ul>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git diff [file name] # 默认将工作区文件和暂存区进行比较</span><br><span class="line">git diff [版本记录] [file name] # 将工作区文件和本地库历史记录进行比较</span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果不带文件名可以比较多个文件</span></span><br></pre></td></tr></table></div></figure>


        <h1 id="6-分支">
          <a href="#6-分支" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-分支" class="headerlink" title="6.分支"></a>6.分支</h1>
      <ul>
<li><strong>作用：</strong><ol>
<li>同时并行推进多个功能开发，提高开发效率</li>
<li>各个分支在开发过程中，如果某一个分支开发失败，不会对其他分支有任何影响</li>
</ol>
</li>
<li><strong>命令：</strong></li>
</ul>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看所有分支</span></span><br><span class="line">git branch -v</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建分支</span></span><br><span class="line">git branch [branch name]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换分支</span></span><br><span class="line">git checkout [branch name]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 合并分支</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 先切换到接受修改的分支，再执行merge操作</span></span><br><span class="line">git checkout [接受修改的分支名]</span><br><span class="line">git merge [需要合并的分支名]</span><br></pre></td></tr></table></div></figure>

<ul>
<li><strong>冲突：</strong></li>
</ul>
<p><strong>表现：</strong></p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class="line"><span class="comment">// 当前分支内容</span></span><br><span class="line">=======</span><br><span class="line"><span class="comment">// 另一个分支内容</span></span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br></pre></td></tr></table></div></figure>

<p><strong>解决：</strong></p>
<ol>
<li>编辑文件，删除特殊符号</li>
<li>修改文件至需要的地步</li>
<li>git add [文件名]</li>
<li>git commit -m “日志信息”</li>
</ol>
<p>​        注意：此时commit不能带具体文件名</p>

        <h1 id="7-推送到远程库">
          <a href="#7-推送到远程库" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-推送到远程库" class="headerlink" title="7.推送到远程库"></a>7.推送到远程库</h1>
      <ul>
<li><strong>命令：</strong></li>
</ul>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 本地创建远程库别名</span></span><br><span class="line">git remote add [远程主机名] [远程库地址]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 推送到远程库</span></span><br><span class="line">git push [远程主机名] [本地分支]:[远程分支]</span><br></pre></td></tr></table></div></figure>


        <h1 id="8-克隆">
          <a href="#8-克隆" class="heading-link"><i class="fas fa-link"></i></a><a href="#8-克隆" class="headerlink" title="8.克隆"></a>8.克隆</h1>
      <ul>
<li><strong>命令：</strong></li>
</ul>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone [远程库地址]</span><br></pre></td></tr></table></div></figure>

<ul>
<li><strong>效果：</strong><ol>
<li>完整地把远程库下载到本地</li>
<li>创建origin远程地址别名</li>
<li>初始化本地库</li>
</ol>
</li>
</ul>

        <h1 id="9-拉取">
          <a href="#9-拉取" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-拉取" class="headerlink" title="9.拉取"></a>9.拉取</h1>
      <ul>
<li><strong>命令：</strong></li>
</ul>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 抓取远程更新</span></span><br><span class="line">git fetch [远程主机名] [远程分支]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 合并分支</span></span><br><span class="line">git merge [远程主机名/远程分支]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 上面两步等同于</span></span><br><span class="line">git pull [远程主机名] [远程分支]:[本地分支]</span><br></pre></td></tr></table></div></figure>

<ul>
<li><strong>注意：</strong>抓取更新并不会修改本地工作区内容</li>
</ul>
<blockquote>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://www.runoob.com/git/git-basic-operations.html">https://www.runoob.com/git/git-basic-operations.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</blockquote>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2022/01/29/ES6%E6%A8%A1%E5%9D%97%E4%B8%8ECommonJS%E6%A8%A1%E5%9D%97%E7%9A%84%E5%8C%BA%E5%88%AB/">ES6模块与CommonJS模块的区别</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2022-01-29</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2022-02-21</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="1-写法不同">
          <a href="#1-写法不同" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-写法不同" class="headerlink" title="1.写法不同"></a>1.写法不同</h1>
      <p>最直观的，两者对于模块的导入导出写法不同</p>
<ul>
<li>ES6</li>
</ul>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 导出 */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> a = <span class="number">10</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> b = <span class="number">20</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 导入 */</span></span><br><span class="line"><span class="keyword">import</span> &#123;a, b&#125; <span class="keyword">from</span> <span class="string">&#x27;./test.js&#x27;</span></span><br><span class="line"><span class="keyword">import</span> c <span class="keyword">from</span> <span class="string">&#x27;./test.js&#x27;</span></span><br></pre></td></tr></table></div></figure>

<ul>
<li>CommonJS</li>
</ul>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 导出 */</span></span><br><span class="line"><span class="built_in">module</span>.exports=&#123;<span class="attr">a</span>:<span class="number">10</span>, <span class="attr">b</span>:<span class="number">20</span>&#125;	</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 导入 */</span></span><br><span class="line"><span class="keyword">let</span> test = <span class="built_in">require</span>(<span class="string">&#x27;./test.js&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(test.a, test.b) <span class="comment">// 输出 10 20</span></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>注意：上述CommonJS导出写法会改变原本指向的内存，使其与exports指向不同内存空间，语法非本篇重点，可看这篇博客</p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://www.cnblogs.com/fightjianxian/p/12151010.html">https://www.cnblogs.com/fightjianxian/p/12151010.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</blockquote>

        <h1 id="2-加载阶段不同">
          <a href="#2-加载阶段不同" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-加载阶段不同" class="headerlink" title="2.加载阶段不同"></a>2.加载阶段不同</h1>
      <ul>
<li>CommonJS模块加载的是对象（即<code>module.exports</code>属性），它只有在脚本运行完才会生成，所以是<code>运行时加载</code></li>
<li>而ES6模块不是对象，它的对外接口是一种静态定义，在代码静态解析阶段就会生成，所以是<code>编译时输出接口</code></li>
</ul>

        <h1 id="3-输出内容不同">
          <a href="#3-输出内容不同" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-输出内容不同" class="headerlink" title="3.输出内容不同"></a>3.输出内容不同</h1>
      <ul>
<li>刚刚说了CommonJS模块输出的是一个对象，所以是一个值的拷贝（浅拷贝）</li>
</ul>
<p>请看下面这个例子，模块内有一个变量a和一个自增函数</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 模块test.js */</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    a++</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">a</span>: a,</span><br><span class="line">  <span class="attr">add</span>: add,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 需要引入模块的文件main.js */</span></span><br><span class="line"><span class="keyword">let</span> mod = <span class="built_in">require</span>(<span class="string">&#x27;./test.js&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(mod.a);  <span class="comment">// 1</span></span><br><span class="line">mod.add()</span><br><span class="line"><span class="built_in">console</span>.log(mod.a);  <span class="comment">// 1</span></span><br></pre></td></tr></table></div></figure>

<p>上述代码说明，<code>test.js</code>模块加载以后，它内部的变化影响不到已经输出的<code>mod.a</code>了，因为a会被缓存（a是一个简单数据类型，导出时直接拷贝值）。除非写成一个函数，才能获得内部变动后的值</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 模块test.js */</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  a++</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="keyword">get</span> <span class="title">a</span>()&#123;</span><br><span class="line">      <span class="keyword">return</span> a</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">add</span>: add,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* 需要引入模块的文件main.js */</span></span><br><span class="line"><span class="keyword">let</span> mod = <span class="built_in">require</span>(<span class="string">&#x27;./test.js&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(mod.a);  <span class="comment">// 1</span></span><br><span class="line">mod.add()</span><br><span class="line"><span class="built_in">console</span>.log(mod.a);  <span class="comment">// 2</span></span><br></pre></td></tr></table></div></figure>

<p>上面代码中，输出的<code>a</code>实际上是一个取值器函数。如果想输出后的<code>a</code>发生改变，可以这样修改</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 模块test.js */</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">this</span>.a++</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">a</span>: a,</span><br><span class="line">  <span class="attr">add</span>: add,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 需要引入模块的文件main.js */</span></span><br><span class="line"><span class="keyword">let</span> mod = <span class="built_in">require</span>(<span class="string">&#x27;./test.js&#x27;</span>)</span><br><span class="line"><span class="built_in">console</span>.log(mod.a);  <span class="comment">// 1</span></span><br><span class="line">mod.add()</span><br><span class="line"><span class="built_in">console</span>.log(mod.a);  <span class="comment">// 2</span></span><br></pre></td></tr></table></div></figure>

<p>这样改变的是输出的对象的<code>a</code>属性，模块内部并未受影响</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 模块test.js */</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.a++;</span><br><span class="line">  <span class="built_in">console</span>.log(a);	<span class="comment">// 1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">a</span>: a,</span><br><span class="line">  <span class="attr">add</span>: add,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* 需要引入模块的文件main.js */</span></span><br><span class="line"><span class="keyword">let</span> mod = <span class="built_in">require</span>(<span class="string">&#x27;./test.js&#x27;</span>)</span><br><span class="line">mod.add()</span><br><span class="line"><span class="built_in">console</span>.log(mod.a);  <span class="comment">// 2</span></span><br></pre></td></tr></table></div></figure>

<p>这或许对你理解<code>CommonJS模块输出的是一个对象</code>有所帮助</p>
<ul>
<li>而ES6模块输出的是值的引用</li>
</ul>
<p>ES6 模块的运行机制与 CommonJS 不一样。JS 引擎对脚本静态分析的时候，遇到模块加载命令<code>import</code>，就会生成一个<code>只读引用</code>。等到脚本真正执行时，再根据这个只读引用，到被加载的那个模块里面去取值。同样的代码</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 模块test.js */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  a++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 需要引入模块的文件main.js */</span></span><br><span class="line"><span class="keyword">import</span> &#123; a, add &#125; <span class="keyword">from</span> <span class="string">&#x27;./test.js&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// 3</span></span><br><span class="line">add();</span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// 4</span></span><br></pre></td></tr></table></div></figure>

<p>上述代码说明ES6模块输出的变量<code>a</code>完全反应其在所在模块内部的变化</p>

        <h1 id="4-加载方式不同">
          <a href="#4-加载方式不同" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-加载方式不同" class="headerlink" title="4.加载方式不同"></a>4.加载方式不同</h1>
      <ul>
<li>CommonJS 模块的<code>require()</code>是同步加载模块</li>
<li>ES6 模块的<code>import</code>命令是异步加载，有一个独立的模块依赖的解析阶段</li>
</ul>
<blockquote>
<p>参考自阮一峰老师的博客</p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://es6.ruanyifeng.com/#docs/module-loader#ES6-%E6%A8%A1%E5%9D%97%E4%B8%8E-CommonJS-%E6%A8%A1%E5%9D%97%E7%9A%84%E5%B7%AE%E5%BC%82">https://es6.ruanyifeng.com/#docs/module-loader#ES6-%E6%A8%A1%E5%9D%97%E4%B8%8E-CommonJS-%E6%A8%A1%E5%9D%97%E7%9A%84%E5%B7%AE%E5%BC%82</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</blockquote>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2022/01/24/webpack/">webpack</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2022-01-24</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2022-02-24</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="一-简介">
          <a href="#一-简介" class="heading-link"><i class="fas fa-link"></i></a><a href="#一-简介" class="headerlink" title="一.简介"></a>一.简介</h1>
      <p>webpack是一个构建工具，是一个静态模块打包器(module bundler)。</p>

        <h1 id="二-Webpack五个核心概念">
          <a href="#二-Webpack五个核心概念" class="heading-link"><i class="fas fa-link"></i></a><a href="#二-Webpack五个核心概念" class="headerlink" title="二.Webpack五个核心概念"></a>二.Webpack五个核心概念</h1>
      
        <h2 id="1-Entry">
          <a href="#1-Entry" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-Entry" class="headerlink" title="1.Entry"></a>1.Entry</h2>
      <p>入口，指示Webpack以哪个文件为入口起点开始打包，分析构建内部依赖图</p>

        <h2 id="2-Output">
          <a href="#2-Output" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-Output" class="headerlink" title="2.Output"></a>2.Output</h2>
      <p>输出，指示Webpack打包后的资源bundles输出到哪里去，以及如何命名。</p>

        <h2 id="3-Loader">
          <a href="#3-Loader" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-Loader" class="headerlink" title="3.Loader"></a>3.Loader</h2>
      <p>Loader让Webpack能够去处理那些非JavaScript文件(webpack自身只能理解JavaScript)</p>

        <h2 id="4-Plugins">
          <a href="#4-Plugins" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-Plugins" class="headerlink" title="4.Plugins"></a>4.Plugins</h2>
      <p>插件可以用执行范围更广的任务。插件的范围包括：从打包优化和压缩，一直到重新定义环境中的变量等。</p>

        <h2 id="5-Mode">
          <a href="#5-Mode" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-Mode" class="headerlink" title="5.Mode"></a>5.Mode</h2>
      <p>模式指示Webpack使用相应模式的配置。</p>
<ul>
<li>development - 开发模式</li>
<li>production - 生产模式</li>
</ul>

        <h1 id="三-学习">
          <a href="#三-学习" class="heading-link"><i class="fas fa-link"></i></a><a href="#三-学习" class="headerlink" title="三.学习"></a>三.学习</h1>
      
        <h2 id="1-初体验">
          <a href="#1-初体验" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-初体验" class="headerlink" title="1.初体验"></a>1.初体验</h2>
      <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">运行指令</span><br><span class="line">开发环境: webpack ./index.js -o ./build/built.js --mode=development</span><br><span class="line">	webpack会以index.js为入口文件开始打包，打包后输出到./build/built.js</span><br><span class="line">	整体打包环境是开发环境</span><br><span class="line">生产环境: webpack ./index.js -o ./build/built.js --mode=production</span><br></pre></td></tr></table></div></figure>

<p>结论：</p>
<ul>
<li>webpack可以处理js/json资源，不能处理css/img等其他资源</li>
<li>生产环境和开发环境能将ES6模块化编译成浏览器能识别的模块化</li>
<li>生产环境比开发环境多一个压缩js代码</li>
</ul>

        <h2 id="2-打包样式资源">
          <a href="#2-打包样式资源" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-打包样式资源" class="headerlink" title="2.打包样式资源"></a>2.打包样式资源</h2>
      <p>webpack.config.js，webpack的配置文件</p>
<p>模块化默认采用commonJS，因为所有构建工具都是基于Nodejs平台运行的</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">module</span>:&#123;</span><br><span class="line">    	<span class="attr">rules</span>:[</span><br><span class="line">            <span class="comment">// 详细loader配置</span></span><br><span class="line">    		&#123;	</span><br><span class="line">                <span class="comment">// 匹配哪些文件</span></span><br><span class="line">                <span class="attr">test</span>:<span class="regexp">/\.css$/</span>,</span><br><span class="line">                <span class="comment">// 使用哪些loader进行处理</span></span><br><span class="line">                use:[</span><br><span class="line">                    <span class="comment">// use数组中loader执行顺序：从右到左(从下到上)依次执行</span></span><br><span class="line">                    <span class="comment">// 创建style标签，将js中的样式资源插入进行，添加到head中生效</span></span><br><span class="line">                    <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">                    <span class="comment">// 将css文件变成commonjs模块加载到js中，里面内容是样式字符串</span></span><br><span class="line">                    <span class="string">&#x27;css-loader&#x27;</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>:<span class="regexp">/\.less$/</span>,</span><br><span class="line">                use:[</span><br><span class="line">                    <span class="string">&#x27;style-loader&#x27;</span>,</span><br><span class="line">                    <span class="string">&#x27;css-loader&#x27;</span>,</span><br><span class="line">                    <span class="comment">// 将less文件编译成css文件</span></span><br><span class="line">                    <span class="string">&#x27;less-loader&#x27;</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">    	]</span><br><span class="line">	&#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="3-打包html资源">
          <a href="#3-打包html资源" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-打包html资源" class="headerlink" title="3.打包html资源"></a>3.打包html资源</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> htmlWebpackPlugin = <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">    <span class="comment">// 复制 &#x27;./src/index.html&#x27;文件，并自动引入打包输出的所有资源(JS/CSS)</span></span><br><span class="line">    <span class="attr">template</span>:<span class="string">&#x27;./src/index.html&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">plugins</span>:[</span><br><span class="line">        htmlWebpackPlugin</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="4-打包图片资源">
          <a href="#4-打包图片资源" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-打包图片资源" class="headerlink" title="4.打包图片资源"></a>4.打包图片资源</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">module</span>:&#123;</span><br><span class="line">    	<span class="attr">rules</span>:[</span><br><span class="line">            &#123;	</span><br><span class="line">                <span class="comment">// 问题：默认处理不了Html中的img图片</span></span><br><span class="line">                <span class="comment">// 处理图片资源</span></span><br><span class="line">                <span class="attr">test</span>:<span class="regexp">/\.(jpg|png|gif)$/</span>,</span><br><span class="line">                <span class="comment">// 只使用一个loader可以直接使用loader:&#x27;&#x27;</span></span><br><span class="line">                loader:<span class="string">&#x27;url-loader&#x27;</span>,</span><br><span class="line">                <span class="attr">options</span>:&#123;</span><br><span class="line">                    <span class="comment">// 图片大小小于8kb，就会被base64处理</span></span><br><span class="line">                    <span class="comment">// 优点:减少请求数量(减轻服务器压力)</span></span><br><span class="line">                    <span class="comment">// 缺点:图片体积会更大(文件请求速度更慢)</span></span><br><span class="line">                    <span class="attr">limit</span>:<span class="number">8</span>*<span class="number">1024</span>,</span><br><span class="line">                    <span class="comment">// 问题:因为url-loader默认使用es6模块化解析，而html-loader引入图片是commonjs，解析时会出问题</span></span><br><span class="line">                    <span class="comment">// 解决：关闭url-loader的es6模块化解析，使用commonjs解析</span></span><br><span class="line">                    <span class="attr">esModule</span>:<span class="literal">false</span>,</span><br><span class="line">                    <span class="comment">// 给图片重命名</span></span><br><span class="line">                    <span class="comment">// [hash:10]取图片hash的前10位</span></span><br><span class="line">                    <span class="comment">// [ext]取文件原来扩展名</span></span><br><span class="line">                    <span class="attr">name</span>:<span class="string">&#x27;[hash:10].[ext]&#x27;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>:<span class="regexp">/\.html$/</span>,</span><br><span class="line">                <span class="comment">// 处理Html文件的img图片(负责引入img,从而能够被url-loader进行处理)</span></span><br><span class="line">                loader:<span class="string">&#x27;html-loader&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">    	]</span><br><span class="line">	&#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="5-打包其他资源">
          <a href="#5-打包其他资源" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-打包其他资源" class="headerlink" title="5.打包其他资源"></a>5.打包其他资源</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">module</span>:&#123;</span><br><span class="line">    	<span class="attr">rules</span>:[</span><br><span class="line">            <span class="comment">// 打包其他资源(除了html/js/css资源以外的资源)</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 排除html/js/css资源以外的资源</span></span><br><span class="line">                <span class="attr">exclude</span>:<span class="regexp">/\.(css|js|html)$/</span>,</span><br><span class="line">                loader:<span class="string">&#x27;file-loader&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">    	]</span><br><span class="line">	&#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>在<code>Webpack5</code>之前通常使用：</p>
<ul>
<li><code>raw-loader</code>将文件导入为字符串</li>
<li><code>url-loader</code>将文件作为data URI内联到bundle中</li>
<li><code>file-loader</code>将文件发送到输出目录</li>
</ul>
<p>而在<code>Webpack5</code>中使用4种新的模块类型来替代这些loader：</p>
<ul>
<li><code>asset/resource</code>：发送一个单独的文件并导出URL。之前使用<code>file-loader</code>实现</li>
<li><code>asset/inline</code>：导出一个资源的data URI。之前使用<code>url-loader</code>实现</li>
<li><code>asset/source</code>：导出资源的源代码。之前使用<code>raw-loader</code>实现</li>
<li><code>asset</code>：导出一个data URI和发送一个单独的文件之间自动选择。之前使用<code>url-loader</code>并配置资源体积限制实现</li>
</ul>
<p>例如：</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack5之前配置图片资源</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="attr">test</span>:<span class="regexp">/\.(jpg|png|gif)$/</span>,</span><br><span class="line">	loader:<span class="string">&#x27;url-loader&#x27;</span>,</span><br><span class="line">	<span class="attr">options</span>:&#123;</span><br><span class="line">		<span class="attr">limit</span>:<span class="number">8</span>*<span class="number">1024</span>,</span><br><span class="line">		<span class="attr">esModule</span>:<span class="literal">false</span>,</span><br><span class="line">		<span class="attr">name</span>:<span class="string">&#x27;[hash:10].[ext]&#x27;</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// webpack5</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="attr">test</span>: <span class="regexp">/\.(jpg|png|gif)$/</span>,</span><br><span class="line">	type: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">	<span class="attr">generator</span>: &#123;</span><br><span class="line">		<span class="attr">filename</span>: <span class="string">&quot;[hash:10].[ext]&quot;</span></span><br><span class="line">	&#125;,</span><br><span class="line">	<span class="attr">parser</span>:&#123;</span><br><span class="line">        <span class="attr">dataUrlCondition</span>:&#123;</span><br><span class="line">            <span class="attr">maxSize</span>: <span class="number">8</span>*<span class="number">1024</span>		<span class="comment">// 设置自动选择临界值</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="6-devServer">
          <a href="#6-devServer" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-devServer" class="headerlink" title="6.devServer"></a>6.devServer</h2>
      <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 需要安装webpack-dev-server</span></span><br><span class="line">npm install webpack-dev-server</span><br></pre></td></tr></table></div></figure>

<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// 作用：自动化(自动编译，自动打开浏览器，自动刷新浏览器......)</span></span><br><span class="line">    <span class="attr">devServer</span>:&#123;</span><br><span class="line">        <span class="comment">// 构建后路径</span></span><br><span class="line">        <span class="attr">static</span>:resolve(__dirname, <span class="string">&#x27;./dist&#x27;</span>),</span><br><span class="line">        <span class="comment">// 启动gzip压缩</span></span><br><span class="line">        <span class="attr">compress</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 端口号</span></span><br><span class="line">        <span class="attr">port</span>:<span class="number">3000</span>,</span><br><span class="line">        <span class="comment">// 自动打开浏览器</span></span><br><span class="line">        <span class="attr">open</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 添加头部信息</span></span><br><span class="line">        <span class="attr">headers</span>:&#123;</span><br><span class="line">            <span class="string">&#x27;x-Access-Token&#x27;</span>:<span class="string">&#x27;xxx&#x27;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 服务器代理</span></span><br><span class="line">        <span class="comment">/* </span></span><br><span class="line"><span class="comment">        	作用：本地调试解决跨域问题</span></span><br><span class="line"><span class="comment">        	假如后端服务运行在http://localhost:9000，请求地址http://localhost:9000/api/hello</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="attr">proxy</span>:&#123;</span><br><span class="line">            <span class="string">&#x27;/api&#x27;</span>: &#123;</span><br><span class="line">                <span class="attr">target</span>:<span class="string">&#x27;http://localhost:9000&#x27;</span>,	<span class="comment">// 开启代理后，请求地址/api/hello -&gt; http://localhost:9000/api/hello</span></span><br><span class="line">                <span class="attr">pathRewrite</span>: &#123;<span class="string">&#x27;^/api&#x27;</span>: <span class="string">&#x27;&#x27;</span>&#125;	<span class="comment">// 如果重写路径，请求地址/api/hello -&gt; http://localhost:9000/hello</span></span><br><span class="line">            &#125;	</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        	如果开发SPA（单页面应用），浏览器在刷新或跳转页面时可能会报错（404）</span></span><br><span class="line"><span class="comment">        	这类单页应用要求服务器在针对任何命中的路由时都返回一个对应的HTML文件</span></span><br><span class="line"><span class="comment">        	配置historyApiFallback可以解决这一问题，这会使得任何请求都会返回根页面</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="attr">historyApiFallback</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 允许局域网内访问</span></span><br><span class="line">        <span class="attr">host</span>:<span class="string">&#x27;0.0.0.0&#x27;</span>,</span><br><span class="line">        <span class="attr">client</span>:&#123;</span><br><span class="line">            <span class="comment">// 取消发生错误时的覆盖层</span></span><br><span class="line">            <span class="attr">overlay</span>:<span class="literal">false</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 执行webpack serve</span></span><br><span class="line">npx webpack serve</span><br></pre></td></tr></table></div></figure>


        <h2 id="7-提取css成单独文件">
          <a href="#7-提取css成单独文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-提取css成单独文件" class="headerlink" title="7.提取css成单独文件"></a>7.提取css成单独文件</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 提取css成单独文件</span></span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> miniCssExtractPlugin = <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">  <span class="attr">filename</span>: <span class="string">&quot;css/[name].css&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">module</span>:&#123;</span><br><span class="line">    	<span class="attr">rules</span>:[</span><br><span class="line">    		&#123;	</span><br><span class="line">                <span class="attr">test</span>:<span class="regexp">/\.css$/</span>,</span><br><span class="line">                use:[</span><br><span class="line">                    <span class="comment">// 这个loader代替style-loader，将js中的css提取成单独文件</span></span><br><span class="line">                    MiniCssExtractPlugin.loader,</span><br><span class="line">                    <span class="string">&#x27;css-loader&#x27;</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">    	]</span><br><span class="line">	&#125;,</span><br><span class="line">    <span class="attr">plugins</span>:[miniCssExtractPlugin],</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="8-css压缩">
          <a href="#8-css压缩" class="heading-link"><i class="fas fa-link"></i></a><a href="#8-css压缩" class="headerlink" title="8.css压缩"></a>8.css压缩</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 提取css成单独文件</span></span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&#x27;mini-css-extract-plugin&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> miniCssExtractPlugin = <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">  <span class="attr">filename</span>: <span class="string">&quot;css/[name].css&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 压缩css文件</span></span><br><span class="line"><span class="keyword">const</span> CssMinimizerWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cssMinimizerWebpackPlugin = <span class="keyword">new</span> CssMinimizerWebpackPlugin();</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">module</span>:&#123;</span><br><span class="line">    	<span class="attr">rules</span>:[</span><br><span class="line">    		&#123;	</span><br><span class="line">                <span class="attr">test</span>:<span class="regexp">/\.css$/</span>,</span><br><span class="line">                use:[</span><br><span class="line">                    MiniCssExtractPlugin.loader,</span><br><span class="line">                    <span class="string">&#x27;css-loader&#x27;</span></span><br><span class="line">                ]</span><br><span class="line">            &#125;,</span><br><span class="line">    	]</span><br><span class="line">	&#125;,</span><br><span class="line">    <span class="attr">plugins</span>:[miniCssExtractPlugin],</span><br><span class="line">    <span class="comment">// 在optimization minimizer中配置</span></span><br><span class="line">    <span class="attr">optimization</span>:&#123;</span><br><span class="line">    	<span class="attr">minimizer</span>:[</span><br><span class="line">    		cssMinimizerWebpackPlugin</span><br><span class="line">    	]</span><br><span class="line">	&#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="9-js的兼容性处理">
          <a href="#9-js的兼容性处理" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-js的兼容性处理" class="headerlink" title="9.js的兼容性处理"></a>9.js的兼容性处理</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></div></figure>

        <h2 id="10-js的语法检查">
          <a href="#10-js的语法检查" class="heading-link"><i class="fas fa-link"></i></a><a href="#10-js的语法检查" class="headerlink" title="10.js的语法检查"></a>10.js的语法检查</h2>
      <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装eslint</span></span><br><span class="line">npx eslint --init</span><br><span class="line"><span class="meta">#</span><span class="bash"> 检查文件是否规范</span></span><br><span class="line">npx eslint ./src</span><br></pre></td></tr></table></div></figure>

<figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .eslintrc.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;env&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;browser&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">&quot;es2021&quot;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;extends&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;airbnb-base&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;parserOptions&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;ecmaVersion&quot;</span>:<span class="number">12</span>,</span><br><span class="line">        <span class="attr">&quot;sourceType&quot;</span>:<span class="string">&quot;module&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;rules&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;no-console&quot;</span>:<span class="number">0</span>	<span class="comment">// 关闭no-console警告</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;globals&quot;</span>:&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">module</span>:&#123;</span><br><span class="line">    	<span class="attr">rules</span>:[</span><br><span class="line">    		&#123;	</span><br><span class="line">                <span class="attr">test</span>:<span class="regexp">/\.(js|jsx)/</span>,</span><br><span class="line">                exclude:<span class="regexp">/node_modules/</span>,</span><br><span class="line">                use:[<span class="string">&#x27;babel-loader&#x27;</span>,<span class="string">&#x27;eslint-loader&#x27;</span>]</span><br><span class="line">            &#125;,</span><br><span class="line">    	]</span><br><span class="line">	&#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="11-html和js的压缩">
          <a href="#11-html和js的压缩" class="heading-link"><i class="fas fa-link"></i></a><a href="#11-html和js的压缩" class="headerlink" title="11.html和js的压缩"></a>11.html和js的压缩</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> htmlWebpackPlugin = <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">    <span class="attr">template</span>:<span class="string">&#x27;./src/index.html&#x27;</span>,</span><br><span class="line">    <span class="attr">minify</span>:&#123;</span><br><span class="line">        <span class="comment">// 移除空格</span></span><br><span class="line">        <span class="attr">collapseWhitespace</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 移除注释</span></span><br><span class="line">        <span class="attr">removeComments</span>:<span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 压缩js</span></span><br><span class="line"><span class="keyword">const</span> TerserWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> terserWebpackPlugin = <span class="keyword">new</span> TerserWebpackPlugin(&#123;</span><br><span class="line">    <span class="attr">extractComments</span>: <span class="literal">false</span>, <span class="comment">// 不将注释提取为单独文件（打包后不会出现.LICENSE.txt文件）</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">plugins</span>:[htmlWebpackPlugin],</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    	生产环境下会自动压缩js代码</span></span><br><span class="line"><span class="comment">    	但如果配置了optimization minimizer,需要单独配置terser，js压缩才生效</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="attr">mode</span>:<span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">    <span class="attr">optimization</span>:&#123;</span><br><span class="line">        <span class="attr">minimizer</span>:[</span><br><span class="line">    		cssMinimizerWebpackPlugin,</span><br><span class="line">            terserWebpackPlugin</span><br><span class="line">    	]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h1 id="四-Webpack性能优化">
          <a href="#四-Webpack性能优化" class="heading-link"><i class="fas fa-link"></i></a><a href="#四-Webpack性能优化" class="headerlink" title="四.Webpack性能优化"></a>四.Webpack性能优化</h1>
      
        <h2 id="1-开发环境性能优化">
          <a href="#1-开发环境性能优化" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-开发环境性能优化" class="headerlink" title="1.开发环境性能优化"></a>1.开发环境性能优化</h2>
      
        <h3 id="1-热替换">
          <a href="#1-热替换" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-热替换" class="headerlink" title="(1) 热替换"></a>(1) 热替换</h3>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	HMR:hot module replacement 热模块替换/模块热替换</span></span><br><span class="line"><span class="comment">	作用:一个模块发生变化，只会重新打包这一个模块，而不是打包所有，极大提升打包构建速度</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	css文件:可以使用HMR功能，style-loader中实现了</span></span><br><span class="line"><span class="comment">	js文件:默认不能使用HMR功能</span></span><br><span class="line"><span class="comment">		解决:修改js代码，添加支持HMR功能的代码</span></span><br><span class="line"><span class="comment">		注意:HMR功能对js的处理，只能处理非入口js文件的其他文件</span></span><br><span class="line"><span class="comment">	html文件:默认不能使用HMR功能，同时会导致Html文件不能热更新(不用做HMR功能)</span></span><br><span class="line"><span class="comment">		解决:修改entry入口，将html文件引入</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">mode</span>:<span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">    <span class="attr">devServer</span>:&#123;</span><br><span class="line">        <span class="attr">contentBase</span>:resolve(__dirname,<span class="string">&#x27;build&#x27;</span>),</span><br><span class="line">        <span class="attr">compress</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">port</span>:<span class="number">3000</span>,</span><br><span class="line">        <span class="attr">open</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 开启HMR功能（默认开启）</span></span><br><span class="line">    	<span class="attr">hot</span>:<span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<p>js文件修改</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在入口文件末尾添加这段代码</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">module</span>.hot)&#123;</span><br><span class="line">    <span class="built_in">module</span>.hot.accept([filename],<span class="function">()=&gt;</span>&#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="2-热更新">
          <a href="#2-热更新" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-热更新" class="headerlink" title="(2) 热更新"></a>(2) 热更新</h3>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	作用：当模块发生变化时，页面重新加载</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">   	<span class="comment">// ...</span></span><br><span class="line">    <span class="attr">mode</span>:<span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">    <span class="attr">devServer</span>:&#123;</span><br><span class="line">        <span class="attr">contentBase</span>:resolve(__dirname,<span class="string">&#x27;build&#x27;</span>),</span><br><span class="line">        <span class="attr">compress</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">port</span>:<span class="number">3000</span>,</span><br><span class="line">        <span class="attr">open</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="comment">// 热更新（默认开启）</span></span><br><span class="line">        <span class="attr">liveReload</span>:<span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="3-source-map">
          <a href="#3-source-map" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-source-map" class="headerlink" title="(3) source-map"></a>(3) source-map</h3>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	source-map:一种提供 源代码到构建后代码映射 的技术</span></span><br><span class="line"><span class="comment">				如果构建后代码出错了，通过映射关系可以追踪到源代码错误</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">   	<span class="attr">devtool</span>:<span class="string">&#x27;source-map&#x27;</span>,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	有以下几个参数</span></span><br><span class="line"><span class="comment">	[inline-|hidden-|eval-][nosources-][cheap-[module-]]source-map</span></span><br><span class="line"><span class="comment">	如:devtool:&#x27;inline-source-map&#x27;</span></span><br><span class="line"><span class="comment">	</span></span><br><span class="line"><span class="comment">	常见的几种source-map：</span></span><br><span class="line"><span class="comment">	(none)：生产环境默认值（省略devtool选项）</span></span><br><span class="line"><span class="comment">		不产生souce-map</span></span><br><span class="line"><span class="comment">	eval：开发环境默认值</span></span><br><span class="line"><span class="comment">		每个module都会通过eval()来执行，并且会在末尾追加注释//# sourceURL=xx.js</span></span><br><span class="line"><span class="comment">		提示 源代码位置</span></span><br><span class="line"><span class="comment">	source-map:</span></span><br><span class="line"><span class="comment">		生成一个.map文件，并在末尾追加注释//# sourceMappingURL=xxx.js.map指定JS引擎文件</span></span><br><span class="line"><span class="comment">		提示 源代码位置</span></span><br><span class="line"><span class="comment">	hidden-source-map:</span></span><br><span class="line"><span class="comment">		生成一个.map文件，但是不会在末尾追加注释</span></span><br><span class="line"><span class="comment">		提示 构建后代码位置</span></span><br><span class="line"><span class="comment">	inline-source-map:</span></span><br><span class="line"><span class="comment">		不会生成.map文件，而是为每个文件添加source-map的DataURL，这个DataURL是包含一个文件完成source-map信息的Base64编码，会导致文件很大</span></span><br><span class="line"><span class="comment">		提示 源代码位置</span></span><br><span class="line"><span class="comment">	eval-source-map:</span></span><br><span class="line"><span class="comment">		每个module都会通过eval()来执行，把eval的sourceURL换为完整source-map信息的DataURL</span></span><br><span class="line"><span class="comment">		提示 源代码位置，并且多一个唯一标识</span></span><br><span class="line"><span class="comment">	cheap-source-map:</span></span><br><span class="line"><span class="comment">		生成一个.map文件，但是文件中只包含行数，不包含列信息</span></span><br><span class="line"><span class="comment">		提示 源代码位置，但是只能精确到行，不能精确到列</span></span><br><span class="line"><span class="comment">	cheap-module-source-map:</span></span><br><span class="line"><span class="comment">		生成一个.map文件，但是文件中只包含行数，不包含列信息，同时对loader的source-map也进行简化</span></span><br><span class="line"><span class="comment">		提示 源代码位置，但是只能精确到行，不能精确到列</span></span><br><span class="line"><span class="comment">		module会将loader的source-map加入</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	开发环境:eval-cheap-module-source-map</span></span><br><span class="line"><span class="comment">		eval构建速度快，同时每行代码并不会很长，所以选择cheap能进一步提高打包效率，而module能避免loader的source-map混杂，对于源代码提示位置更准确清晰</span></span><br><span class="line"><span class="comment">	生产环境:(none)</span></span><br><span class="line"><span class="comment">		source-map会暴露源代码，同时source-map文件体积相对比较巨大，与我们追求的更小更轻量的bundle相违背</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></div></figure>


        <h2 id="2-生产环境性能优化">
          <a href="#2-生产环境性能优化" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-生产环境性能优化" class="headerlink" title="2.生产环境性能优化"></a>2.生产环境性能优化</h2>
      
        <h3 id="1-oneOf-缓存-tree-shaking">
          <a href="#1-oneOf-缓存-tree-shaking" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-oneOf-缓存-tree-shaking" class="headerlink" title="(1) oneOf/缓存/tree shaking"></a>(1) oneOf/缓存/tree shaking</h3>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	babel缓存</span></span><br><span class="line"><span class="comment">		cacheDirectory:true</span></span><br><span class="line"><span class="comment">		--&gt; 让第二次打包构建速度更快</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	文件资源缓存</span></span><br><span class="line"><span class="comment">		hash:每次webpack构建时会生成一个唯一的hash值</span></span><br><span class="line"><span class="comment">			问题:因为js和css同时使用一个hash值。如果重新打包，会导致所有缓存失效</span></span><br><span class="line"><span class="comment">		chunkhash:根据chunk生成的hash值，如果打包来源于同一个chunk，那么hash值一样</span></span><br><span class="line"><span class="comment">			问题:js和css的hash值还是一样的,因为css是在js中被引入的，所以同属于一个chunk</span></span><br><span class="line"><span class="comment">		contenthash:根据文件的内容生成hash值。不同文件hash值一定不同，并且单独管理</span></span><br><span class="line"><span class="comment">			--&gt; 让代码上线运行缓存更好使用</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	tree shaking:去除无用代码</span></span><br><span class="line"><span class="comment">		前提:1.必须使用es6模块化 2.开启production环境</span></span><br><span class="line"><span class="comment">		作用:减少代码体积</span></span><br><span class="line"><span class="comment">		在package.json中配置</span></span><br><span class="line"><span class="comment">		&quot;sideEffects&quot;:false 所有代码都没有副作用(都可以进行tree shaking)</span></span><br><span class="line"><span class="comment">		问题:可能会把css文件等文件干掉</span></span><br><span class="line"><span class="comment">		解决:&quot;sideEffects&quot;:[&quot;*.css&quot;]</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">module</span>:&#123;</span><br><span class="line">        <span class="attr">rules</span>:[</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// 以下loader只会匹配一个,匹配到后就不再进行匹配</span></span><br><span class="line">                <span class="comment">// 注意:不能有两个配置处理同一种类型文件</span></span><br><span class="line">                <span class="comment">//		如果相同文件，可提取到oneOf之外</span></span><br><span class="line">                <span class="attr">oneOf</span>:[</span><br><span class="line">                    <span class="comment">// ...</span></span><br><span class="line">            		&#123;</span><br><span class="line">                		<span class="attr">test</span>:<span class="regexp">/\.js$/</span>,</span><br><span class="line">                		exclude:<span class="regexp">/node_modules/</span>,</span><br><span class="line">                		loader:<span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">                		<span class="attr">options</span>:&#123;</span><br><span class="line">                            <span class="comment">// 开启babel缓存</span></span><br><span class="line">                            <span class="comment">// 第二次构建时，会读取之前的缓存</span></span><br><span class="line">                            <span class="attr">cacheDirectory</span>:<span class="literal">true</span></span><br><span class="line">                		&#125;</span><br><span class="line">            		&#125;,</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="2-代码分割">
          <a href="#2-代码分割" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-代码分割" class="headerlink" title="(2) 代码分割"></a>(2) 代码分割</h3>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    	1.可以将node_modules中代码单独打包一个chunk最终输出</span></span><br><span class="line"><span class="comment">    		作用：当自身代码更新后，浏览器会重新获取，但第三方库缓存仍然生效</span></span><br><span class="line"><span class="comment">    	2.自动分析多入口chunk中有没有公共的文件。如果有会打包成单独一个chunk</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="attr">optimization</span>:&#123;</span><br><span class="line">        <span class="attr">splitChunks</span>:&#123;</span><br><span class="line">            <span class="attr">cacheGroups</span>:&#123;</span><br><span class="line">                <span class="attr">test</span>:<span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">             	name:<span class="string">&#x27;vendors&#x27;</span>,</span><br><span class="line">                <span class="attr">chunks</span>:<span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="3-懒加载-预加载">
          <a href="#3-懒加载-预加载" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-懒加载-预加载" class="headerlink" title="(3) 懒加载/预加载"></a>(3) 懒加载/预加载</h3>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&#x27;index.js文件被加载&#x27;</span>)</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&#x27;btn&#x27;</span>).onclick = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">/*  </span></span><br><span class="line"><span class="comment">    	lazy loading:懒加载 </span></span><br><span class="line"><span class="comment">    		当文件需要时才加载</span></span><br><span class="line"><span class="comment">    	prefetch:预加载</span></span><br><span class="line"><span class="comment">    		会在使用之前，提前加载js文件</span></span><br><span class="line"><span class="comment">    	正常加载可以认为是并行加载(同一时间加载多个文件)</span></span><br><span class="line"><span class="comment">    	预加载等其他资源加载完毕，浏览器空闲了再偷偷加载。(兼容性差，慎用)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">// 动态引入会单独打包成一个chunk</span></span><br><span class="line">    <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &#x27;test&#x27;, webpackPrefetch:true */</span><span class="string">&#x27;./test&#x27;</span>)</span><br><span class="line">    	.then(<span class="function">(<span class="params">&#123;ml&#125;</span>)=&gt;</span>&#123;</span><br><span class="line">        	<span class="built_in">console</span>.log(ml(<span class="number">4</span>,<span class="number">5</span>))</span><br><span class="line">    	&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="4-PWA-渐进式网络开发应用程序">
          <a href="#4-PWA-渐进式网络开发应用程序" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-PWA-渐进式网络开发应用程序" class="headerlink" title="(4) PWA(渐进式网络开发应用程序)"></a>(4) PWA(渐进式网络开发应用程序)</h3>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	PWA:渐进式网络开发应用程序(离线可访问)</span></span><br><span class="line"><span class="comment">		workbox --&gt; workbox-webpack-plugin</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">const</span> WorkboxWebpackPlugin= <span class="built_in">require</span>(<span class="string">&#x27;workbox-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="attr">plugins</span>:[</span><br><span class="line">    <span class="keyword">new</span> WorkboxWebpackPlugin.GenerateSW(&#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        	1.帮助serviceworker快速启动</span></span><br><span class="line"><span class="comment">        	2.删除旧的serviceworker</span></span><br><span class="line"><span class="comment">        	生成一个serviceworker配置文件</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="attr">clientsClaim</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">skipWaiting</span>:<span class="literal">true</span></span><br><span class="line">    &#125;)</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 以下代码在入口文件中使用 */</span></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	会有几个问题:</span></span><br><span class="line"><span class="comment">	1.eslint不认识window、navigator全局变量</span></span><br><span class="line"><span class="comment">		解决:需要修改package.json中eslintConfig配置</span></span><br><span class="line"><span class="comment">			&quot;env&quot;:&#123;</span></span><br><span class="line"><span class="comment">				&quot;browser&quot;:true // 支持浏览器端全局变量</span></span><br><span class="line"><span class="comment">			&#125;</span></span><br><span class="line"><span class="comment">	2.sw代码必须运行在服务器上</span></span><br><span class="line"><span class="comment">		--&gt; nodejs</span></span><br><span class="line"><span class="comment">		--&gt; npm i serve -g</span></span><br><span class="line"><span class="comment">			serve -s [要运行代码的目录] </span></span><br><span class="line"><span class="comment">			如:serve -s build，将Build目录下所有资源作为静态资源暴露出去</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="string">&#x27;serviceworker&#x27;</span> <span class="keyword">in</span> navigator)&#123;</span><br><span class="line">	<span class="built_in">window</span>.addEventListener(<span class="string">&#x27;load&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">        navigator.serviceworker.register(<span class="string">&#x27;/service-worker.js&#x27;</span>)</span><br><span class="line">        .then(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;sw注册成功&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">        .catch(<span class="function">()=&gt;</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&#x27;sw注册失败&#x27;</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="5-多进程打包">
          <a href="#5-多进程打包" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-多进程打包" class="headerlink" title="(5) 多进程打包"></a>(5) 多进程打包</h3>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 一般给babel-loader用</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">test</span>:<span class="regexp">/\.js$/</span>,</span><br><span class="line">    exclude:<span class="regexp">/node_modules/</span>,</span><br><span class="line">    use:[</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        	开启多进程打包(慎用)</span></span><br><span class="line"><span class="comment">        	进程启动大概600ms，进程通信也有开销</span></span><br><span class="line"><span class="comment">        	只有工作消耗时间比较长，才使用多进程打包</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="string">&#x27;thread-loader&#x27;</span>,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">loader</span>:<span class="string">&#x27;babel-loader&#x27;</span>,</span><br><span class="line">            <span class="attr">options</span>:&#123;</span><br><span class="line">                <span class="attr">presets</span>:[</span><br><span class="line">					[</span><br><span class="line">                    	<span class="string">&#x27;@babel/preset-env&#x27;</span>,</span><br><span class="line">                     	&#123;</span><br><span class="line">                     		<span class="attr">useBuiltIns</span>:<span class="string">&#x27;usage&#x27;</span>,</span><br><span class="line">                     		<span class="attr">corejs</span>:&#123;<span class="attr">version</span>:<span class="number">3</span>&#125;,</span><br><span class="line">                     		<span class="attr">targets</span>:&#123;</span><br><span class="line">                     			<span class="attr">chrome</span>:<span class="string">&#x27;60&#x27;</span>,</span><br><span class="line">                     			<span class="attr">firefox</span>:<span class="string">&#x27;50&#x27;</span></span><br><span class="line">                     		&#125;</span><br><span class="line">                     	&#125;</span><br><span class="line">                     ]</span><br><span class="line">            	],</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="6-externals">
          <a href="#6-externals" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-externals" class="headerlink" title="(6) externals"></a>(6) externals</h3>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    <span class="attr">entry</span>:<span class="string">&#x27;./src/index.js&#x27;</span></span><br><span class="line">    <span class="attr">output</span>:&#123;</span><br><span class="line">        <span class="attr">filename</span>:<span class="string">&#x27;js/built.js&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>:resolve(__dirname,<span class="string">&#x27;build&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>:[</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            <span class="attr">template</span>:<span class="string">&#x27;./src/index.html&#x27;</span>,</span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">mode</span>:<span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">    <span class="attr">externals</span>:&#123;</span><br><span class="line">        <span class="comment">// 拒绝jQuery被打包进来</span></span><br><span class="line">        <span class="comment">// 当忽略对应的包后，需要用cdn引入</span></span><br><span class="line">        <span class="attr">jquery</span>:<span class="string">&#x27;jQuery&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="7-dll">
          <a href="#7-dll" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-dll" class="headerlink" title="(7) dll"></a>(7) dll</h3>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	使用dll技术，对某些库(第三方库:jquery、react、vue...)进行单独打包</span></span><br><span class="line"><span class="comment">	当运行webpack时，默认查找webpack.config.js配置文件</span></span><br><span class="line"><span class="comment">	需求:需要运行新的配置文件webpack.dll.js文件</span></span><br><span class="line"><span class="comment">		--&gt; webpack --config webpack.dll.js</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 以下是一个新的配置文件 */</span></span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    <span class="attr">entry</span>:&#123;</span><br><span class="line">        <span class="comment">// 最终打包生成的[name] --&gt; jquery</span></span><br><span class="line">        <span class="comment">// [&#x27;jquery&#x27;] --&gt; 要打包的库是jquery</span></span><br><span class="line">        <span class="attr">jquery</span>:[<span class="string">&#x27;jquery&#x27;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">output</span>:&#123;</span><br><span class="line">    	<span class="attr">filename</span>:<span class="string">&#x27;[name].js&#x27;</span>,</span><br><span class="line">    	<span class="attr">path</span>:resolve(__dirname,<span class="string">&#x27;dll&#x27;</span>),</span><br><span class="line">        <span class="attr">library</span>:<span class="string">&#x27;[name]_[hash]&#x27;</span>,	<span class="comment">// 打包的库里面向外暴露出去的内容叫什么名字</span></span><br><span class="line">	&#125;,</span><br><span class="line">    <span class="attr">plugins</span>:[</span><br><span class="line">        <span class="comment">// 打包生成一个mainfest.json --&gt; 提供和jquery映射</span></span><br><span class="line">        <span class="keyword">new</span> webpack.Dllplugin(&#123;</span><br><span class="line">            <span class="attr">name</span>:<span class="string">&#x27;[name]_[hash]&#x27;</span>,	<span class="comment">// 映射库的暴露的内容名称</span></span><br><span class="line">            <span class="attr">path</span>:resolve(__dirname,<span class="string">&#x27;dll/manifest.json&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">mode</span>:<span class="string">&#x27;production&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 以下是webpack.config.js */</span></span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&#x27;webpack&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> AddAssetHtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&#x27;add-asset-html-webpack-plugin&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports=&#123;</span><br><span class="line">    <span class="attr">entry</span>:<span class="string">&#x27;./src/index.js&#x27;</span></span><br><span class="line">    <span class="attr">output</span>:&#123;</span><br><span class="line">        <span class="attr">filename</span>:<span class="string">&#x27;js/built.js&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>:resolve(__dirname,<span class="string">&#x27;build&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>:[</span><br><span class="line">        <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">            <span class="attr">template</span>:<span class="string">&#x27;./src/index.html&#x27;</span>,</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 告诉webpack哪些库不参与打包,同时使用时的名称也得改</span></span><br><span class="line">        <span class="keyword">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class="line">            <span class="attr">mainfest</span>:resolve(__dirname,<span class="string">&#x27;dll/manifest.json&#x27;</span>)</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 将某个文件打包输出去，并在Html自动引入该资源</span></span><br><span class="line">        <span class="keyword">new</span> AddAssetHtmlWebpackPlugin(&#123;</span><br><span class="line">            <span class="attr">filepath</span>:resolve(__dirname,<span class="string">&#x27;dll/jquery.js&#x27;</span>)</span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">mode</span>:<span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="3-性能优化总结">
          <a href="#3-性能优化总结" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-性能优化总结" class="headerlink" title="3.性能优化总结"></a>3.性能优化总结</h2>
      <p>webpack性能优化：</p>
<ul>
<li>开发环境性能优化</li>
<li>生产环境性能优化</li>
</ul>

        <h3 id="开发环境性能优化">
          <a href="#开发环境性能优化" class="heading-link"><i class="fas fa-link"></i></a><a href="#开发环境性能优化" class="headerlink" title="开发环境性能优化"></a>开发环境性能优化</h3>
      <ul>
<li>优化代码构建速度<ul>
<li>热替换</li>
</ul>
</li>
<li>优化代码调试<ul>
<li>热更新</li>
<li>source-map</li>
</ul>
</li>
</ul>

        <h3 id="生产环境性能优化">
          <a href="#生产环境性能优化" class="heading-link"><i class="fas fa-link"></i></a><a href="#生产环境性能优化" class="headerlink" title="生产环境性能优化"></a>生产环境性能优化</h3>
      <ul>
<li>优化打包构建速度<ul>
<li>oneOf</li>
<li>babel缓存</li>
<li>多进程打包</li>
<li>externals</li>
<li>dll</li>
</ul>
</li>
<li>优化代码运行的性能<ul>
<li>缓存（hash-chunkhash-contenthash）</li>
<li>tree shaking</li>
<li>code split</li>
<li>懒加载/预加载</li>
<li>pwa</li>
</ul>
</li>
</ul>

        <h1 id="五-Webpack详细配置">
          <a href="#五-Webpack详细配置" class="heading-link"><i class="fas fa-link"></i></a><a href="#五-Webpack详细配置" class="headerlink" title="五.Webpack详细配置"></a>五.Webpack详细配置</h1>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> HtmlPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> htmlPlugin = <span class="keyword">new</span> HtmlPlugin(&#123;</span><br><span class="line">    <span class="attr">template</span>: <span class="string">&quot;./src/index.html&quot;</span>,</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;index.html&quot;</span>,</span><br><span class="line">    <span class="attr">inject</span>:<span class="string">&quot;body&quot;</span>	<span class="comment">// 将script标签放入body标签中（默认在head中）</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将css单独打包成一个文件</span></span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> miniCssExtractPlugin = <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;css/[name].[contenthash:8].css&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 压缩css文件</span></span><br><span class="line"><span class="keyword">const</span> CssMinimizerWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cssMinimizerWebpackPlugin = <span class="keyword">new</span> CssMinimizerWebpackPlugin();</span><br><span class="line"><span class="comment">// 压缩js</span></span><br><span class="line"><span class="keyword">const</span> TerserWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> terserWebpackPlugin = <span class="keyword">new</span> TerserWebpackPlugin(&#123;</span><br><span class="line">    <span class="attr">extractComments</span>: <span class="literal">false</span>, <span class="comment">// 不将注释提取为单独文件（打包后不会出现.LICENSE.txt文件）</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">mode</span>:<span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    	entry:入口起点</span></span><br><span class="line"><span class="comment">    	1.String -&gt; &#x27;./src/index.js&#x27;</span></span><br><span class="line"><span class="comment">    		单入口</span></span><br><span class="line"><span class="comment">    		打包形成一个chunk，输出一个bundle文件。此时chunk的名称默认是main</span></span><br><span class="line"><span class="comment">    	2.Array -&gt; [&#x27;./src/index.js&#x27;,&#x27;./src/add.js&#x27;]</span></span><br><span class="line"><span class="comment">    		多入口</span></span><br><span class="line"><span class="comment">    		所有入口文件最终只会形成一个chunk，输出出去只有一个bundle文件</span></span><br><span class="line"><span class="comment">    		只有在HMR功能中让html热更新生效</span></span><br><span class="line"><span class="comment">    	3.Object -&gt; &#123;index:&#x27;./src/index.js&#x27;, add: &#x27;./src/add.js&#x27;&#125;</span></span><br><span class="line"><span class="comment">    		多入口</span></span><br><span class="line"><span class="comment">    		有几个入口文件就形成几个chunk，输出几个bundle文件。此时chunk的名称是Object的key</span></span><br><span class="line"><span class="comment">    	  特殊用法 -&gt; &#123;index:[&#x27;./src/index.js&#x27;,&#x27;./src/count.js&#x27;], add: &#x27;./src/add.js&#x27;&#125;</span></span><br><span class="line"><span class="comment">    	  	</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="attr">entry</span>:<span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>:&#123;</span><br><span class="line">        <span class="comment">// 文件名称（指定名称+目录）</span></span><br><span class="line">        <span class="attr">filename</span>:<span class="string">&#x27;js/[name].[contenthash:8].js&#x27;</span>,</span><br><span class="line">        <span class="comment">// 输出文件目录（将来所有资源输出的公共目录）</span></span><br><span class="line">        <span class="attr">path</span>:resolve(__dirname,<span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        <span class="comment">// 所有资源引入的公共路径前缀 -&gt; &#x27;img/a.jpg&#x27; -&gt;&#x27;/img/a.jpg&#x27;</span></span><br><span class="line">        <span class="attr">publicPath</span>:<span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">        <span class="comment">// 非入口chunk的名称（指定名称+目录）</span></span><br><span class="line">        <span class="comment">// chunkFilename:&#x27;js/[name].[contenthash:8].js&#x27;,</span></span><br><span class="line">        <span class="comment">// 整个库向外暴露的变量名</span></span><br><span class="line">        <span class="comment">// library:&#x27;[name]&#x27;,</span></span><br><span class="line">        <span class="comment">// 变量名添加到哪个上</span></span><br><span class="line">        <span class="comment">// libraryTarget:&#x27;window&#x27;, 		// browser</span></span><br><span class="line">        <span class="comment">// libraryTarget:&#x27;global&#x27;, 		// node</span></span><br><span class="line">        <span class="comment">// libraryTarget:&#x27;commonjs&#x27;, 	// commonjs</span></span><br><span class="line">        <span class="comment">// 重新打包后清除上一次打包结果</span></span><br><span class="line">        <span class="comment">// clean:true,</span></span><br><span class="line">        <span class="comment">// 定义资源文件名（指定名称+目录）</span></span><br><span class="line">        <span class="comment">// assetModuleFilename:&#x27;asset/[contenthash].[ext]&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">module</span>:&#123;</span><br><span class="line">      <span class="attr">rules</span>:[</span><br><span class="line">          <span class="comment">// loader的配置</span></span><br><span class="line">          &#123; </span><br><span class="line">              <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">              loader: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">              <span class="comment">// 排除node_modules下的js文件</span></span><br><span class="line">              <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">              <span class="comment">// 只检查src下的js文件</span></span><br><span class="line">              <span class="comment">// include:resolve(__dirname,&#x27;src&#x27;),</span></span><br><span class="line">              <span class="comment">// 优先执行</span></span><br><span class="line">              <span class="comment">// enforce:&#x27;pre&#x27;,</span></span><br><span class="line">              <span class="comment">// 延后执行</span></span><br><span class="line">              <span class="comment">// enforce:&#x27;post&#x27;,</span></span><br><span class="line">              <span class="comment">// 指定一些特殊配置</span></span><br><span class="line">              options: &#123;</span><br><span class="line">                  <span class="comment">// 预设</span></span><br><span class="line">                  <span class="attr">presets</span>:[<span class="string">&#x27;@babel/preset-env&#x27;</span>],</span><br><span class="line">                  <span class="comment">// babel缓存，第二次构建会读取之前的缓存</span></span><br><span class="line">                  <span class="attr">cacheDirectory</span>: <span class="literal">true</span></span><br><span class="line">              &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">              <span class="comment">// 以下配置只会生效一个</span></span><br><span class="line">        	<span class="attr">oneOf</span>: [</span><br><span class="line">          		&#123; <span class="attr">test</span>: <span class="regexp">/\.html$/</span>, loader: <span class="string">&quot;html-loader&quot;</span> &#125;,</span><br><span class="line">          		&#123; </span><br><span class="line">                    <span class="attr">test</span>: <span class="regexp">/\.(png|svg)$/</span>, </span><br><span class="line">                    type: <span class="string">&quot;asset&quot;</span>, </span><br><span class="line">                    <span class="comment">// 定义资源名字的路径，优先级高于output内配置的资源路径和名称</span></span><br><span class="line">                    <span class="attr">generator</span>: &#123; </span><br><span class="line">                        <span class="attr">filename</span>: <span class="string">&quot;img/[name].[contenthash:8].[ext]&quot;</span></span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;,</span><br><span class="line">                &#123; <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff)$/</span>, type: <span class="string">&quot;asset/resource&quot;</span>, <span class="attr">generator</span>: &#123; <span class="attr">filename</span>: <span class="string">&quot;fonts/[name].[contenthash:8].[ext]&quot;</span>&#125;&#125;,</span><br><span class="line">                &#123; <span class="attr">test</span>: <span class="regexp">/\.s?css$/</span>, use: [MiniCssExtractPlugin.loader, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;sass-loader&quot;</span>]&#125;,</span><br><span class="line">            ],</span><br><span class="line">          &#125;</span><br><span class="line">      ]  </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>:[</span><br><span class="line">        htmlPlugin,</span><br><span class="line">        miniCssExtractPlugin</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// 解析模块的规则</span></span><br><span class="line">    <span class="attr">resolve</span>:&#123;</span><br><span class="line">        <span class="comment">// 配置解析模块路径别名：优点-&gt;可以简化路径，缺点-&gt;没有智能提示</span></span><br><span class="line">        <span class="attr">alias</span>:&#123;</span><br><span class="line">            <span class="string">&quot;@&quot;</span>: resolve(__dirname, <span class="string">&quot;src&quot;</span>)</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 配置省略文件路径的后缀名</span></span><br><span class="line">        <span class="attr">extensions</span>:[<span class="string">&#x27;.js&#x27;</span>,<span class="string">&#x27;.json&#x27;</span>],</span><br><span class="line">        <span class="comment">// 告诉webpack解析模块是去找哪个目录</span></span><br><span class="line">        <span class="attr">modules</span>:[<span class="string">&#x27;node_modules&#x27;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">optimization</span>:&#123;</span><br><span class="line">        <span class="attr">splitChunks</span>:&#123;</span><br><span class="line">            <span class="attr">chunks</span>:<span class="string">&#x27;all&#x27;</span>,</span><br><span class="line">            <span class="comment">/* 以下内容全为默认值 */</span></span><br><span class="line">            <span class="attr">minSize</span>:<span class="number">30</span> * <span class="number">1024</span>,	<span class="comment">// 分割的chunk最小为30kb</span></span><br><span class="line">            <span class="attr">maxSize</span>:<span class="number">0</span>,	<span class="comment">// 没有最大限制</span></span><br><span class="line">            <span class="attr">minChunks</span>:<span class="number">1</span>,	<span class="comment">// 要提取的chunks最少被引用1次</span></span><br><span class="line">            <span class="attr">maxAsyncRequests</span>:<span class="number">5</span>,		<span class="comment">// 按需加载时并行加载的文件的最大数量</span></span><br><span class="line">            <span class="attr">maxInitialRequests</span>:<span class="number">3</span>,	<span class="comment">// 入口js文件最大并行请求数量</span></span><br><span class="line">            <span class="attr">automaticNameDelimiter</span>:<span class="string">&#x27;~&#x27;</span>,	<span class="comment">// 名称连接符</span></span><br><span class="line">            <span class="attr">name</span>:<span class="literal">true</span>,	<span class="comment">// 可以使用命名规则</span></span><br><span class="line">            <span class="attr">cacheGroups</span>:&#123;	<span class="comment">// 划分chunk的组</span></span><br><span class="line">                <span class="comment">// node_modules文件会被打包到vendors组的chunk中 -&gt; vendors~xxx.js</span></span><br><span class="line">                <span class="attr">vendors</span>:&#123;</span><br><span class="line">                    <span class="attr">test</span>:<span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">                    <span class="comment">// 优先级</span></span><br><span class="line">                    priority:-<span class="number">10</span></span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">default</span>:&#123;</span><br><span class="line">                    <span class="comment">// 要提取的chunk最少被引用2次</span></span><br><span class="line">                    <span class="attr">minChunks</span>:<span class="number">2</span>,</span><br><span class="line">                    <span class="comment">// 优先级</span></span><br><span class="line">                    <span class="attr">priority</span>:-<span class="number">20</span>,</span><br><span class="line">                    <span class="comment">// 如果当前要打包的模块和之前已经被提取的模块是同一个，就会复用，而不是重新打包</span></span><br><span class="line">                    <span class="attr">reuseExistingChunk</span>:<span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 将当前模块的记录其他模块的hash单独打包为一个文件runtime</span></span><br><span class="line">        <span class="comment">// 解决：修改a文件导致b文件的contenthash变化</span></span><br><span class="line">        <span class="attr">runtimeChunk</span>:&#123;</span><br><span class="line">            <span class="attr">name</span>:<span class="function"><span class="params">entrypoint</span> =&gt;</span> <span class="string">`runtime-<span class="subst">$&#123;entrypoint.name&#125;</span>`</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// 配置生产环境的压缩方案:主要针对js和css</span></span><br><span class="line">        <span class="attr">minimizer</span>:[</span><br><span class="line">    		cssMinimizerWebpackPlugin,</span><br><span class="line">            terserWebpackPlugin</span><br><span class="line">    	]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// devServer配置（详细配置请查看三.6）</span></span><br><span class="line">    <span class="attr">devServer</span>:&#123;</span><br><span class="line">        <span class="attr">static</span>:resolve(__dirname,<span class="string">&#x27;./dist&#x27;</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">devtool</span>:<span class="string">&#x27;source-map&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="1-修改环境变量">
          <a href="#1-修改环境变量" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-修改环境变量" class="headerlink" title="1. 修改环境变量"></a>1. 修改环境变量</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 公共路径</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">env</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">		<span class="attr">mode</span>:env.production?<span class="string">&#x27;production&#x27;</span>:<span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">		<span class="attr">output</span>:&#123;</span><br><span class="line">			<span class="attr">filename</span>:<span class="string">&#x27;js/[name].[contenthash:8].js&#x27;</span>,</span><br><span class="line">			<span class="attr">path</span>:resolve(__dirname,<span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">			<span class="comment">// 所有资源引入的公共路径前缀 -&gt; &#x27;img/a.jpg&#x27; -&gt;&#x27;/img/a.jpg&#x27;</span></span><br><span class="line">			<span class="attr">publicPath</span>:<span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">		&#125;,</span><br><span class="line">		...</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 通过命令行修改环境变量</span></span><br><span class="line">npx webpack --env production</span><br></pre></td></tr></table></div></figure>


        <h2 id="2-开发环境基本配置">
          <a href="#2-开发环境基本配置" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-开发环境基本配置" class="headerlink" title="2.开发环境基本配置"></a>2.开发环境基本配置</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开发环境配置webpack.config.dev.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> htmlPlugin = <span class="keyword">new</span> HtmlPlugin(&#123;</span><br><span class="line">    <span class="attr">template</span>: <span class="string">&quot;./src/index.html&quot;</span>,</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;index.html&quot;</span>,</span><br><span class="line">    <span class="attr">inject</span>:<span class="string">&quot;body&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> miniCssExtractPlugin = <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;css/[name].css&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">mode</span>:<span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">    <span class="attr">entry</span>:<span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>:&#123;</span><br><span class="line">        <span class="attr">filename</span>:<span class="string">&#x27;js/[name].js&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>:resolve(__dirname,<span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        <span class="attr">clean</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">assetModuleFilename</span>:<span class="string">&#x27;asset/[contenthash].[ext]&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">module</span>:&#123;</span><br><span class="line">      <span class="attr">rules</span>:[...]  </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>:[</span><br><span class="line">        htmlPlugin,</span><br><span class="line">        miniCssExtractPlugin</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">resolve</span>:&#123;</span><br><span class="line">        <span class="attr">alias</span>:&#123;</span><br><span class="line">            <span class="string">&quot;@&quot;</span>: resolve(__dirname, <span class="string">&quot;src&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">devtool</span>:<span class="string">&#x27;eval-cheap-module-source-map&#x27;</span>,</span><br><span class="line">    <span class="attr">optimization</span>:&#123;</span><br><span class="line">        <span class="attr">splitChunks</span>:&#123;</span><br><span class="line">            <span class="attr">cacheGroups</span>:&#123;</span><br><span class="line">                <span class="attr">test</span>:<span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">             	name:<span class="string">&#x27;vendors&#x27;</span>,</span><br><span class="line">                <span class="attr">chunks</span>:<span class="string">&#x27;all&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">devServer</span>:&#123;</span><br><span class="line">        <span class="attr">static</span>:<span class="string">&#x27;./dist&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 指定配置文件</span></span><br><span class="line">npx webpack --config webpack.config.dev.js</span><br><span class="line">npx webpakc serve --config webpack.config.dev.js</span><br></pre></td></tr></table></div></figure>


        <h2 id="3-生产环境基本配置">
          <a href="#3-生产环境基本配置" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-生产环境基本配置" class="headerlink" title="3.生产环境基本配置"></a>3.生产环境基本配置</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生产环境配置webpack.config.prod.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> HtmlPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> htmlPlugin = <span class="keyword">new</span> HtmlPlugin(&#123;</span><br><span class="line">    <span class="attr">template</span>: <span class="string">&quot;./src/index.html&quot;</span>,</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;index.html&quot;</span>,</span><br><span class="line">    <span class="attr">inject</span>:<span class="string">&quot;body&quot;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> miniCssExtractPlugin = <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;css/[name].[contenthash:8].css&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> CssMinimizerWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cssMinimizerWebpackPlugin = <span class="keyword">new</span> CssMinimizerWebpackPlugin();</span><br><span class="line"><span class="keyword">const</span> TerserWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> terserWebpackPlugin = <span class="keyword">new</span> TerserWebpackPlugin(&#123;</span><br><span class="line">    <span class="attr">extractComments</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">mode</span>:<span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">    <span class="attr">entry</span>:<span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>:&#123;</span><br><span class="line">        <span class="attr">filename</span>:<span class="string">&#x27;js/[name].[contenthash:8].js&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>:resolve(__dirname,<span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        <span class="attr">publicPath</span>:<span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">        <span class="attr">clean</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">assetModuleFilename</span>:<span class="string">&#x27;asset/[contenthash].[ext]&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">module</span>:&#123;</span><br><span class="line">      <span class="attr">rules</span>:[...]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>:[</span><br><span class="line">        htmlPlugin,</span><br><span class="line">        miniCssExtractPlugin</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">resolve</span>:&#123;</span><br><span class="line">        <span class="attr">alias</span>:&#123;</span><br><span class="line">            <span class="string">&quot;@&quot;</span>: resolve(__dirname, <span class="string">&quot;src&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">optimization</span>:&#123;</span><br><span class="line">        <span class="attr">splitChunks</span>:&#123;</span><br><span class="line">            <span class="attr">cacheGroups</span>:&#123;</span><br><span class="line">                <span class="attr">test</span>:<span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">             	name:<span class="string">&#x27;vendors&#x27;</span>,</span><br><span class="line">                <span class="attr">chunks</span>:<span class="string">&#x27;all&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">minimizer</span>:[</span><br><span class="line">    		cssMinimizerWebpackPlugin,</span><br><span class="line">            terserWebpackPlugin</span><br><span class="line">    	]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">performance</span>:&#123;</span><br><span class="line">        <span class="attr">hits</span>:<span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 指定配置文件</span></span><br><span class="line">npx webpack --config webpack.config.prod.js</span><br></pre></td></tr></table></div></figure>


        <h2 id="4-npm脚本">
          <a href="#4-npm脚本" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-npm脚本" class="headerlink" title="4.npm脚本"></a>4.npm脚本</h2>
      <figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;server&quot;</span>:<span class="string">&quot;npx webpakc serve --config webpack.config.dev.js&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;build&quot;</span>:<span class="string">&quot;npx webpack --config webpack.config.prod.js&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 通过npm脚本运行</span></span><br><span class="line">npm run serve</span><br><span class="line">npm run build</span><br></pre></td></tr></table></div></figure>


        <h2 id="5-提取配置内公共代码">
          <a href="#5-提取配置内公共代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-提取配置内公共代码" class="headerlink" title="5.提取配置内公共代码"></a>5.提取配置内公共代码</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 公共环境配置webpack.config.common.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> htmlPlugin = <span class="keyword">new</span> HtmlPlugin(&#123;</span><br><span class="line">    <span class="attr">template</span>: <span class="string">&quot;./src/index.html&quot;</span>,</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;index.html&quot;</span>,</span><br><span class="line">    <span class="attr">inject</span>:<span class="string">&quot;body&quot;</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> miniCssExtractPlugin = <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;css/[name].[contenthash:8].css&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">entry</span>:<span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>:&#123;</span><br><span class="line">        <span class="attr">path</span>:resolve(__dirname,<span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        <span class="attr">clean</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">assetModuleFilename</span>:<span class="string">&#x27;asset/[contenthash].[ext]&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">module</span>:&#123;</span><br><span class="line">      <span class="attr">rules</span>:[</span><br><span class="line">          &#123; </span><br><span class="line">              <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">              loader: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">              <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">              options: &#123;</span><br><span class="line">                  <span class="attr">presets</span>:[<span class="string">&#x27;@babel/preset-env&#x27;</span>],</span><br><span class="line">                  <span class="attr">cacheDirectory</span>: <span class="literal">true</span></span><br><span class="line">              &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">        	<span class="attr">oneOf</span>: [</span><br><span class="line">          		&#123; <span class="attr">test</span>: <span class="regexp">/\.html$/</span>, loader: <span class="string">&quot;html-loader&quot;</span> &#125;,</span><br><span class="line">          		&#123; <span class="attr">test</span>: <span class="regexp">/\.(png|svg)$/</span>, type: <span class="string">&quot;asset&quot;</span>, <span class="attr">generator</span>: &#123; <span class="attr">filename</span>: <span class="string">&quot;img/[name].[contenthash:8].[ext]&quot;</span>&#125;&#125;,</span><br><span class="line">                &#123; <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff)$/</span>, type: <span class="string">&quot;asset/resource&quot;</span>, <span class="attr">generator</span>: &#123; <span class="attr">filename</span>: <span class="string">&quot;fonts/[name].[contenthash:8].[ext]&quot;</span>&#125;&#125;,</span><br><span class="line">                &#123; <span class="attr">test</span>: <span class="regexp">/\.s?css$/</span>, use: [MiniCssExtractPlugin.loader, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;sass-loader&quot;</span>]&#125;,</span><br><span class="line">            ],</span><br><span class="line">          &#125;</span><br><span class="line">      ]  </span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>:[</span><br><span class="line">        htmlPlugin,</span><br><span class="line">        miniCssExtractPlugin</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">resolve</span>:&#123;</span><br><span class="line">        <span class="attr">alias</span>:&#123;</span><br><span class="line">            <span class="string">&quot;@&quot;</span>: resolve(__dirname, <span class="string">&quot;src&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">optimization</span>:&#123;</span><br><span class="line">        <span class="attr">splitChunks</span>:&#123;</span><br><span class="line">            <span class="attr">cacheGroups</span>:&#123;</span><br><span class="line">                <span class="attr">test</span>:<span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">             	name:<span class="string">&#x27;vendors&#x27;</span>,</span><br><span class="line">                <span class="attr">chunks</span>:<span class="string">&#x27;all&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开发环境配置webpack.config.dev.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">mode</span>:<span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>:&#123;</span><br><span class="line">        <span class="attr">filename</span>:<span class="string">&#x27;js/[name].js&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">devtool</span>:<span class="string">&#x27;eval-cheap-module-source-map&#x27;</span>,</span><br><span class="line">    <span class="attr">devServer</span>:&#123;</span><br><span class="line">        <span class="attr">static</span>:<span class="string">&#x27;./dist&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生产环境配置webpack.config.prod.js</span></span><br><span class="line"><span class="keyword">const</span> CssMinimizerWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cssMinimizerWebpackPlugin = <span class="keyword">new</span> CssMinimizerWebpackPlugin();</span><br><span class="line"><span class="keyword">const</span> TerserWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> terserWebpackPlugin = <span class="keyword">new</span> TerserWebpackPlugin(&#123;</span><br><span class="line">    <span class="attr">extractComments</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">mode</span>:<span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>:&#123;</span><br><span class="line">        <span class="attr">filename</span>:<span class="string">&#x27;js/[name].[contenthash:8].js&#x27;</span>,</span><br><span class="line">        <span class="attr">publicPath</span>:<span class="string">&#x27;/&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">optimization</span>:&#123;</span><br><span class="line">        <span class="attr">minimizer</span>:[</span><br><span class="line">    		cssMinimizerWebpackPlugin,</span><br><span class="line">            terserWebpackPlugin</span><br><span class="line">    	]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">performance</span>:&#123;</span><br><span class="line">        <span class="attr">hits</span>:<span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装webpack-merge包</span></span><br><span class="line">npm install webpack-merge -D</span><br></pre></td></tr></table></div></figure>

<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> &#123;merge&#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> commonConfig = reuqire(<span class="string">&#x27;./webpack.config.common&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> productionConfig = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.config.prod&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> developmentConfig = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.config.dev&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">env</span>) =&gt;</span>&#123;</span><br><span class="line">    <span class="function"><span class="title">swicth</span>(<span class="params"><span class="literal">true</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">case</span> env.development:</span><br><span class="line">        	<span class="keyword">return</span> merge(commonConfig,developmentConfig)</span><br><span class="line">        <span class="keyword">case</span> env.production:</span><br><span class="line">        	<span class="keyword">return</span> merge(commonConfig,productionConfig)</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">        	<span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;No matching configuration was found&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json修改npm脚本</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;server&quot;</span>:<span class="string">&quot;npx webpakc serve --config webpack.config.js --env development&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;build&quot;</span>:<span class="string">&quot;npx webpack --config webpack.config.js --env production&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h1 id="六-vue-cli构建打包配置分析">
          <a href="#六-vue-cli构建打包配置分析" class="heading-link"><i class="fas fa-link"></i></a><a href="#六-vue-cli构建打包配置分析" class="headerlink" title="六.vue-cli构建打包配置分析"></a>六.vue-cli构建打包配置分析</h1>
      <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将vue开发环境的webpack配置输出</span></span><br><span class="line">npx vue-cli-service inspect --mode=development &gt; webpack.dev.js</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将vue生产环境的webpack配置输出</span></span><br><span class="line">npx vue-cli-service inspect --mode=production &gt; webpack.prod.js</span><br></pre></td></tr></table></div></figure>



<hr>
<p><strong>注意：</strong>以上内容大部分为<code>Webpack5</code>，部分配置可能是<code>Webpack4</code>的配置，已经不适用新版本，需自行调整</p>
<hr>
<blockquote>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1YU4y1g745">https://www.bilibili.com/video/BV1YU4y1g745</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</blockquote>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2022/01/24/axios/">axios</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2022-01-24</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2022-02-21</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="一、基础知识">
          <a href="#一、基础知识" class="heading-link"><i class="fas fa-link"></i></a><a href="#一、基础知识" class="headerlink" title="一、基础知识"></a>一、基础知识</h1>
      
        <h2 id="请求">
          <a href="#请求" class="heading-link"><i class="fas fa-link"></i></a><a href="#请求" class="headerlink" title="请求"></a>请求</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">行:GET url HTTP/<span class="number">1.1</span></span><br><span class="line">头:Content-Type:application/x-www-form-urlencoded</span><br><span class="line">空行</span><br><span class="line">体:...</span><br></pre></td></tr></table></div></figure>


        <h2 id="响应">
          <a href="#响应" class="heading-link"><i class="fas fa-link"></i></a><a href="#响应" class="headerlink" title="响应"></a>响应</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">行:HTTP/<span class="number">1.1</span> <span class="number">200</span> OK</span><br><span class="line">头:Content-Type: text/plain; charset=UTF-<span class="number">8</span></span><br><span class="line">空行</span><br><span class="line">体:...</span><br></pre></td></tr></table></div></figure>




        <h1 id="二、Axios">
          <a href="#二、Axios" class="heading-link"><i class="fas fa-link"></i></a><a href="#二、Axios" class="headerlink" title="二、Axios"></a>二、Axios</h1>
      
        <h2 id="1-使用方法">
          <a href="#1-使用方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-使用方法" class="headerlink" title="1.使用方法"></a>1.使用方法</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基本使用</span></span><br><span class="line">axios(&#123;</span><br><span class="line">    <span class="attr">method</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>:&#123;&#125;</span><br><span class="line">&#125;).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;).catche(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 其他方式</span></span><br><span class="line">axios.request(config)</span><br><span class="line">axios.get(url,&#123;<span class="attr">params</span>:OBJECT&#125;)</span><br><span class="line">axios.post(url,OBJECT)</span><br></pre></td></tr></table></div></figure>


        <h2 id="2-axios请求响应结果">
          <a href="#2-axios请求响应结果" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-axios请求响应结果" class="headerlink" title="2.axios请求响应结果"></a>2.axios请求响应结果</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">config</span>:,		<span class="comment">// 请求配置</span></span><br><span class="line">    data:,			<span class="comment">// 响应体</span></span><br><span class="line">    headers:,		<span class="comment">// 响应头</span></span><br><span class="line">    request:,		<span class="comment">// 原生AJAX请求对象</span></span><br><span class="line">    status:,		<span class="comment">// 响应状态码</span></span><br><span class="line">    statusText:<span class="string">&#x27;&#x27;</span>	<span class="comment">// 响应状态字符串</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="3-axios配置对象">
          <a href="#3-axios配置对象" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-axios配置对象" class="headerlink" title="3.axios配置对象"></a>3.axios配置对象</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  	<span class="comment">// `url` 是用于请求的服务器 URL</span></span><br><span class="line">	<span class="attr">url</span>: <span class="string">&quot;/user&quot;</span>,</span><br><span class="line">      </span><br><span class="line">  	<span class="comment">// `method` 是创建请求时使用的方法</span></span><br><span class="line">	<span class="attr">method</span>: <span class="string">&quot;get&quot;</span>, <span class="comment">// 默认是 get</span></span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `baseURL` 将自动加在 `url` 前面，除非 `url` 是一个绝对 URL。</span></span><br><span class="line">  	<span class="comment">// 它可以通过设置一个 `baseURL` 便于为 axios 实例的方法传递相对 URL</span></span><br><span class="line">  	<span class="attr">baseURL</span>: <span class="string">&quot;https://some-domain.com/api/&quot;</span>,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `transformRequest` 允许在向服务器发送前，修改请求数据</span></span><br><span class="line">  	<span class="comment">// 只能用在 &quot;PUT&quot;, &quot;POST&quot; 和 &quot;PATCH&quot; 这几个请求方法</span></span><br><span class="line">  	<span class="comment">// 后面数组中的函数必须返回一个字符串，或 ArrayBuffer，或 Stream</span></span><br><span class="line">  	<span class="attr">transformRequest</span>: [<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    	<span class="comment">// 对 data 进行任意转换处理</span></span><br><span class="line">    	<span class="keyword">return</span> data;</span><br><span class="line"> 	&#125;],</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `transformResponse` 在传递给 then/catch 前，允许修改响应数据</span></span><br><span class="line">  	<span class="attr">transformResponse</span>: [<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    	<span class="comment">// 对 data 进行任意转换处理</span></span><br><span class="line">    	<span class="keyword">return</span> data;</span><br><span class="line">  	&#125;],</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `headers` 是即将被发送的自定义请求头</span></span><br><span class="line">  	<span class="attr">headers</span>: &#123;<span class="string">&quot;X-Requested-With&quot;</span>: <span class="string">&quot;XMLHttpRequest&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `params` 是即将与请求一起发送的 URL 参数</span></span><br><span class="line">  	<span class="comment">// 必须是一个无格式对象(plain object)或 URLSearchParams 对象</span></span><br><span class="line">  	<span class="attr">params</span>: &#123;</span><br><span class="line">    	<span class="attr">ID</span>: <span class="number">12345</span></span><br><span class="line">  	&#125;,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `paramsSerializer` 是一个负责 `params` 序列化的函数</span></span><br><span class="line">  	<span class="attr">paramsSerializer</span>: <span class="function"><span class="keyword">function</span>(<span class="params">params</span>) </span>&#123;</span><br><span class="line">    	<span class="keyword">return</span> Qs.stringify(params, &#123;<span class="attr">arrayFormat</span>: <span class="string">&quot;brackets&quot;</span>&#125;)</span><br><span class="line">  	&#125;,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `data` 是作为请求主体被发送的数据</span></span><br><span class="line">  	<span class="comment">// 只适用于这些请求方法 &quot;PUT&quot;, &quot;POST&quot;, 和 &quot;PATCH&quot;</span></span><br><span class="line">  	<span class="comment">// 在没有设置 `transformRequest` 时，必须是以下类型之一：</span></span><br><span class="line">  	<span class="comment">// - string, plain object, ArrayBuffer, ArrayBufferView, URLSearchParams</span></span><br><span class="line">  	<span class="comment">// - 浏览器专属：FormData, File, Blob</span></span><br><span class="line">  	<span class="comment">// - Node 专属： Stream</span></span><br><span class="line">  	<span class="attr">data</span>: &#123;</span><br><span class="line">    	<span class="attr">firstName</span>: <span class="string">&quot;Fred&quot;</span></span><br><span class="line">  	&#125;,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `timeout` 指定请求超时的毫秒数(0 表示无超时时间)</span></span><br><span class="line">  	<span class="comment">// 如果请求话费了超过 `timeout` 的时间，请求将被中断</span></span><br><span class="line">  	<span class="attr">timeout</span>: <span class="number">1000</span>,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `withCredentials` 表示跨域请求时是否需要使用凭证</span></span><br><span class="line">  	<span class="attr">withCredentials</span>: <span class="literal">false</span>, <span class="comment">// 默认</span></span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `adapter` 允许自定义处理请求，以使测试更轻松</span></span><br><span class="line">  	<span class="comment">// 返回一个 promise 并应用一个有效的响应 (查阅 [response docs](#response-api)).</span></span><br><span class="line">  	<span class="attr">adapter</span>: <span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `auth` 表示应该使用 HTTP 基础验证，并提供凭据</span></span><br><span class="line">  	<span class="comment">// 这将设置一个 `Authorization` 头，覆写掉现有的任意使用 `headers` 设置的自定义`Authorization`头</span></span><br><span class="line">  	<span class="attr">auth</span>: &#123;</span><br><span class="line">    	<span class="attr">username</span>: <span class="string">&quot;janedoe&quot;</span>,</span><br><span class="line">    	<span class="attr">password</span>: <span class="string">&quot;s00pers3cret&quot;</span></span><br><span class="line">  	&#125;,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `responseType` 表示服务器响应的数据类型，可以是&quot;arraybuffer&quot;,&quot;blob&quot;,&quot;document&quot;,&quot;json&quot;,&quot;text&quot;,&quot;stream&quot;</span></span><br><span class="line">  	<span class="attr">responseType</span>: <span class="string">&quot;json&quot;</span>, <span class="comment">// 默认</span></span><br><span class="line">      </span><br><span class="line">  	<span class="comment">// `responseEncoding` 表示用于解码响应的编码</span></span><br><span class="line">  	<span class="attr">responseEncoding</span>:<span class="string">&#x27;utf8&#x27;</span>,	<span class="comment">// 默认</span></span><br><span class="line">      </span><br><span class="line">  	<span class="comment">// `xsrfCookieName` 是用作 xsrf token 的值的cookie的名称</span></span><br><span class="line">  	<span class="attr">xsrfCookieName</span>: <span class="string">&quot;XSRF-TOKEN&quot;</span>, <span class="comment">// 默认</span></span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `xsrfHeaderName` 是承载 xsrf token 的值的 HTTP 头的名称</span></span><br><span class="line">  	<span class="attr">xsrfHeaderName</span>: <span class="string">&quot;X-XSRF-TOKEN&quot;</span>, <span class="comment">// 默认</span></span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `onUploadProgress` 允许为上传处理进度事件</span></span><br><span class="line">  	<span class="attr">onUploadProgress</span>: <span class="function"><span class="keyword">function</span> (<span class="params">progressEvent</span>) </span>&#123;</span><br><span class="line">    	<span class="comment">// 对原生进度事件的处理</span></span><br><span class="line">  	&#125;,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `onDownloadProgress` 允许为下载处理进度事件</span></span><br><span class="line">  	<span class="attr">onDownloadProgress</span>: <span class="function"><span class="keyword">function</span> (<span class="params">progressEvent</span>) </span>&#123;</span><br><span class="line">    	<span class="comment">// 对原生进度事件的处理</span></span><br><span class="line">  	&#125;,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `maxContentLength` 定义允许的响应内容的最大尺寸</span></span><br><span class="line">  	<span class="attr">maxContentLength</span>: <span class="number">2000</span>,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `validateStatus` 定义对于给定的HTTP 响应状态码是 resolve 或 reject  promise</span></span><br><span class="line">  	<span class="comment">// 如果 `validateStatus` 返回 `true` (或者设置为 `null`或 `undefined`)，promise 将被 resolve; 否则，promise 将被 rejecte</span></span><br><span class="line">  	<span class="attr">validateStatus</span>: <span class="function"><span class="keyword">function</span> (<span class="params">status</span>) </span>&#123;</span><br><span class="line">    	<span class="keyword">return</span> status &gt;= <span class="number">200</span> &amp;&amp; status &lt; <span class="number">300</span>; <span class="comment">// 默认</span></span><br><span class="line">  	&#125;,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `maxRedirects` 定义在 node.js 中 follow 的最大重定向数目</span></span><br><span class="line">  	<span class="comment">// 如果设置为0，将不会 follow 任何重定向</span></span><br><span class="line">  	<span class="attr">maxRedirects</span>: <span class="number">5</span>, <span class="comment">// 默认</span></span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `httpAgent` 和 `httpsAgent` 分别在 node.js 中用于定义在执行 http 和 https 时使用的自定义代理。允许像这样配置选项：</span></span><br><span class="line">  	<span class="comment">// `keepAlive` 默认没有启用</span></span><br><span class="line">  	<span class="attr">httpAgent</span>: <span class="keyword">new</span> http.Agent(&#123; <span class="attr">keepAlive</span>: <span class="literal">true</span> &#125;),</span><br><span class="line">  	<span class="attr">httpsAgent</span>: <span class="keyword">new</span> https.Agent(&#123; <span class="attr">keepAlive</span>: <span class="literal">true</span> &#125;),</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// &quot;proxy&quot; 定义代理服务器的主机名称和端口</span></span><br><span class="line">  	<span class="comment">// `auth` 表示 HTTP 基础验证应当用于连接代理，并提供凭据</span></span><br><span class="line">  	<span class="comment">// 这将会设置一个 `Proxy-Authorization` 头，覆写掉已有的通过使用 `header` 设置的自定义 `Proxy-Authorization` 头。</span></span><br><span class="line">  	<span class="attr">proxy</span>: &#123;</span><br><span class="line">    	<span class="attr">host</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    	<span class="attr">port</span>: <span class="number">9000</span>,</span><br><span class="line">    	<span class="attr">auth</span>: : &#123;</span><br><span class="line">      		<span class="attr">username</span>: <span class="string">&quot;mikeymike&quot;</span>,</span><br><span class="line">      		<span class="attr">password</span>: <span class="string">&quot;rapunz3l&quot;</span></span><br><span class="line">    	&#125;</span><br><span class="line">  	&#125;,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `cancelToken` 指定用于取消请求的 cancel token</span></span><br><span class="line">  	<span class="attr">cancelToken</span>: <span class="keyword">new</span> CancelToken(<span class="function"><span class="keyword">function</span> (<span class="params">cancel</span>) </span>&#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h2 id="4-axios修改默认配置">
          <a href="#4-axios修改默认配置" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-axios修改默认配置" class="headerlink" title="4.axios修改默认配置"></a>4.axios修改默认配置</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">axios.defaults.method = <span class="string">&#x27;GET&#x27;</span>	<span class="comment">// 设置默认请求类型</span></span><br><span class="line">axios.defaults.baseURIL = <span class="string">&#x27;&#x27;</span>	<span class="comment">// 设置基础URL</span></span><br><span class="line">axios.defaults.timeout = <span class="number">3000</span>	<span class="comment">// 设置默认超时时间</span></span><br><span class="line">...</span><br></pre></td></tr></table></div></figure>


        <h2 id="5-axios创建实例对象发送请求">
          <a href="#5-axios创建实例对象发送请求" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-axios创建实例对象发送请求" class="headerlink" title="5.axios创建实例对象发送请求"></a>5.axios创建实例对象发送请求</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建实例对象</span></span><br><span class="line"><span class="keyword">const</span> temp = axios.create(&#123;</span><br><span class="line">    <span class="attr">baseURL</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">timeout</span>:<span class="number">2000</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 这里的temp和axios对象几近是一样的</span></span><br><span class="line">temp(&#123;</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 作用：对于不同的请求接口，需要传的请求头不同或者请求域名不同，此时需要一个新的axios实例进行请求</span></span><br></pre></td></tr></table></div></figure>


        <h2 id="6-拦截器">
          <a href="#6-拦截器" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-拦截器" class="headerlink" title="6.拦截器"></a>6.拦截器</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 请求拦截器</span></span><br><span class="line"><span class="comment">// 作用：在发送请求前对发送的数据内容进行检测</span></span><br><span class="line">axios.interceptors.request.use(<span class="function"><span class="keyword">function</span>(<span class="params">config</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> config</span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line"><span class="comment">// 作用：当服务器返回结果后，在处理结果之前对结果进行预处理</span></span><br><span class="line">axios.interceptors.response.use(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> response</span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></div></figure>


        <h2 id="7-取消请求">
          <a href="#7-取消请求" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-取消请求" class="headerlink" title="7.取消请求"></a>7.取消请求</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2.声明全局变量</span></span><br><span class="line"><span class="keyword">let</span> cancel = <span class="literal">null</span></span><br><span class="line">axios(&#123;</span><br><span class="line">    <span class="attr">method</span>:<span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="comment">// 1.添加配置对象对象的属性</span></span><br><span class="line">    <span class="attr">cancelToken</span>: <span class="keyword">new</span> axios.CancelToken(<span class="function"><span class="keyword">function</span>(<span class="params">c</span>)</span>&#123;</span><br><span class="line">        <span class="comment">// 3.将 c 的值赋值给cancel</span></span><br><span class="line">        cancel = c</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">    </span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.取消请求</span></span><br><span class="line">cancel()</span><br></pre></td></tr></table></div></figure>

</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2022/01/24/%E8%87%AA%E9%80%82%E5%BA%94%E5%B8%83%E5%B1%80/">自适应布局</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2022-01-24</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2022-02-21</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="适配布局">
          <a href="#适配布局" class="heading-link"><i class="fas fa-link"></i></a><a href="#适配布局" class="headerlink" title="适配布局"></a>适配布局</h1>
      <ul>
<li>flex布局</li>
<li>响应式布局(如bootstrap的栅格系统)</li>
<li>rem</li>
<li>rpx(小程序)</li>
<li>……</li>
</ul>

        <h2 id="一、rem">
          <a href="#一、rem" class="heading-link"><i class="fas fa-link"></i></a><a href="#一、rem" class="headerlink" title="一、rem"></a>一、rem</h2>
      
        <h3 id="1-简介">
          <a href="#1-简介" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-简介" class="headerlink" title="1.简介"></a>1.简介</h3>
      <p>rem是一个相对单位，类似于em，em是父元素字体大小。</p>
<p>不同的是rem的基准是相对于html元素的字体大小。</p>
<figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></div></figure>

<figure class="highlight css"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">html</span>&#123;</span><br><span class="line">    <span class="attribute">font-size</span>:<span class="number">14px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">div</span>&#123;</span><br><span class="line">    <span class="attribute">font-size</span>:<span class="number">12px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">p</span>&#123;</span><br><span class="line">    <span class="comment">/*1.em是相对于父元素的字体大小来说的</span></span><br><span class="line"><span class="comment">    	此时宽度和高度都是120px</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="comment">/*width:10em;</span></span><br><span class="line"><span class="comment">    height:10em;*/</span></span><br><span class="line">    <span class="comment">/*2.rem是相对于html元素的字体大小来说的</span></span><br><span class="line"><span class="comment">    	此时宽度和高度都是140px</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="attribute">width</span>:<span class="number">10rem</span>;</span><br><span class="line">    <span class="attribute">height</span>:<span class="number">10rem</span>;</span><br><span class="line">    <span class="comment">/*3.rem的优点就是可以通过修改html里面的文字大小来改变页面中元素的大小</span></span><br><span class="line"><span class="comment">    	可以整体控制</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>




        <h2 id="二、媒体查询">
          <a href="#二、媒体查询" class="heading-link"><i class="fas fa-link"></i></a><a href="#二、媒体查询" class="headerlink" title="二、媒体查询"></a>二、媒体查询</h2>
      
        <h3 id="1-简介-1">
          <a href="#1-简介-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-简介-1" class="headerlink" title="1.简介"></a>1.简介</h3>
      <p>媒体查询(Media Query)是CSS3新语法</p>
<ul>
<li>使用@media查询，可以针对不同的媒体类型定义不同的样式</li>
<li>@media可以针对不同的屏幕尺寸设置不同的样式</li>
<li>当你重置浏览器大小的过程中，页面也会根据浏览器的宽度和高度重新渲染页面</li>
<li>目前针对很多苹果手机、Android手机、平板等设备都用得到多媒体查询</li>
</ul>

        <h3 id="2-语法规范">
          <a href="#2-语法规范" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-语法规范" class="headerlink" title="2.语法规范"></a>2.语法规范</h3>
      <figure class="highlight css"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@media</span> mediatype <span class="keyword">and</span>|<span class="keyword">not</span>|<span class="keyword">only</span> (media feature)&#123;</span><br><span class="line">    css-<span class="selector-tag">Code</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<ul>
<li>用@media开头</li>
<li>mediatype 媒体类型</li>
<li>关键字 and not only</li>
<li>media feature 媒体特性 必须有小括号包含</li>
</ul>

        <h4 id="1-媒体类型">
          <a href="#1-媒体类型" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-媒体类型" class="headerlink" title="(1) 媒体类型"></a>(1) 媒体类型</h4>
      <p>all - 用于所有设备</p>
<p>print - 用于打印机和打印预览</p>
<p>screen - 用于电脑屏幕、平板电脑、智能手机等</p>

        <h4 id="2-关键字">
          <a href="#2-关键字" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-关键字" class="headerlink" title="(2) 关键字"></a>(2) 关键字</h4>
      <p>and - 将多媒体特性连接到一起，相当于’且’的意思</p>
<p>not - 排除某个媒体类型，相当于’非’的意思，可以省略</p>
<p>only - 指定特定的媒体类型，可以省略</p>

        <h4 id="3-媒体特性">
          <a href="#3-媒体特性" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-媒体特性" class="headerlink" title="(3) 媒体特性"></a>(3) 媒体特性</h4>
      <p>不同媒体类型都具有不同的媒体特性，根据不同媒体类型的媒体特性设置不同的展示分格</p>
<p>比如：</p>
<p>width - 宽度</p>
<p>max-width - 最大宽度</p>
<p>min-width - 最小宽度</p>
<figure class="highlight css"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 这句话的意思是：在我们屏幕上 并且 最大宽度是800像素 设置我们想要的样式 */</span></span><br><span class="line"><span class="keyword">@media</span> screen <span class="keyword">and</span> (<span class="attribute">max-width</span>:<span class="number">800px</span>)&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="3-引入资源">
          <a href="#3-引入资源" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-引入资源" class="headerlink" title="3.引入资源"></a>3.引入资源</h3>
      <figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&#x27;stylesheet&#x27;</span> <span class="attr">href</span>=<span class="string">&quot;1.css&quot;</span> <span class="attr">media</span>=<span class="string">&quot;screen and (min-width:300px)&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&#x27;stylesheet&#x27;</span> <span class="attr">href</span>=<span class="string">&quot;2.css&quot;</span> <span class="attr">media</span>=<span class="string">&quot;screen and (min-width:600px)&quot;</span>&gt;</span></span><br></pre></td></tr></table></div></figure>




        <h2 id="三、less">
          <a href="#三、less" class="heading-link"><i class="fas fa-link"></i></a><a href="#三、less" class="headerlink" title="三、less"></a>三、less</h2>
      
        <h3 id="1-less变量">
          <a href="#1-less变量" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-less变量" class="headerlink" title="1.less变量"></a>1.less变量</h3>
      <ul>
<li>必须有@为前缀</li>
<li>不能包含特殊字符</li>
<li>不能以数字开头</li>
<li>大小写敏感</li>
</ul>
<figure class="highlight less"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@变量名:值;</span><br><span class="line"><span class="comment">// 定义一个白色的变量</span></span><br><span class="line"><span class="variable">@color:</span><span class="number">#fff</span>;</span><br><span class="line"><span class="comment">// 定义一个字体为14像素的变量</span></span><br><span class="line"><span class="variable">@font14:</span><span class="number">14px</span>;</span><br><span class="line"><span class="selector-tag">body</span>&#123;</span><br><span class="line">    <span class="attribute">background-color</span>:<span class="variable">@color</span>;</span><br><span class="line">    <span class="attribute">font-size</span>:<span class="variable">@font14</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="2-less嵌套">
          <a href="#2-less嵌套" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-less嵌套" class="headerlink" title="2.less嵌套"></a>2.less嵌套</h3>
      <figure class="highlight less"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.header</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">height</span>:<span class="number">200px</span>;</span><br><span class="line">    <span class="selector-tag">a</span>&#123;</span><br><span class="line">        <span class="attribute">color</span>:red;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 等同于</span></span><br><span class="line"><span class="selector-class">.header</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">height</span>:<span class="number">200px</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-class">.header</span> <span class="selector-tag">a</span>&#123;</span><br><span class="line">    <span class="attribute">color</span>:red;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight less"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 如果有伪类、交集选择器、伪元素选择器</span></span><br><span class="line"><span class="comment">// 内层选择器的前面需要加&amp;</span></span><br><span class="line"><span class="selector-class">.header</span>&#123;</span><br><span class="line">    <span class="attribute">width</span>:<span class="number">200px</span>;</span><br><span class="line">    <span class="attribute">height</span>:<span class="number">200px</span>;</span><br><span class="line">    <span class="selector-tag">&amp;</span><span class="selector-pseudo">:hover</span>&#123;</span><br><span class="line">        <span class="attribute">color</span>:blue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>


        <h3 id="3-less运算">
          <a href="#3-less运算" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-less运算" class="headerlink" title="3.less运算"></a>3.less运算</h3>
      <ul>
<li>注意乘号（ * ）和（ / ）的写法</li>
<li>运算符的左右两侧必须空格隔开</li>
<li>两个数参与运算，如果只有一个有单位，则最后结果就以该单位为准</li>
<li>两个数参与运算，如果两个数都有单位，运算结果取第一个数的单位</li>
</ul>

        <h2 id="四、rem适配方案">
          <a href="#四、rem适配方案" class="heading-link"><i class="fas fa-link"></i></a><a href="#四、rem适配方案" class="headerlink" title="四、rem适配方案"></a>四、rem适配方案</h2>
      <ul>
<li>让一些不能等比自适应的元素，达到当设备尺寸发生改变的时候，等比例适配当前设备</li>
<li>使用媒体查询根据不同设备按比例设置html的字体大小，然后页面元素使用rem做尺寸单位，当html字体大小改变元素尺寸也会发生改变，从而达到等比缩放的适配</li>
</ul>

        <h3 id="技术方案1">
          <a href="#技术方案1" class="heading-link"><i class="fas fa-link"></i></a><a href="#技术方案1" class="headerlink" title="技术方案1"></a>技术方案1</h3>
      <ul>
<li>less</li>
<li>媒体查询</li>
<li>rem</li>
</ul>

        <h3 id="技术方案2">
          <a href="#技术方案2" class="heading-link"><i class="fas fa-link"></i></a><a href="#技术方案2" class="headerlink" title="技术方案2"></a>技术方案2</h3>
      <ul>
<li>flexible.js</li>
<li>rem</li>
</ul>

        <h2 id="五、数据大屏适配方案">
          <a href="#五、数据大屏适配方案" class="heading-link"><i class="fas fa-link"></i></a><a href="#五、数据大屏适配方案" class="headerlink" title="五、数据大屏适配方案"></a>五、数据大屏适配方案</h2>
      <ul>
<li>利用vw、vh实现宽高比固定填充屏幕</li>
</ul>
<figure class="highlight css"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 以16/9为例 */</span></span><br><span class="line"><span class="selector-tag">div</span> &#123;</span><br><span class="line">	<span class="attribute">width</span>: <span class="number">100vw</span>;</span><br><span class="line">	<span class="attribute">height</span>: <span class="number">56.25vw</span>;</span><br><span class="line">	<span class="attribute">max-height</span>: <span class="number">100vh</span>;</span><br><span class="line">	<span class="attribute">max-width</span>: <span class="number">177.78vh</span>;</span><br><span class="line">    </span><br><span class="line">	<span class="attribute">position</span>: absolute;</span><br><span class="line">	<span class="attribute">top</span>: <span class="number">0</span>;</span><br><span class="line">	<span class="attribute">bottom</span>: <span class="number">0</span>;</span><br><span class="line">	<span class="attribute">left</span>: <span class="number">0</span>;</span><br><span class="line">	<span class="attribute">right</span>: <span class="number">0</span>;</span><br><span class="line">    <span class="attribute">margin</span>: auto;</span><br><span class="line">    <span class="attribute">background</span>: pink;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

</div></div></article></section><nav class="paginator"><div class="paginator-inner"><span class="page-number current">1</span></div></nav></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><section class="sidebar-toc hide"></section><!-- ov = overview--><section class="sidebar-ov"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/image/site/head.png" alt="avatar"></div><p class="sidebar-ov-author__text">hello world</p></div><div class="sidebar-ov-social"><a class="sidebar-ov-social-item" href="https://github.com/LonelyTaker" target="_blank" rel="noopener" data-popover="Github" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-github"></i></span></a><a class="sidebar-ov-social-item" href="Ym1104340863" target="_blank" rel="noopener" data-popover="微信" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-weixin"></i></span></a><a class="sidebar-ov-social-item" href="1104340863" target="_blank" rel="noopener" data-popover="QQ" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-qq"></i></span></a></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">9</div><div class="sidebar-ov-state-item__name">归档</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">4</div><div class="sidebar-ov-state-item__name">分类</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">4</div><div class="sidebar-ov-state-item__name">标签</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="知识共享许可协议" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2022</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>LonelyTaker</span></div><div><span>由 <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> 强力驱动</span><span> v6.0.0</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script></body></html>