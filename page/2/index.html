<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><link rel="icon" href="/image/site/favicon/favicon-16x16.png?v=2.6.2" type="image/png" sizes="16x16"><link rel="icon" href="/image/site/favicon/favicon-32x32.png?v=2.6.2" type="image/png" sizes="32x32"><link rel="apple-touch-icon" href="/image/site/favicon/favicon-180x180.png?v=2.6.2" sizes="180x180"><meta property="og:type" content="website">
<meta property="og:title" content="LonelyTaker&#39;s Blog">
<meta property="og:url" content="https://lonelytaker.cn/page/2/index.html">
<meta property="og:site_name" content="LonelyTaker&#39;s Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="LonelyTaker">
<meta property="article:tag" content="个人博客">
<meta name="twitter:card" content="summary"><title>LonelyTaker's Blog</title><link ref="canonical" href="https://lonelytaker.cn/page/2/index.html"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.12.1/css/all.min.css" type="text/css"><link rel="stylesheet" href="/css/index.css?v=2.6.2"><script>var Stun = window.Stun || {};
var CONFIG = {
  root: '/',
  algolia: undefined,
  assistSearch: undefined,
  fontIcon: {"prompt":{"success":"fas fa-check-circle","info":"fas fa-arrow-circle-right","warning":"fas fa-exclamation-circle","error":"fas fa-times-circle"},"copyBtn":"fas fa-copy"},
  sidebar: {"offsetTop":"20px","tocMaxDepth":6},
  header: {"enable":true,"showOnPost":false,"scrollDownIcon":true},
  postWidget: {"endText":true},
  nightMode: {"enable":true},
  back2top: {"enable":true},
  codeblock: {"style":"default","highlight":"light","wordWrap":false},
  reward: false,
  fancybox: false,
  zoomImage: {"gapAside":"20px"},
  galleryWaterfall: undefined,
  lazyload: false,
  pjax: undefined,
  externalLink: {"icon":{"enable":true,"name":"fas fa-external-link-alt"}},
  shortcuts: undefined,
  prompt: {"copyButton":"复制","copySuccess":"复制成功","copyError":"复制失败"},
  sourcePath: {"js":"js","css":"css","images":"images"},
};

window.CONFIG = CONFIG;</script><meta name="generator" content="Hexo 6.0.0"></head><body><div class="container" id="container"><header class="header" id="header"><div class="header-inner"><nav class="header-nav header-nav--fixed"><div class="header-nav-inner"><div class="header-nav-menubtn"><i class="fas fa-bars"></i></div><div class="header-nav-menu"><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/"><span class="header-nav-menu-item__icon"><i class="fas fa-home"></i></span><span class="header-nav-menu-item__text">首页</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/archives/"><span class="header-nav-menu-item__icon"><i class="fas fa-folder-open"></i></span><span class="header-nav-menu-item__text">归档</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/categories/"><span class="header-nav-menu-item__icon"><i class="fas fa-layer-group"></i></span><span class="header-nav-menu-item__text">分类</span></a></div><div class="header-nav-menu-item"><a class="header-nav-menu-item__link" href="/tags/"><span class="header-nav-menu-item__icon"><i class="fas fa-tags"></i></span><span class="header-nav-menu-item__text">标签</span></a></div></div><div class="header-nav-mode"><div class="mode"><div class="mode-track"><span class="mode-track-moon"></span><span class="mode-track-sun"></span></div><div class="mode-thumb"></div></div></div></div></nav><div class="header-banner"><div class="header-banner-info"><div class="header-banner-info__title">LonelyTaker's Blog</div><div class="header-banner-info__subtitle">走好自己的路，迈好自己的步</div></div><div class="header-banner-arrow"><div class="header-banner-arrow__icon"><i class="fas fa-angle-down"></i></div></div></div></div></header><main class="main" id="main"><div class="main-inner"><div class="content-wrap" id="content-wrap"><div class="content content-home" id="content"><section class="postlist"><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2022/01/31/git/">git</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2022-01-31</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2022-03-03</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="1-本地库初始化">
          <a href="#1-本地库初始化" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-本地库初始化" class="headerlink" title="1.本地库初始化"></a>1.本地库初始化</h1>
      <ul>
<li><strong>命令：</strong></li>
</ul>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git init</span><br></pre></td></tr></table></div></figure>

<ul>
<li><strong>注意：</strong>.git 目录中存放的是本地库相关的子目录和文件</li>
</ul>
<br>


        <h1 id="2-设置签名">
          <a href="#2-设置签名" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-设置签名" class="headerlink" title="2.设置签名"></a>2.设置签名</h1>
      <ul>
<li><p><strong>形式：</strong></p>
<p>用户名：xxx</p>
<p>Email 地址：<span class="exturl"><a class="exturl__link" href="mailto:&#120;&#120;&#120;&#64;&#x78;&#120;&#x2e;&#x78;&#120;&#x78;">&#120;&#120;&#120;&#64;&#x78;&#120;&#x2e;&#x78;&#120;&#x78;</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</li>
<li><p><strong>作用：</strong>区分不同开发人员的身份</p>
</li>
<li><p><strong>辨析：</strong>这里设置的签名和登录远程库（代码托管中心）的账号、密码没有任何关系</p>
</li>
<li><p><strong>命令：</strong></p>
</li>
</ul>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 项目级别/仓库级别：仅在当前本地库范围内有效</span></span><br><span class="line">git config user.name xxx</span><br><span class="line">git config user.email xxx@xx.xxx</span><br><span class="line"><span class="meta">#</span><span class="bash"> 用户级别：登录当前操作系统的用户范围</span></span><br><span class="line">git config --global user.name xxx</span><br><span class="line">git config --global user.email xxx@xx.xxx</span><br><span class="line"><span class="meta">#</span><span class="bash"> 优先级：就近原则（项目级别 &gt; 用户级别）</span></span><br></pre></td></tr></table></div></figure>

<br>


        <h1 id="3-添加提交以及查看状态">
          <a href="#3-添加提交以及查看状态" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-添加提交以及查看状态" class="headerlink" title="3.添加提交以及查看状态"></a>3.添加提交以及查看状态</h1>
      <ul>
<li><strong>命令：</strong></li>
</ul>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看状态</span></span><br><span class="line">git status</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将工作区的新建/修改 添加至 暂存区</span></span><br><span class="line">git add [file name]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 从暂存区撤回</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> git rm --cached [file name]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将暂存区内容 提交至 本地库</span></span><br><span class="line">git commit -m &quot;commit message&quot; [file name]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 对于已追踪的文件，可以直接添加至本地库</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> git commit -a</span></span><br></pre></td></tr></table></div></figure>

<br>


        <h1 id="4-版本前进-后退">
          <a href="#4-版本前进-后退" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-版本前进-后退" class="headerlink" title="4.版本前进/后退"></a>4.版本前进/后退</h1>
      <ul>
<li><strong>命令：</strong></li>
</ul>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看版本记录</span></span><br><span class="line">git log</span><br><span class="line"><span class="meta">#</span><span class="bash"> 简要显示版本记录</span></span><br><span class="line">git log --pretty=oneline</span><br><span class="line">git log --oneline</span><br><span class="line">git reflog</span><br><span class="line"><span class="meta">#</span><span class="bash"> 前进/后退 基于索引值操作（推荐）</span></span><br><span class="line">git reset --hard [hash]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 后退 使用^/~符号</span></span><br><span class="line">git reset --hard HEAD^	# 后退1步，n个^后退n个版本</span><br><span class="line">git reset --hard HEAD~n # 后退n步</span><br></pre></td></tr></table></div></figure>

<ul>
<li><p><strong>reset 命令的三个参数对比：</strong></p>
<p><code>--soft</code>：</p>
<p> 仅仅在本地库移动 HEAD 指针</p>
<p><code>--mixed</code>：</p>
<p> 在本地库移动 HEAD 指针并且重置暂存区</p>
<p><code>--hard</code>：</p>
<p> 在本地库移动 HEAD 指针、重置暂存区并且重置工作区</p>
</li>
</ul>
<br>


        <h1 id="5-文件差异">
          <a href="#5-文件差异" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-文件差异" class="headerlink" title="5.文件差异"></a>5.文件差异</h1>
      <ul>
<li><strong>命令：</strong></li>
</ul>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git diff [file name] # 默认将工作区文件和暂存区进行比较</span><br><span class="line">git diff [版本记录] [file name] # 将工作区文件和本地库历史记录进行比较</span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果不带文件名可以比较多个文件</span></span><br></pre></td></tr></table></div></figure>

<br>


        <h1 id="6-分支">
          <a href="#6-分支" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-分支" class="headerlink" title="6.分支"></a>6.分支</h1>
      <ul>
<li><strong>作用：</strong><ol>
<li>同时并行推进多个功能开发，提高开发效率</li>
<li>各个分支在开发过程中，如果某一个分支开发失败，不会对其他分支有任何影响</li>
</ol>
</li>
<li><strong>命令：</strong></li>
</ul>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看所有分支</span></span><br><span class="line">git branch -v</span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建分支</span></span><br><span class="line">git branch [branch name]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换分支</span></span><br><span class="line">git checkout [branch name]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 合并分支</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 先切换到接受修改的分支，再执行merge操作</span></span><br><span class="line">git checkout [接受修改的分支名]</span><br><span class="line">git merge [需要合并的分支名]</span><br></pre></td></tr></table></div></figure>

<ul>
<li><strong>冲突：</strong></li>
</ul>
<p><strong>表现：</strong></p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD</span><br><span class="line"><span class="comment">// 当前分支内容</span></span><br><span class="line">=======</span><br><span class="line"><span class="comment">// 另一个分支内容</span></span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt;</span><br></pre></td></tr></table></div></figure>

<p><strong>解决：</strong></p>
<ol>
<li>编辑文件，删除特殊符号</li>
<li>修改文件至需要的地步</li>
<li>git add [文件名]</li>
<li>git commit -m “日志信息”</li>
</ol>
<p> 注意：此时 commit 不能带具体文件名</p>
<br>


        <h1 id="7-推送到远程库">
          <a href="#7-推送到远程库" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-推送到远程库" class="headerlink" title="7.推送到远程库"></a>7.推送到远程库</h1>
      <ul>
<li><strong>命令：</strong></li>
</ul>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 本地创建远程库别名</span></span><br><span class="line">git remote add [远程主机名] [远程库地址]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 推送到远程库</span></span><br><span class="line">git push [远程主机名] [本地分支]:[远程分支]</span><br></pre></td></tr></table></div></figure>

<br>


        <h1 id="8-克隆">
          <a href="#8-克隆" class="heading-link"><i class="fas fa-link"></i></a><a href="#8-克隆" class="headerlink" title="8.克隆"></a>8.克隆</h1>
      <ul>
<li><strong>命令：</strong></li>
</ul>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git clone [远程库地址]</span><br></pre></td></tr></table></div></figure>

<ul>
<li><strong>效果：</strong><ol>
<li>完整地把远程库下载到本地</li>
<li>创建 origin 远程地址别名</li>
<li>初始化本地库</li>
</ol>
</li>
</ul>
<br>


        <h1 id="9-拉取">
          <a href="#9-拉取" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-拉取" class="headerlink" title="9.拉取"></a>9.拉取</h1>
      <ul>
<li><strong>命令：</strong></li>
</ul>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 抓取远程更新</span></span><br><span class="line">git fetch [远程主机名] [远程分支]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 合并分支</span></span><br><span class="line">git merge [远程主机名/远程分支]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 上面两步等同于</span></span><br><span class="line">git pull [远程主机名] [远程分支]:[本地分支]</span><br></pre></td></tr></table></div></figure>

<ul>
<li><strong>注意：</strong>抓取更新并不会修改本地工作区内容</li>
</ul>
<br>

<blockquote>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://www.runoob.com/git/git-basic-operations.html">https://www.runoob.com/git/git-basic-operations.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</blockquote>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2022/01/29/ES6%E6%A8%A1%E5%9D%97%E4%B8%8ECommonJS%E6%A8%A1%E5%9D%97%E7%9A%84%E5%8C%BA%E5%88%AB/">ES6模块与CommonJS模块的区别</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2022-01-29</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2022-03-03</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="1-写法不同">
          <a href="#1-写法不同" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-写法不同" class="headerlink" title="1.写法不同"></a>1.写法不同</h1>
      <p>最直观的，两者对于模块的导入导出写法不同</p>
<ul>
<li>ES6</li>
</ul>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 导出 */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> a = <span class="number">10</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> b = <span class="number">20</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;...&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 导入 */</span></span><br><span class="line"><span class="keyword">import</span> &#123;a, b&#125; <span class="keyword">from</span> <span class="string">&#x27;./test.js&#x27;</span></span><br><span class="line"><span class="keyword">import</span> c <span class="keyword">from</span> <span class="string">&#x27;./test.js&#x27;</span></span><br></pre></td></tr></table></div></figure>

<ul>
<li>CommonJS</li>
</ul>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 导出 */</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123; <span class="attr">a</span>: <span class="number">10</span>, <span class="attr">b</span>: <span class="number">20</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 导入 */</span></span><br><span class="line"><span class="keyword">let</span> test = <span class="built_in">require</span>(<span class="string">&quot;./test.js&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(test.a, test.b); <span class="comment">// 输出 10 20</span></span><br></pre></td></tr></table></div></figure>

<blockquote>
<p>注意：上述 CommonJS 导出写法会改变原本指向的内存，使其与 exports 指向不同内存空间，语法非本篇重点，可看这篇博客</p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://www.cnblogs.com/fightjianxian/p/12151010.html">https://www.cnblogs.com/fightjianxian/p/12151010.html</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</blockquote>
<br>


        <h1 id="2-加载阶段不同">
          <a href="#2-加载阶段不同" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-加载阶段不同" class="headerlink" title="2.加载阶段不同"></a>2.加载阶段不同</h1>
      <ul>
<li>CommonJS 模块加载的是对象（即<code>module.exports</code>属性），它只有在脚本运行完才会生成，所以是<code>运行时加载</code></li>
<li>而 ES6 模块不是对象，它的对外接口是一种静态定义，在代码静态解析阶段就会生成，所以是<code>编译时输出接口</code></li>
</ul>
<br>


        <h1 id="3-输出内容不同">
          <a href="#3-输出内容不同" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-输出内容不同" class="headerlink" title="3.输出内容不同"></a>3.输出内容不同</h1>
      <ul>
<li>刚刚说了 CommonJS 模块输出的是一个对象，所以是一个值的拷贝（浅拷贝）</li>
</ul>
<p>请看下面这个例子，模块内有一个变量 a 和一个自增函数</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 模块test.js */</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  a++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">a</span>: a,</span><br><span class="line">  <span class="attr">add</span>: add,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* 需要引入模块的文件main.js */</span></span><br><span class="line"><span class="keyword">let</span> mod = <span class="built_in">require</span>(<span class="string">&quot;./test.js&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(mod.a); <span class="comment">// 1</span></span><br><span class="line">mod.add();</span><br><span class="line"><span class="built_in">console</span>.log(mod.a); <span class="comment">// 1</span></span><br></pre></td></tr></table></div></figure>

<p>上述代码说明，<code>test.js</code>模块加载以后，它内部的变化影响不到已经输出的<code>mod.a</code>了，因为 a 会被缓存（a 是一个简单数据类型，导出时直接拷贝值）。除非写成一个函数，才能获得内部变动后的值</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 模块test.js */</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  a++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="keyword">get</span> <span class="title">a</span>() &#123;</span><br><span class="line">    <span class="keyword">return</span> a;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">add</span>: add,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* 需要引入模块的文件main.js */</span></span><br><span class="line"><span class="keyword">let</span> mod = <span class="built_in">require</span>(<span class="string">&quot;./test.js&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(mod.a); <span class="comment">// 1</span></span><br><span class="line">mod.add();</span><br><span class="line"><span class="built_in">console</span>.log(mod.a); <span class="comment">// 2</span></span><br></pre></td></tr></table></div></figure>

<p>上面代码中，输出的<code>a</code>实际上是一个取值器函数。如果想输出后的<code>a</code>发生改变，可以这样修改</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 模块test.js */</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.a++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">a</span>: a,</span><br><span class="line">  <span class="attr">add</span>: add,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* 需要引入模块的文件main.js */</span></span><br><span class="line"><span class="keyword">let</span> mod = <span class="built_in">require</span>(<span class="string">&quot;./test.js&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(mod.a); <span class="comment">// 1</span></span><br><span class="line">mod.add();</span><br><span class="line"><span class="built_in">console</span>.log(mod.a); <span class="comment">// 2</span></span><br></pre></td></tr></table></div></figure>

<p>这样改变的是输出的对象的<code>a</code>属性，模块内部并未受影响</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 模块test.js */</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">this</span>.a++;</span><br><span class="line">  <span class="built_in">console</span>.log(a); <span class="comment">// 1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">a</span>: a,</span><br><span class="line">  <span class="attr">add</span>: add,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* 需要引入模块的文件main.js */</span></span><br><span class="line"><span class="keyword">let</span> mod = <span class="built_in">require</span>(<span class="string">&quot;./test.js&quot;</span>);</span><br><span class="line">mod.add();</span><br><span class="line"><span class="built_in">console</span>.log(mod.a); <span class="comment">// 2</span></span><br></pre></td></tr></table></div></figure>

<p>这或许对你理解<code>CommonJS模块输出的是一个对象</code>有所帮助</p>
<ul>
<li>而 ES6 模块输出的是值的引用</li>
</ul>
<p>ES6 模块的运行机制与 CommonJS 不一样。JS 引擎对脚本静态分析的时候，遇到模块加载命令<code>import</code>，就会生成一个<code>只读引用</code>。等到脚本真正执行时，再根据这个只读引用，到被加载的那个模块里面去取值。同样的代码</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 模块test.js */</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  a++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* 需要引入模块的文件main.js */</span></span><br><span class="line"><span class="keyword">import</span> &#123; a, add &#125; <span class="keyword">from</span> <span class="string">&quot;./test.js&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// 3</span></span><br><span class="line">add();</span><br><span class="line"><span class="built_in">console</span>.log(a); <span class="comment">// 4</span></span><br></pre></td></tr></table></div></figure>

<p>上述代码说明 ES6 模块输出的变量<code>a</code>完全反应其在所在模块内部的变化</p>
<br>


        <h1 id="4-加载方式不同">
          <a href="#4-加载方式不同" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-加载方式不同" class="headerlink" title="4.加载方式不同"></a>4.加载方式不同</h1>
      <ul>
<li>CommonJS 模块的<code>require()</code>是同步加载模块</li>
<li>ES6 模块的<code>import</code>命令是异步加载，有一个独立的模块依赖的解析阶段</li>
</ul>
<br>

<blockquote>
<p>参考自阮一峰老师的博客</p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://es6.ruanyifeng.com/#docs/module-loader#ES6-%E6%A8%A1%E5%9D%97%E4%B8%8E-CommonJS-%E6%A8%A1%E5%9D%97%E7%9A%84%E5%B7%AE%E5%BC%82">https://es6.ruanyifeng.com/#docs/module-loader#ES6-%E6%A8%A1%E5%9D%97%E4%B8%8E-CommonJS-%E6%A8%A1%E5%9D%97%E7%9A%84%E5%B7%AE%E5%BC%82</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</blockquote>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2022/01/24/webpack/">webpack</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2022-01-24</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2022-03-16</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="一-简介">
          <a href="#一-简介" class="heading-link"><i class="fas fa-link"></i></a><a href="#一-简介" class="headerlink" title="一.简介"></a>一.简介</h1>
      <p>webpack 是一个构建工具，是一个静态模块打包器(module bundler)。</p>
<br>


        <h1 id="二-Webpack-五个核心概念">
          <a href="#二-Webpack-五个核心概念" class="heading-link"><i class="fas fa-link"></i></a><a href="#二-Webpack-五个核心概念" class="headerlink" title="二.Webpack 五个核心概念"></a>二.Webpack 五个核心概念</h1>
      
        <h2 id="1-Entry">
          <a href="#1-Entry" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-Entry" class="headerlink" title="1.Entry"></a>1.Entry</h2>
      <p>入口，指示 Webpack 以哪个文件为入口起点开始打包，分析构建内部依赖图</p>

        <h2 id="2-Output">
          <a href="#2-Output" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-Output" class="headerlink" title="2.Output"></a>2.Output</h2>
      <p>输出，指示 Webpack 打包后的资源 bundles 输出到哪里去，以及如何命名。</p>

        <h2 id="3-Loader">
          <a href="#3-Loader" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-Loader" class="headerlink" title="3.Loader"></a>3.Loader</h2>
      <p>Loader 让 Webpack 能够去处理那些非 JavaScript 文件(webpack 自身只能理解 JavaScript)</p>

        <h2 id="4-Plugins">
          <a href="#4-Plugins" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-Plugins" class="headerlink" title="4.Plugins"></a>4.Plugins</h2>
      <p>插件可以用执行范围更广的任务。插件的范围包括：从打包优化和压缩，一直到重新定义环境中的变量等。</p>

        <h2 id="5-Mode">
          <a href="#5-Mode" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-Mode" class="headerlink" title="5.Mode"></a>5.Mode</h2>
      <p>模式指示 Webpack 使用相应模式的配置。</p>
<ul>
<li>development - 开发模式</li>
<li>production - 生产模式</li>
</ul>
<br>


        <h1 id="三-初体验">
          <a href="#三-初体验" class="heading-link"><i class="fas fa-link"></i></a><a href="#三-初体验" class="headerlink" title="三.初体验"></a>三.初体验</h1>
      <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">运行指令</span><br><span class="line">开发环境: webpack ./index.js -o ./build/built.js --mode=development</span><br><span class="line">    webpack会以index.js为入口文件开始打包，打包后输出到./build/built.js</span><br><span class="line">    整体打包环境是开发环境</span><br><span class="line">生产环境: webpack ./index.js -o ./build/built.js --mode=production</span><br></pre></td></tr></table></div></figure>

<p>结论：</p>
<ul>
<li>webpack 可以处理 js/json 资源，不能处理 css/img 等其他资源</li>
<li>生产环境和开发环境能将 ES6 模块化编译成浏览器能识别的模块化</li>
<li>生产环境比开发环境多一个压缩 js 代码</li>
</ul>
<p><code>webpack.config.js</code>是 webpack 的配置文件</p>
<p>模块化默认采用 commonJS，因为所有构建工具都是基于 Nodejs 平台运行的</p>
<br>


        <h2 id="1-打包样式文件">
          <a href="#1-打包样式文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-打包样式文件" class="headerlink" title="1.打包样式文件"></a>1.打包样式文件</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      <span class="comment">// 详细loader配置</span></span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 匹配哪些文件</span></span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        <span class="comment">// 使用哪些loader进行处理</span></span><br><span class="line">        use: [</span><br><span class="line">          <span class="comment">// use数组中loader执行顺序：从右到左(从下到上)依次执行</span></span><br><span class="line">          <span class="comment">// 创建style标签，将js中的样式资源插入进行，添加到head中生效</span></span><br><span class="line">          <span class="string">&quot;style-loader&quot;</span>,</span><br><span class="line">          <span class="comment">// 将css文件变成commonjs模块加载到js中，里面内容是样式字符串</span></span><br><span class="line">          <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.less$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="string">&quot;style-loader&quot;</span>,</span><br><span class="line">          <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">          <span class="comment">// 将less文件编译成css文件</span></span><br><span class="line">          <span class="string">&quot;less-loader&quot;</span>,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<br>


        <h2 id="2-打包-html-文件">
          <a href="#2-打包-html-文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-打包-html-文件" class="headerlink" title="2.打包 html 文件"></a>2.打包 html 文件</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> htmlWebpackPlugin = <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">  <span class="comment">// 复制 &#x27;./src/index.html&#x27;文件，并自动引入打包输出的所有资源(JS/CSS)</span></span><br><span class="line">  <span class="attr">template</span>: <span class="string">&quot;./src/index.html&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">plugins</span>: [htmlWebpackPlugin],</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<br>


        <h2 id="3-打包资源文件">
          <a href="#3-打包资源文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-打包资源文件" class="headerlink" title="3.打包资源文件"></a>3.打包资源文件</h2>
      <p>在<code>Webpack5</code>之前通常使用：</p>
<ul>
<li><code>raw-loader</code>将文件导入为字符串</li>
<li><code>url-loader</code>将文件作为 data URI 内联到 bundle 中</li>
<li><code>file-loader</code>将文件发送到输出目录</li>
</ul>
<p>而在<code>Webpack5</code>中使用 4 种新的模块类型来替代这些 loader：</p>
<ul>
<li><code>asset/resource</code>：发送一个单独的文件并导出 URL。之前使用<code>file-loader</code>实现</li>
<li><code>asset/inline</code>：导出一个资源的 data URI。之前使用<code>url-loader</code>实现</li>
<li><code>asset/source</code>：导出资源的源代码。之前使用<code>raw-loader</code>实现</li>
<li><code>asset</code>：导出一个 data URI 和发送一个单独的文件之间自动选择。之前使用<code>url-loader</code>并配置资源体积限制实现</li>
</ul>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(jpg|png|gif)$/</span>,</span><br><span class="line">        type: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">        <span class="attr">generator</span>: &#123;</span><br><span class="line">          <span class="attr">filename</span>: <span class="string">&quot;[hash:10].[ext]&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">parser</span>: &#123;</span><br><span class="line">          <span class="attr">dataUrlCondition</span>: &#123;</span><br><span class="line">            <span class="attr">maxSize</span>: <span class="number">8</span> * <span class="number">1024</span>, <span class="comment">// 设置自动选择临界值</span></span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<br>


        <h2 id="4-打包-JS-文件">
          <a href="#4-打包-JS-文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-打包-JS-文件" class="headerlink" title="4.打包 JS 文件"></a>4.打包 JS 文件</h2>
      <p>浏览器并不支持一些 ES6 的高级语法，所以需要对 JS 代码做兼容性处理，让它能够被浏览器运行。</p>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装babel-loader</span></span><br><span class="line">npm install -D babel-loader @babel/core @babel/preset-env</span><br></pre></td></tr></table></div></figure>

<ul>
<li><code>babel-loader</code>：在 webpack 里应用 babel 解析 ES6 的桥梁</li>
<li><code>@babel/core</code>：babel 核心模块</li>
<li><code>@babel/preset-env</code>：babel 预设，一组 babel 插件的集合</li>
</ul>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">presets</span>: [<span class="string">&quot;@babel/preset-env&quot;</span>],</span><br><span class="line">            <span class="attr">plugins</span>: [[<span class="string">&quot;@babel/plugin-transform-runtime&quot;</span>]],</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<p><code>regeneratorRuntime</code>是 webpack 打包生成的全局辅助函数，由 babel 生成，用于兼容 async/await 语法。</p>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install @babel/runtime -D</span><br><span class="line">npm install @babel/plugin-transform-runtime -D</span><br></pre></td></tr></table></div></figure>

<br>


        <h2 id="5-打包-TypeScript-文件">
          <a href="#5-打包-TypeScript-文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-打包-TypeScript-文件" class="headerlink" title="5.打包 TypeScript 文件"></a>5.打包 TypeScript 文件</h2>
      <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装 typescript ts-loader</span></span><br><span class="line">npm i typescript ts-loader -D</span><br></pre></td></tr></table></div></figure>

<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.ts$/</span>,</span><br><span class="line">        loader: <span class="string">&quot;ts-loader&quot;</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">extensions</span>: [<span class="string">&quot;.ts&quot;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 自动创建ts配置文件</span></span><br><span class="line">npx tsc --init</span><br></pre></td></tr></table></div></figure>

<br>


        <h2 id="6-devServer-配置">
          <a href="#6-devServer-配置" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-devServer-配置" class="headerlink" title="6.devServer 配置"></a>6.devServer 配置</h2>
      <p>作用：自动化（自动编译，自动打开浏览器，自动刷新浏览器…）</p>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 需要安装webpack-dev-server</span></span><br><span class="line">npm install webpack-dev-server</span><br></pre></td></tr></table></div></figure>

<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="comment">// 构建后路径</span></span><br><span class="line">    <span class="attr">static</span>: resolve(__dirname, <span class="string">&quot;./dist&quot;</span>),</span><br><span class="line">    <span class="comment">// 启动gzip压缩</span></span><br><span class="line">    <span class="attr">compress</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 端口号</span></span><br><span class="line">    <span class="attr">port</span>: <span class="number">3000</span>,</span><br><span class="line">    <span class="comment">// 自动打开浏览器</span></span><br><span class="line">    <span class="attr">open</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 添加头部信息</span></span><br><span class="line">    <span class="attr">headers</span>: &#123;</span><br><span class="line">      <span class="string">&quot;x-Access-Token&quot;</span>: <span class="string">&quot;xxx&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 服务器代理</span></span><br><span class="line">    <span class="comment">/* </span></span><br><span class="line"><span class="comment">        	作用：本地调试解决跨域问题</span></span><br><span class="line"><span class="comment">        	假如后端服务运行在http://localhost:9000，请求地址http://localhost:9000/api/hello</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    <span class="attr">proxy</span>: &#123;</span><br><span class="line">      <span class="string">&quot;/api&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">target</span>: <span class="string">&quot;http://localhost:9000&quot;</span>, <span class="comment">// 开启代理后，请求地址/api/hello -&gt; http://localhost:9000/api/hello</span></span><br><span class="line">        <span class="attr">pathRewrite</span>: &#123; <span class="string">&quot;^/api&quot;</span>: <span class="string">&quot;&quot;</span> &#125;, <span class="comment">// 如果重写路径，请求地址/api/hello -&gt; http://localhost:9000/hello</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        	如果开发SPA（单页面应用），浏览器在刷新或跳转页面时可能会报错（404）</span></span><br><span class="line"><span class="comment">        	这类单页应用要求服务器在针对任何命中的路由时都返回一个对应的HTML文件</span></span><br><span class="line"><span class="comment">        	配置historyApiFallback可以解决这一问题，这会使得任何请求都会返回根页面</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    <span class="attr">historyApiFallback</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="comment">// 允许局域网内访问</span></span><br><span class="line">    <span class="attr">host</span>: <span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">    <span class="attr">client</span>: &#123;</span><br><span class="line">      <span class="comment">// 取消发生错误时的覆盖层</span></span><br><span class="line">      <span class="attr">overlay</span>: <span class="literal">false</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 执行webpack serve</span></span><br><span class="line">npx webpack serve</span><br></pre></td></tr></table></div></figure>

<br>


        <h2 id="7-提取-CSS-成单独文件">
          <a href="#7-提取-CSS-成单独文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-提取-CSS-成单独文件" class="headerlink" title="7.提取 CSS 成单独文件"></a>7.提取 CSS 成单独文件</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 提取css成单独文件</span></span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> miniCssExtractPlugin = <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">  <span class="attr">filename</span>: <span class="string">&quot;css/[name].css&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="comment">// 这个loader代替style-loader，将js中的css提取成单独文件</span></span><br><span class="line">          MiniCssExtractPlugin.loader,</span><br><span class="line">          <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [miniCssExtractPlugin],</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<br>


        <h2 id="8-压缩-CSS-文件">
          <a href="#8-压缩-CSS-文件" class="heading-link"><i class="fas fa-link"></i></a><a href="#8-压缩-CSS-文件" class="headerlink" title="8.压缩 CSS 文件"></a>8.压缩 CSS 文件</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 提取css成单独文件</span></span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> miniCssExtractPlugin = <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">  <span class="attr">filename</span>: <span class="string">&quot;css/[name].css&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 压缩css文件</span></span><br><span class="line"><span class="keyword">const</span> CssMinimizerWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cssMinimizerWebpackPlugin = <span class="keyword">new</span> CssMinimizerWebpackPlugin();</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [MiniCssExtractPlugin.loader, <span class="string">&quot;css-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [miniCssExtractPlugin],</span><br><span class="line">  <span class="comment">// 在optimization minimizer中配置</span></span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimizer</span>: [cssMinimizerWebpackPlugin],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<br>


        <h2 id="9-PostCSS">
          <a href="#9-PostCSS" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-PostCSS" class="headerlink" title="9.PostCSS"></a>9.PostCSS</h2>
      <p>PostCSS 是一个用 JavaScript 工具和插件转换 css 代码的工具。比如可以使用<code>Autoprefixer</code>插件自动获取浏览器的流行度和能够支持的属性，并根据这些数据帮我们自动地为 css 规则添加前缀，将最新的 css 语法转换成大多数浏览器都能理解地语法。</p>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装 style-loader css-loader postcss-loader</span></span><br><span class="line">npm i style-loader css-loader postcss-loader -D</span><br></pre></td></tr></table></div></figure>

<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [<span class="string">&quot;style-loader&quot;</span>, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;postcss-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装Autoprefixer插件</span></span><br><span class="line">npm i autoprefixer -D</span><br></pre></td></tr></table></div></figure>

<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// postcss.config.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">plugins</span>: [<span class="built_in">require</span>(<span class="string">&quot;autoprefixer&quot;</span>)],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="string">&quot;browserslist&quot;</span>:[</span><br><span class="line">        <span class="string">&quot;&gt; 1%&quot;</span>,				<span class="comment">// 浏览器使用率大于1%</span></span><br><span class="line">        <span class="string">&quot;last 2 versions&quot;</span>	<span class="comment">// 最新的版本</span></span><br><span class="line">    ]</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<br>


        <h2 id="10-JS-语法检查">
          <a href="#10-JS-语法检查" class="heading-link"><i class="fas fa-link"></i></a><a href="#10-JS-语法检查" class="headerlink" title="10.JS 语法检查"></a>10.JS 语法检查</h2>
      <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装eslint</span></span><br><span class="line">npx eslint --init</span><br><span class="line"><span class="meta">#</span><span class="bash"> 检查文件是否规范</span></span><br><span class="line">npx eslint ./src</span><br></pre></td></tr></table></div></figure>

<figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// .eslintrc.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;env&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;browser&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">&quot;es2021&quot;</span>: <span class="literal">true</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;extends&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;airbnb-base&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;parserOptions&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;ecmaVersion&quot;</span>:<span class="number">12</span>,</span><br><span class="line">        <span class="attr">&quot;sourceType&quot;</span>:<span class="string">&quot;module&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;rules&quot;</span>:&#123;</span><br><span class="line">        <span class="attr">&quot;no-console&quot;</span>:<span class="number">0</span>	<span class="comment">// 关闭no-console警告</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;globals&quot;</span>:&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.(js|jsx)/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        use: [<span class="string">&quot;babel-loader&quot;</span>, <span class="string">&quot;eslint-loader&quot;</span>],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<br>


        <h2 id="11-JS-压缩">
          <a href="#11-JS-压缩" class="heading-link"><i class="fas fa-link"></i></a><a href="#11-JS-压缩" class="headerlink" title="11.JS 压缩"></a>11.JS 压缩</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 压缩js</span></span><br><span class="line"><span class="keyword">const</span> TerserWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> terserWebpackPlugin = <span class="keyword">new</span> TerserWebpackPlugin(&#123;</span><br><span class="line">  <span class="attr">extractComments</span>: <span class="literal">false</span>, <span class="comment">// 不将注释提取为单独文件（打包后不会出现.LICENSE.txt文件）</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    	生产环境下会自动压缩js代码</span></span><br><span class="line"><span class="comment">    	但如果配置了optimization minimizer,需要单独配置terser，js压缩才生效</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimizer</span>: [cssMinimizerWebpackPlugin, terserWebpackPlugin],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<br>


        <h1 id="四-性能优化">
          <a href="#四-性能优化" class="heading-link"><i class="fas fa-link"></i></a><a href="#四-性能优化" class="headerlink" title="四.性能优化"></a>四.性能优化</h1>
      
        <h2 id="1-开发环境性能优化">
          <a href="#1-开发环境性能优化" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-开发环境性能优化" class="headerlink" title="1.开发环境性能优化"></a>1.开发环境性能优化</h2>
      
        <h3 id="1-热替换-热更新">
          <a href="#1-热替换-热更新" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-热替换-热更新" class="headerlink" title="(1) 热替换/热更新"></a>(1) 热替换/热更新</h3>
      <ul>
<li>热替换</li>
</ul>
<p>_hot module replacement_：热模块替换/模块热替换</p>
<p>作用：一个模块发生变化，只会重新打包这一个模块，而不是打包所有，极大提升打包构建速度</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// 开启HMR功能（默认开启）</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">            css文件：可以使用HMR功能，在style-loader中实现了</span></span><br><span class="line"><span class="comment">            js文件：默认不能使用HMR功能</span></span><br><span class="line"><span class="comment">				解决：修改js代码，添加支持HMR功能的代码</span></span><br><span class="line"><span class="comment">				注意：HMR功能对js的处理，只能处理非入口js文件的其他文件</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    <span class="attr">hot</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<p>js 文件修改</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 在入口文件末尾添加这段代码</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">module</span>.hot) &#123;</span><br><span class="line">  <span class="built_in">module</span>.hot.accept([filename], <span class="function">() =&gt;</span> &#123;&#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<ul>
<li>热更新</li>
</ul>
<p>作用：当模块发生变化时，页面重新加载</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="comment">// 热更新（默认开启）</span></span><br><span class="line">    <span class="attr">liveReload</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<br>


        <h3 id="2-source-map">
          <a href="#2-source-map" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-source-map" class="headerlink" title="(2) source-map"></a>(2) source-map</h3>
      <p>_source-map_：一种提供<code>源代码到构建后代码映射</code>的技术</p>
<p>如果构建后代码出错了，通过映射关系可以追踪到源代码错误</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;source-map&quot;</span>,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">	有以下几个参数</span></span><br><span class="line"><span class="comment">	[inline-|hidden-|eval-][nosources-][cheap-[module-]]source-map</span></span><br><span class="line"><span class="comment">	如:devtool:&#x27;inline-source-map&#x27;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	常见的几种source-map：</span></span><br><span class="line"><span class="comment">	(none)：生产环境默认值（省略devtool选项）</span></span><br><span class="line"><span class="comment">		不产生souce-map</span></span><br><span class="line"><span class="comment">	eval：开发环境默认值</span></span><br><span class="line"><span class="comment">		每个module都会通过eval()来执行，并且会在末尾追加注释//# sourceURL=xx.js</span></span><br><span class="line"><span class="comment">		提示 源代码位置</span></span><br><span class="line"><span class="comment">	source-map:</span></span><br><span class="line"><span class="comment">		生成一个.map文件，并在末尾追加注释//# sourceMappingURL=xxx.js.map指定JS引擎文件</span></span><br><span class="line"><span class="comment">		提示 源代码位置</span></span><br><span class="line"><span class="comment">	hidden-source-map:</span></span><br><span class="line"><span class="comment">		生成一个.map文件，但是不会在末尾追加注释</span></span><br><span class="line"><span class="comment">		提示 构建后代码位置</span></span><br><span class="line"><span class="comment">	inline-source-map:</span></span><br><span class="line"><span class="comment">		不会生成.map文件，而是为每个文件添加source-map的DataURL，这个DataURL是包含一个文件完成source-map信息的Base64编码，会导致文件很大</span></span><br><span class="line"><span class="comment">		提示 源代码位置</span></span><br><span class="line"><span class="comment">	eval-source-map:</span></span><br><span class="line"><span class="comment">		每个module都会通过eval()来执行，把eval的sourceURL换为完整source-map信息的DataURL</span></span><br><span class="line"><span class="comment">		提示 源代码位置，并且多一个唯一标识</span></span><br><span class="line"><span class="comment">	cheap-source-map:</span></span><br><span class="line"><span class="comment">		生成一个.map文件，但是文件中只包含行数，不包含列信息</span></span><br><span class="line"><span class="comment">		提示 源代码位置，但是只能精确到行，不能精确到列</span></span><br><span class="line"><span class="comment">	cheap-module-source-map:</span></span><br><span class="line"><span class="comment">		生成一个.map文件，但是文件中只包含行数，不包含列信息，同时对loader的source-map也进行简化</span></span><br><span class="line"><span class="comment">		提示 源代码位置，但是只能精确到行，不能精确到列</span></span><br><span class="line"><span class="comment">		module会将loader的source-map加入</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">	开发环境:eval-cheap-module-source-map</span></span><br><span class="line"><span class="comment">		eval构建速度快，同时每行代码并不会很长，所以选择cheap能进一步提高打包效率，而module能避免loader的source-map混杂，对于源代码提示位置更准确清晰</span></span><br><span class="line"><span class="comment">	生产环境:(none)</span></span><br><span class="line"><span class="comment">		source-map会暴露源代码，同时source-map文件体积相对比较巨大，与我们追求的更小更轻量的bundle相违背</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></div></figure>

<br>


        <h2 id="2-生产环境性能优化">
          <a href="#2-生产环境性能优化" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-生产环境性能优化" class="headerlink" title="2.生产环境性能优化"></a>2.生产环境性能优化</h2>
      
        <h3 id="1-oneOf">
          <a href="#1-oneOf" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-oneOf" class="headerlink" title="(1) oneOf"></a>(1) oneOf</h3>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="comment">// 以下loader只会匹配一个,匹配到后就不再进行匹配</span></span><br><span class="line">        <span class="comment">// 注意:不能有两个配置处理同一种类型文件</span></span><br><span class="line">        <span class="comment">//     如果相同文件，可提取到oneOf之外</span></span><br><span class="line">        <span class="attr">oneOf</span>: [</span><br><span class="line">          <span class="comment">// ...</span></span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">            exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">            loader: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">              <span class="comment">// ...</span></span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<br>


        <h3 id="2-缓存">
          <a href="#2-缓存" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-缓存" class="headerlink" title="(2) 缓存"></a>(2) 缓存</h3>
      <ul>
<li><p><code>hash</code>：每次 webpack 构建时会生成一个唯一的 hash 值</p>
<p>问题：因为 js 和 css 同时使用一个 hash 值。如果重新打包，会导致所有缓存失效。</p>
</li>
<li><p><code>chunkhash</code>：根据 chunk 生成的 hash 值，如果打包来源于同一个 chunk，那么 hash 值一样<br>问题：js 和 css 的 <em>chunkhash</em> 值还是一样的,因为 css 是在 js 中被引入的，所以同属于一个 chunk。</p>
</li>
<li><p><code>contenthash</code>：根据文件的内容生成 hash 值，不同文件 hash 值一定不同，并且单独管理</p>
<p>推荐使用 _contenthash_，让代码上线运行缓存更好使用</p>
</li>
</ul>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> miniCssExtractPlugin = <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">  <span class="attr">filename</span>: <span class="string">&quot;css/[name].[contenthash:8].css&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;js/[name].[contenthash:8].js&quot;</span>,</span><br><span class="line">    <span class="attr">path</span>: resolve(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [miniCssExtractPlugin],</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<br>


        <h3 id="3-代码分割">
          <a href="#3-代码分割" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-代码分割" class="headerlink" title="(3) 代码分割"></a>(3) 代码分割</h3>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    	1.可以将node_modules中代码单独打包一个chunk最终输出</span></span><br><span class="line"><span class="comment">    		作用：当自身代码更新后，浏览器会重新获取，但第三方库缓存仍然生效</span></span><br><span class="line"><span class="comment">    	2.自动分析多入口chunk中有没有公共的文件。如果有会打包成单独一个chunk</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">      <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">        name: <span class="string">&quot;vendors&quot;</span>,</span><br><span class="line">        <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<br>


        <h3 id="4-外部扩展">
          <a href="#4-外部扩展" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-外部扩展" class="headerlink" title="(4) 外部扩展"></a>(4) 外部扩展</h3>
      <p>防止将某些 import 的包打包到 bundle 中，而是在运行时再去从外部获取这些扩展依赖。例如从 CDN 引入 jQuery：</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">externalsType</span>: <span class="string">&quot;script&quot;</span>,</span><br><span class="line">  <span class="attr">externals</span>: &#123;</span><br><span class="line">    <span class="attr">jquery</span>: [<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/jquery/3.6.0/jquery.js&quot;</span>, <span class="string">&quot;$&quot;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<br>


        <h3 id="5-懒加载-预加载">
          <a href="#5-懒加载-预加载" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-懒加载-预加载" class="headerlink" title="(5) 懒加载/预加载"></a>(5) 懒加载/预加载</h3>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">&quot;index.js文件被加载&quot;</span>);</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">&quot;btn&quot;</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">/*  </span></span><br><span class="line"><span class="comment">    	lazy loading:懒加载 </span></span><br><span class="line"><span class="comment">    		当文件需要时才加载</span></span><br><span class="line"><span class="comment">    	prefetch:预加载</span></span><br><span class="line"><span class="comment">    		会在使用之前，提前加载js文件</span></span><br><span class="line"><span class="comment">    	正常加载可以认为是并行加载(同一时间加载多个文件)</span></span><br><span class="line"><span class="comment">    	预加载等其他资源加载完毕，浏览器空闲了再偷偷加载。(兼容性差，慎用)</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  <span class="comment">// 动态引入会单独打包成一个chunk</span></span><br><span class="line">  <span class="keyword">import</span>(<span class="comment">/* webpackChunkName: &#x27;test&#x27;, webpackPrefetch:true */</span> <span class="string">&quot;./test&quot;</span>).then(</span><br><span class="line">    <span class="function">(<span class="params">&#123; ml &#125;</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(ml(<span class="number">4</span>, <span class="number">5</span>));</span><br><span class="line">    &#125;</span><br><span class="line">  );</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<br>


        <h3 id="6-Tree-Shaking">
          <a href="#6-Tree-Shaking" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-Tree-Shaking" class="headerlink" title="(6) Tree Shaking"></a>(6) Tree Shaking</h3>
      <p>作用：去除无用代码，减少代码体积</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">usedExports</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<p>问题：webpack 并不是百分比进行 tree shaking，一些模块被导入了，即使没有被使用，但也会对项目产生影响，比如全局样式表。这些文件被认为是有副作用的，有副作用的文件不应该被 tree shaking</p>
<p>解决方案：使用<code>sideEffects</code></p>
<figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    	sideEffects有三种值:true,false,数组</span></span><br><span class="line"><span class="comment">    		true - 默认值</span></span><br><span class="line"><span class="comment">    		false - 表示所有代码都无副作用</span></span><br><span class="line"><span class="comment">    		[&quot;*.css&quot;] - 指定某类文件是有副作用的</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  <span class="attr">&quot;sideEffects&quot;</span>: <span class="literal">true</span></span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<br>


        <h3 id="7-渐进式网络应用程序-PWA">
          <a href="#7-渐进式网络应用程序-PWA" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-渐进式网络应用程序-PWA" class="headerlink" title="(7) 渐进式网络应用程序(PWA)"></a>(7) 渐进式网络应用程序(PWA)</h3>
      <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 添加workbox</span></span><br><span class="line">npm i workbox-webpack-plugin -D</span><br></pre></td></tr></table></div></figure>

<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> WorkboxWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;workbox-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> workboxWebpackPlugin = <span class="keyword">new</span> WorkboxWebpackPlugin.GenerateSW(&#123;</span><br><span class="line">  <span class="comment">// 这些选项帮助快速启动 ServiceWorkers</span></span><br><span class="line">  <span class="comment">// 不允许遗留任何“旧的” ServiceWorkers</span></span><br><span class="line">  <span class="attr">clientsClaim</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">skipWaiting</span>: <span class="literal">true</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">plugins</span>: [workboxWebpackPlugin],</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<p>打包后生成<code>service-worker.js</code>和<code>workbox-[hash].js</code>两个文件</p>
<p>注册 Service Worker</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="string">&quot;serviceWorker&quot;</span> <span class="keyword">in</span> navigator) &#123;</span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">&quot;load&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        navigator.serviceWorker</span><br><span class="line">            .register(<span class="string">&quot;/service-worker.js&quot;</span>)</span><br><span class="line">            .then(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;注册成功:&quot;</span>, res);</span><br><span class="line">        &#125;)</span><br><span class="line">            .catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">&quot;注册失败:&quot;</span>, err);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<br>


        <h3 id="8-dll">
          <a href="#8-dll" class="heading-link"><i class="fas fa-link"></i></a><a href="#8-dll" class="headerlink" title="(8) dll"></a>(8) dll</h3>
      <p>使用 dll 技术，对某些库（比如第三方库：jquery、react、vue…）进行单独打包。</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.dll.config.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">    <span class="attr">entry</span>: &#123;</span><br><span class="line">        <span class="comment">// 最终打包生成的[name] --&gt; jquery</span></span><br><span class="line">        <span class="comment">// [&#x27;jquery&#x27;] --&gt; 要打包的库是jquery</span></span><br><span class="line">        <span class="attr">jquery</span>: [<span class="string">&quot;jquery&quot;</span>],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">output</span>: &#123;</span><br><span class="line">        <span class="attr">filename</span>: <span class="string">&quot;[name].js&quot;</span>,</span><br><span class="line">        <span class="attr">path</span>: resolve(__dirname, <span class="string">&quot;dll&quot;</span>),</span><br><span class="line">        <span class="comment">// 打包的库里面向外暴露出去的内容叫什么名字</span></span><br><span class="line">        <span class="attr">library</span>: <span class="string">&quot;[name]_[hash]&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="comment">// 打包生成一个mainfest.json --&gt; 提供和jquery映射</span></span><br><span class="line">        <span class="keyword">new</span> webpack.Dllplugin(&#123;</span><br><span class="line">            <span class="attr">name</span>: <span class="string">&quot;[name]_[hash]&quot;</span>, <span class="comment">// 映射库的暴露的内容名称</span></span><br><span class="line">            <span class="attr">path</span>: resolve(__dirname, <span class="string">&quot;dll/manifest.json&quot;</span>),</span><br><span class="line">        &#125;),</span><br><span class="line">    ],</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<p>需要使用<code>webpack.dll.config.js</code>配置文件进行打包</p>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webpack --config webpack.dll.config.js</span><br></pre></td></tr></table></div></figure>

<p>然后配置<code>webpack.config.js</code></p>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 需要安装 add-asset-html-webpack-plugin 插件</span></span><br><span class="line">npm i add-asset-html-webpack-plugin -D</span><br></pre></td></tr></table></div></figure>

<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> AddAssetHtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;add-asset-html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">plugins</span>: [</span><br><span class="line">        <span class="comment">// 告诉webpack哪些库不参与打包</span></span><br><span class="line">        <span class="keyword">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class="line">            <span class="attr">mainfest</span>: resolve(__dirname, <span class="string">&quot;dll/manifest.json&quot;</span>),</span><br><span class="line">        &#125;),</span><br><span class="line">        <span class="comment">// 将某个文件打包输出去，并在Html自动引入该资源</span></span><br><span class="line">        <span class="keyword">new</span> AddAssetHtmlWebpackPlugin(&#123;</span><br><span class="line">            <span class="attr">filepath</span>: resolve(__dirname, <span class="string">&quot;dll/jquery.js&quot;</span>),</span><br><span class="line">        &#125;),</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<p>这个方案可以代替 <em>externals</em> 的方案</p>
<br>


        <h3 id="9-多进程打包">
          <a href="#9-多进程打包" class="heading-link"><i class="fas fa-link"></i></a><a href="#9-多进程打包" class="headerlink" title="(9) 多进程打包"></a>(9) 多进程打包</h3>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">    <span class="attr">module</span>: &#123;</span><br><span class="line">        <span class="attr">rules</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">                exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">                use: [</span><br><span class="line">                    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        				开启多进程打包(慎用)</span></span><br><span class="line"><span class="comment">        				进程启动大概600ms，进程通信也有开销</span></span><br><span class="line"><span class="comment">        				只有工作消耗时间比较长，才使用多进程打包</span></span><br><span class="line"><span class="comment">        			*/</span></span><br><span class="line">                    <span class="string">&quot;thread-loader&quot;</span>,</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">                        <span class="attr">options</span>: &#123;</span><br><span class="line">                            <span class="comment">// ...</span></span><br><span class="line">                        &#125;,</span><br><span class="line">                    &#125;,</span><br><span class="line">                ],</span><br><span class="line">            &#125;,</span><br><span class="line">        ],</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<br>


        <h2 id="3-性能优化总结">
          <a href="#3-性能优化总结" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-性能优化总结" class="headerlink" title="3.性能优化总结"></a>3.性能优化总结</h2>
      
        <h3 id="1-开发环境性能优化-1">
          <a href="#1-开发环境性能优化-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-开发环境性能优化-1" class="headerlink" title="(1) 开发环境性能优化"></a>(1) 开发环境性能优化</h3>
      <ul>
<li><p>优化代码构建速度</p>
<ul>
<li>热替换</li>
</ul>
</li>
<li><p>优化代码调试</p>
<ul>
<li><p>热更新</p>
</li>
<li><p>source-map</p>
</li>
</ul>
</li>
</ul>

        <h3 id="2-生产环境性能优化-1">
          <a href="#2-生产环境性能优化-1" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-生产环境性能优化-1" class="headerlink" title="(2) 生产环境性能优化"></a>(2) 生产环境性能优化</h3>
      <ul>
<li>优化代码构建速度<ul>
<li>oneOf</li>
<li>外部扩展</li>
<li>dll</li>
<li>多进程打包</li>
</ul>
</li>
<li>优化代码运行性能<ul>
<li>缓存</li>
<li>代码分割</li>
<li>懒加载/预加载</li>
<li>Tree Shaking</li>
<li>PWA</li>
</ul>
</li>
</ul>
<br>


        <h1 id="五-其他配置">
          <a href="#五-其他配置" class="heading-link"><i class="fas fa-link"></i></a><a href="#五-其他配置" class="headerlink" title="五.其他配置"></a>五.其他配置</h1>
      
        <h2 id="1-入口">
          <a href="#1-入口" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-入口" class="headerlink" title="1.入口"></a>1.入口</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">/*</span></span><br><span class="line"><span class="comment">    	entry:入口起点</span></span><br><span class="line"><span class="comment">    	1.String -&gt; &#x27;./src/index.js&#x27;</span></span><br><span class="line"><span class="comment">    		单入口</span></span><br><span class="line"><span class="comment">    		打包形成一个chunk，输出一个bundle文件。此时chunk的名称默认是main</span></span><br><span class="line"><span class="comment">    	2.Array -&gt; [&#x27;./src/index.js&#x27;,&#x27;./src/add.js&#x27;]</span></span><br><span class="line"><span class="comment">    		多入口</span></span><br><span class="line"><span class="comment">    		所有入口文件最终只会形成一个chunk，输出出去只有一个bundle文件</span></span><br><span class="line"><span class="comment">    	3.Object -&gt; &#123;index:&#x27;./src/index.js&#x27;, add: &#x27;./src/add.js&#x27;&#125;</span></span><br><span class="line"><span class="comment">    		多入口</span></span><br><span class="line"><span class="comment">    		有几个入口文件就形成几个chunk，输出几个bundle文件。此时chunk的名称是Object的key</span></span><br><span class="line"><span class="comment">    		特殊用法 -&gt; &#123;index:[&#x27;./src/index.js&#x27;,&#x27;./src/count.js&#x27;], add: &#x27;./src/add.js&#x27;&#125;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<br>


        <h2 id="2-模块解析">
          <a href="#2-模块解析" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-模块解析" class="headerlink" title="2.模块解析"></a>2.模块解析</h2>
      <p>webpack 通过 Resolvers 实现模块之间的依赖和引用。例如：</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&quot;lodash&quot;</span>;</span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line"><span class="keyword">const</span> add = <span class="built_in">require</span>(<span class="string">&quot;./utils/add&quot;</span>);</span><br></pre></td></tr></table></div></figure>

<p>所引用的模块可以是来自应用程序的代码，也可以是第三方库。resolver 帮助 webpack 从每个 require/import 语句中，找到需要引入到 bundle 中的模块代码。当打包模块时，webpack 使用 enhanced-resolve 来解析文件路径。</p>
<p>webpack 可以识别这些路径：</p>
<ul>
<li><p>绝对路径</p>
</li>
<li><p>相对路径</p>
</li>
<li><p>模块路径</p>
</li>
</ul>
<p>创建 <code>import</code> 或 <code>require</code> 路径的别名，来确保模块引入变得更简单：</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="comment">// 路径别称</span></span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="string">&quot;@&quot;</span>: path.resolve(__dirname, <span class="string">&quot;./src&quot;</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// 扩展名省略(按照数组顺序进行查找)</span></span><br><span class="line">    <span class="attr">extensions</span>: [<span class="string">&quot;.json&quot;</span>, <span class="string">&quot;.js&quot;</span>, <span class="string">&quot;.vue&quot;</span>],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<br>


        <h2 id="3-依赖图">
          <a href="#3-依赖图" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-依赖图" class="headerlink" title="3.依赖图"></a>3.依赖图</h2>
      <p>每当一个文件依赖另一个文件时，webpack 会直接将文件视为存在依赖关系。这使得 webpack 可以获取非代码资源，如 images 或 web 字体等。并会把它们作为依赖提供给应用程序。当 webpack 开始工作时，它会根据我们写好的配置，从入口开始，递归构建一个依赖关系图，这个依赖图包含应用程序中所需的每个模块，然后将所有模块打包为 bundle。</p>
<p>我们可以利用 bundle 分析工具可视化依赖图，这里使用<code>webpack-bundle-analyzer</code>实现：</p>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i webpack-bundle-analyzer</span><br></pre></td></tr></table></div></figure>

<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 这个插件会自动打开一个依赖关系图</span></span><br><span class="line"><span class="keyword">const</span> &#123; BundleAnalyzerPlugin &#125; = <span class="built_in">require</span>(<span class="string">&quot;webpack-bundle-analyzer&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> bundleAnalyzerPlugin = <span class="keyword">new</span> BundleAnalyzerPlugin();</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">plugins</span>: [bundleAnalyzerPlugin],</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<br>


        <h2 id="4-CSS-模块化">
          <a href="#4-CSS-模块化" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-CSS-模块化" class="headerlink" title="4.CSS 模块化"></a>4.CSS 模块化</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.css$/</span>,</span><br><span class="line">        use: [</span><br><span class="line">          <span class="string">&quot;style-loader&quot;</span>,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">loader</span>: <span class="string">&quot;css-loader&quot;</span>,</span><br><span class="line">            <span class="attr">options</span>: &#123;</span><br><span class="line">              <span class="comment">// 开启css模块</span></span><br><span class="line">              <span class="attr">modules</span>: <span class="literal">true</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">&quot;postcss-loader&quot;</span>,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<br>


        <h2 id="5-html-模板配置">
          <a href="#5-html-模板配置" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-html-模板配置" class="headerlink" title="5.html 模板配置"></a>5.html 模板配置</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> HtmlWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> htmlWebpackPlugin = <span class="keyword">new</span> HtmlWebpackPlugin(&#123;</span><br><span class="line">  <span class="comment">// 模板</span></span><br><span class="line">  <span class="attr">template</span>: <span class="string">&quot;./index.html&quot;</span>,</span><br><span class="line">  <span class="comment">// 自定义属性，可在html模板文件中使用</span></span><br><span class="line">  <span class="attr">title</span>: <span class="string">&quot;xxx&quot;</span>,</span><br><span class="line">  <span class="comment">// script标签生成在body中</span></span><br><span class="line">  <span class="attr">inject</span>: <span class="string">&quot;body&quot;</span>,</span><br><span class="line">  <span class="comment">// 指定引入的chunk</span></span><br><span class="line">  <span class="attr">chunk</span>: [],</span><br><span class="line">  <span class="comment">// 文件名(默认index.html)</span></span><br><span class="line">  <span class="attr">filename</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="comment">// 配置公共路径</span></span><br><span class="line">  <span class="attr">publicPath</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 如果配置多页面环境，可以new多个实例对象</span></span><br></pre></td></tr></table></div></figure>

<figure class="highlight html"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;zh-CN&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width,initial-scale=1.0&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>&lt;%= htmlWebpackPlugin.options.title %&gt;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">body</span>&gt;</span><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></div></figure>

<br>


        <h2 id="6-Shimming">
          <a href="#6-Shimming" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-Shimming" class="headerlink" title="6.Shimming"></a>6.Shimming</h2>
      <p>webpack 编译器能够识别遵循 ES2015 模块语法、CommonJS 或 AMD 规范编写的模块。然而，一些第三方的库(library)可能会引用一些全局依赖（例如 <code>jQuery</code> 中的 <code>$</code>）。这些库也可能创建一些需要被导出的全局变量。这些“不符合规范的模块”就是 <em>shimming</em> 发挥作用的地方。</p>
<p><em>shimming</em> 另外一个使用场景就是，当你希望 <span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Polyfill">polyfill</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span> 浏览器功能以支持更多用户时。在这种情况下，你可能只想要将这些 polyfills 提供给到需要修补(patch)的浏览器（也就是实现按需加载）。</p>
<br>


        <h3 id="1-Shimming-全局变量">
          <a href="#1-Shimming-全局变量" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-Shimming-全局变量" class="headerlink" title="(1) Shimming 全局变量"></a>(1) Shimming 全局变量</h3>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 以往的方式</span></span><br><span class="line"><span class="keyword">import</span> _ <span class="keyword">from</span> <span class="string">&quot;lodash&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(_.join([<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;webpack&quot;</span>], <span class="string">&quot; &quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">// 将lodash暴露在全局，这样就不用import导入，可以直接使用</span></span><br><span class="line"><span class="built_in">console</span>.log(_.join([<span class="string">&quot;hello&quot;</span>, <span class="string">&quot;webpack&quot;</span>], <span class="string">&quot; &quot;</span>));</span><br></pre></td></tr></table></div></figure>

<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> webpack = <span class="built_in">require</span>(<span class="string">&quot;webpack&quot;</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    <span class="keyword">new</span> webpack.ProvidePlugin(&#123;</span><br><span class="line">      <span class="attr">_</span>: <span class="string">&quot;lodash&quot;</span>,</span><br><span class="line">    &#125;),</span><br><span class="line">  ],</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<br>


        <h3 id="2-细粒度-Shimming">
          <a href="#2-细粒度-Shimming" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-细粒度-Shimming" class="headerlink" title="(2) 细粒度 Shimming"></a>(2) 细粒度 Shimming</h3>
      <p>一些传统的模块依赖的<code>this</code>指向的是<code>window</code>对象。当模块运行在 CommonJS 上下文中，这会变成一个问题，这时候的<code>this</code>指向的是<code>module.exports</code>。在这种情况下，我们可以通过使用<code>imports-loader</code>覆盖<code>this</code>指向：</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="built_in">this</span>.alert(<span class="string">&quot;hello&quot;</span>);</span><br></pre></td></tr></table></div></figure>

<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装 imports-loader</span></span><br><span class="line">npm i imports-loader -D</span><br></pre></td></tr></table></div></figure>

<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="built_in">require</span>.resolve(<span class="string">&quot;./src/index.js&quot;</span>),</span><br><span class="line">        <span class="attr">use</span>: <span class="string">&quot;imports-loader?wrapper=window&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<br>


        <h3 id="3-全局-exports">
          <a href="#3-全局-exports" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-全局-exports" class="headerlink" title="(3) 全局 exports"></a>(3) 全局 exports</h3>
      <p>将一些没有导出语句的模块添加导出：</p>
<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// globals.js</span></span><br><span class="line"><span class="keyword">const</span> file = <span class="string">&quot;example.txt&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> helpers = &#123;</span><br><span class="line">  <span class="attr">test</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">parse</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&quot;parse&quot;</span>);</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装 exports-loader</span></span><br><span class="line">npm i exports-loader -D</span><br></pre></td></tr></table></div></figure>

<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="built_in">require</span>.resolve(<span class="string">&quot;./src/globals.js&quot;</span>),</span><br><span class="line">        <span class="attr">use</span>: <span class="string">&quot;exports-loader?type=commonjs&amp;exports=file&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; file &#125; = <span class="built_in">require</span>(<span class="string">&quot;./globals.js&quot;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(file);</span><br></pre></td></tr></table></div></figure>

<br>


        <h3 id="4-加载-polyfills">
          <a href="#4-加载-polyfills" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-加载-polyfills" class="headerlink" title="(4) 加载 polyfills"></a>(4) 加载 polyfills</h3>
      <p>上面三点内容，都是在讨论处理那些遗留的旧的 package。现在我们进入第二个话题：<strong>polyfill</strong>。</p>
<p>Babel 默认只转换新的 JS 语法，而不转换新的 API。例如，Iterator、Generator、Set、Maps、Proxy、Reflect、Symbol、Promise 等全局对象，以及一些定义在全局对象上的方法（比如 Object.assign）都不会转译。 如果想使用这些新的对象和方法，则需要为当前环境提供一个 polyfill。polyfill 用来实现浏览器并不支持的原生 API 的代码。</p>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装 @babel/polyfill</span></span><br><span class="line">npm i @babel/polyfill -D</span><br></pre></td></tr></table></div></figure>

<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;@babel/polyfill&quot;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Array</span>.from([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>], <span class="function">(<span class="params">x</span>) =&gt;</span> x + x));</span><br></pre></td></tr></table></div></figure>

<p>不建议使用<code>import &#39;@babel/polyfill&#39;</code>，因为这样会全局引入整个 polyfill 包，不但包的体积大，而且会污染全局环境。</p>
<p>进一步优化：</p>
<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装 babel-loader @babel/core @babel/preset-env core-js@3</span></span><br><span class="line">npm i babel-loader @babel/core @babel/preset-env core-js@3 -D</span><br></pre></td></tr></table></div></figure>

<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        exclude: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        use: &#123;</span><br><span class="line">          <span class="attr">loader</span>: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">          <span class="attr">options</span>: &#123;</span><br><span class="line">            <span class="attr">presets</span>: [</span><br><span class="line">              [</span><br><span class="line">                <span class="string">&quot;@babel/preset-env&quot;</span>,</span><br><span class="line">                &#123;</span><br><span class="line">                  <span class="attr">targets</span>: [<span class="string">&quot;last 1 version&quot;</span>, <span class="string">&quot;&gt; 1%&quot;</span>],</span><br><span class="line">                  <span class="attr">useBuiltIns</span>: <span class="string">&quot;usage&quot;</span>,</span><br><span class="line">                  <span class="attr">corejs</span>: <span class="number">3</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">              ],</span><br><span class="line">            ],</span><br><span class="line">          &#125;,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<br>


        <h2 id="7-创建-Library">
          <a href="#7-创建-Library" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-创建-Library" class="headerlink" title="7.创建 Library"></a>7.创建 Library</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// index.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> add = <span class="function">(<span class="params">x, y</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: resolve(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;mylib.js&quot;</span>,</span><br><span class="line">    <span class="attr">library</span>: &#123;</span><br><span class="line">      <span class="comment">// library名</span></span><br><span class="line">      <span class="comment">// name:&#x27;mylib&#x27;,</span></span><br><span class="line">      <span class="comment">/* </span></span><br><span class="line"><span class="comment">            	指定打包后引入类型</span></span><br><span class="line"><span class="comment">            		window - 可以使用script标签src引入</span></span><br><span class="line"><span class="comment">            		commonjs - 可以require引入</span></span><br><span class="line"><span class="comment">            		module - 可以import引入</span></span><br><span class="line"><span class="comment">            		umd - 可以使用src、require引入，但是import引入还存在问题</span></span><br><span class="line"><span class="comment">            	注意:</span></span><br><span class="line"><span class="comment">            		1.如果type为module，不需要设置name，同时需要配置experiments outputModule为true</span></span><br><span class="line"><span class="comment">            		2.如果type为umd，还需要配置globalObject为globalThis</span></span><br><span class="line"><span class="comment">            */</span></span><br><span class="line">      <span class="attr">type</span>: <span class="string">&quot;module&quot;</span>,</span><br><span class="line">      <span class="comment">// globalObject:&#x27;globalThis&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">experiments</span>: &#123;</span><br><span class="line">    <span class="attr">outputModule</span>: <span class="literal">true</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">// ...</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<br>


        <h1 id="六-拆分开发环境和生产环境配置">
          <a href="#六-拆分开发环境和生产环境配置" class="heading-link"><i class="fas fa-link"></i></a><a href="#六-拆分开发环境和生产环境配置" class="headerlink" title="六.拆分开发环境和生产环境配置"></a>六.拆分开发环境和生产环境配置</h1>
      
        <h2 id="1-修改环境变量">
          <a href="#1-修改环境变量" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-修改环境变量" class="headerlink" title="1.修改环境变量"></a>1.修改环境变量</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 公共路径</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">env</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">mode</span>:env.production?<span class="string">&#x27;production&#x27;</span>:<span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">        <span class="attr">output</span>:&#123;</span><br><span class="line">            <span class="attr">filename</span>:<span class="string">&#x27;js/[name].[contenthash:8].js&#x27;</span>,</span><br><span class="line">            <span class="attr">path</span>:resolve(__dirname,<span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">            <span class="comment">// 所有资源引入的公共路径前缀 -&gt; &#x27;img/a.jpg&#x27; -&gt;&#x27;/img/a.jpg&#x27;</span></span><br><span class="line">            <span class="attr">publicPath</span>:<span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 通过命令行修改环境变量</span></span><br><span class="line">npx webpack --env production</span><br></pre></td></tr></table></div></figure>

<br>


        <h2 id="2-开发环境基本配置">
          <a href="#2-开发环境基本配置" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-开发环境基本配置" class="headerlink" title="2.开发环境基本配置"></a>2.开发环境基本配置</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开发环境配置webpack.config.dev.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> HtmlPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> htmlPlugin = <span class="keyword">new</span> HtmlPlugin(&#123;</span><br><span class="line">    <span class="attr">template</span>: <span class="string">&quot;./src/index.html&quot;</span>,</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;index.html&quot;</span>,</span><br><span class="line">    <span class="attr">inject</span>:<span class="string">&quot;body&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>)</span><br><span class="line"><span class="keyword">const</span> miniCssExtractPlugin = <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;css/[name].css&quot;</span>,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">mode</span>:<span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">    <span class="attr">entry</span>:<span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>:&#123;</span><br><span class="line">        <span class="attr">filename</span>:<span class="string">&#x27;js/[name].js&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>:resolve(__dirname,<span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        <span class="attr">clean</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">assetModuleFilename</span>:<span class="string">&#x27;asset/[contenthash].[ext]&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">module</span>:&#123;</span><br><span class="line">      <span class="attr">rules</span>:[...]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>:[</span><br><span class="line">        htmlPlugin,</span><br><span class="line">        miniCssExtractPlugin</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">resolve</span>:&#123;</span><br><span class="line">        <span class="attr">alias</span>:&#123;</span><br><span class="line">            <span class="string">&quot;@&quot;</span>: resolve(__dirname, <span class="string">&quot;src&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">devtool</span>:<span class="string">&#x27;eval-cheap-module-source-map&#x27;</span>,</span><br><span class="line">    <span class="attr">optimization</span>:&#123;</span><br><span class="line">        <span class="attr">splitChunks</span>:&#123;</span><br><span class="line">            <span class="attr">cacheGroups</span>:&#123;</span><br><span class="line">                <span class="attr">test</span>:<span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">                name:<span class="string">&#x27;vendors&#x27;</span>,</span><br><span class="line">                <span class="attr">chunks</span>:<span class="string">&#x27;all&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">devServer</span>:&#123;</span><br><span class="line">        <span class="attr">static</span>:<span class="string">&#x27;./dist&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 指定配置文件</span></span><br><span class="line">npx webpack --config webpack.config.dev.js</span><br><span class="line">npx webpakc serve --config webpack.config.dev.js</span><br></pre></td></tr></table></div></figure>

<br>


        <h2 id="3-生产环境基本配置">
          <a href="#3-生产环境基本配置" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-生产环境基本配置" class="headerlink" title="3.生产环境基本配置"></a>3.生产环境基本配置</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生产环境配置webpack.config.prod.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> HtmlPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> htmlPlugin = <span class="keyword">new</span> HtmlPlugin(&#123;</span><br><span class="line">    <span class="attr">template</span>: <span class="string">&quot;./src/index.html&quot;</span>,</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;index.html&quot;</span>,</span><br><span class="line">    <span class="attr">inject</span>:<span class="string">&quot;body&quot;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> miniCssExtractPlugin = <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;css/[name].[contenthash:8].css&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> CssMinimizerWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cssMinimizerWebpackPlugin = <span class="keyword">new</span> CssMinimizerWebpackPlugin();</span><br><span class="line"><span class="keyword">const</span> TerserWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> terserWebpackPlugin = <span class="keyword">new</span> TerserWebpackPlugin(&#123;</span><br><span class="line">    <span class="attr">extractComments</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">    <span class="attr">mode</span>:<span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">    <span class="attr">entry</span>:<span class="string">&#x27;./src/index.js&#x27;</span>,</span><br><span class="line">    <span class="attr">output</span>:&#123;</span><br><span class="line">        <span class="attr">filename</span>:<span class="string">&#x27;js/[name].[contenthash:8].js&#x27;</span>,</span><br><span class="line">        <span class="attr">path</span>:resolve(__dirname,<span class="string">&#x27;dist&#x27;</span>),</span><br><span class="line">        <span class="attr">publicPath</span>:<span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">        <span class="attr">clean</span>:<span class="literal">true</span>,</span><br><span class="line">        <span class="attr">assetModuleFilename</span>:<span class="string">&#x27;asset/[contenthash].[ext]&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">module</span>:&#123;</span><br><span class="line">      <span class="attr">rules</span>:[...]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">plugins</span>:[</span><br><span class="line">        htmlPlugin,</span><br><span class="line">        miniCssExtractPlugin</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">resolve</span>:&#123;</span><br><span class="line">        <span class="attr">alias</span>:&#123;</span><br><span class="line">            <span class="string">&quot;@&quot;</span>: resolve(__dirname, <span class="string">&quot;src&quot;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">optimization</span>:&#123;</span><br><span class="line">        <span class="attr">splitChunks</span>:&#123;</span><br><span class="line">            <span class="attr">cacheGroups</span>:&#123;</span><br><span class="line">                <span class="attr">test</span>:<span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">                name:<span class="string">&#x27;vendors&#x27;</span>,</span><br><span class="line">                <span class="attr">chunks</span>:<span class="string">&#x27;all&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">minimizer</span>:[</span><br><span class="line">            cssMinimizerWebpackPlugin,</span><br><span class="line">            terserWebpackPlugin</span><br><span class="line">        ]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">performance</span>:&#123;</span><br><span class="line">        <span class="attr">hits</span>:<span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 指定配置文件</span></span><br><span class="line">npx webpack --config webpack.config.prod.js</span><br></pre></td></tr></table></div></figure>

<br>


        <h2 id="4-npm-脚本">
          <a href="#4-npm-脚本" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-npm-脚本" class="headerlink" title="4.npm 脚本"></a>4.npm 脚本</h2>
      <figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;server&quot;</span>: <span class="string">&quot;npx webpakc serve --config webpack.config.dev.js&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;build&quot;</span>: <span class="string">&quot;npx webpack --config webpack.config.prod.js&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 通过npm脚本运行</span></span><br><span class="line">npm run serve</span><br><span class="line">npm run build</span><br></pre></td></tr></table></div></figure>

<br>


        <h2 id="5-提取配置内公共代码">
          <a href="#5-提取配置内公共代码" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-提取配置内公共代码" class="headerlink" title="5.提取配置内公共代码"></a>5.提取配置内公共代码</h2>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 公共环境配置webpack.config.common.js</span></span><br><span class="line"><span class="keyword">const</span> &#123; resolve &#125; = <span class="built_in">require</span>(<span class="string">&quot;path&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> HtmlPlugin = <span class="built_in">require</span>(<span class="string">&quot;html-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> htmlPlugin = <span class="keyword">new</span> HtmlPlugin(&#123;</span><br><span class="line">  <span class="attr">template</span>: <span class="string">&quot;./src/index.html&quot;</span>,</span><br><span class="line">  <span class="attr">filename</span>: <span class="string">&quot;index.html&quot;</span>,</span><br><span class="line">  <span class="attr">inject</span>: <span class="string">&quot;body&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">const</span> MiniCssExtractPlugin = <span class="built_in">require</span>(<span class="string">&quot;mini-css-extract-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> miniCssExtractPlugin = <span class="keyword">new</span> MiniCssExtractPlugin(&#123;</span><br><span class="line">  <span class="attr">filename</span>: <span class="string">&quot;css/[name].[contenthash:8].css&quot;</span>,</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">entry</span>: <span class="string">&quot;./src/index.js&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">path</span>: resolve(__dirname, <span class="string">&quot;dist&quot;</span>),</span><br><span class="line">    <span class="attr">clean</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">assetModuleFilename</span>: <span class="string">&quot;asset/[contenthash].[ext]&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">module</span>: &#123;</span><br><span class="line">    <span class="attr">rules</span>: [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/\.js$/</span>,</span><br><span class="line">        loader: <span class="string">&quot;babel-loader&quot;</span>,</span><br><span class="line">        <span class="attr">exclude</span>: <span class="regexp">/node_modules/</span>,</span><br><span class="line">        options: &#123;</span><br><span class="line">          <span class="attr">presets</span>: [<span class="string">&quot;@babel/preset-env&quot;</span>],</span><br><span class="line">          <span class="attr">cacheDirectory</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">oneOf</span>: [</span><br><span class="line">          &#123; <span class="attr">test</span>: <span class="regexp">/\.html$/</span>, loader: <span class="string">&quot;html-loader&quot;</span> &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(png|svg)$/</span>,</span><br><span class="line">            type: <span class="string">&quot;asset&quot;</span>,</span><br><span class="line">            <span class="attr">generator</span>: &#123; <span class="attr">filename</span>: <span class="string">&quot;img/[name].[contenthash:8].[ext]&quot;</span> &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.(ttf|woff)$/</span>,</span><br><span class="line">            type: <span class="string">&quot;asset/resource&quot;</span>,</span><br><span class="line">            <span class="attr">generator</span>: &#123; <span class="attr">filename</span>: <span class="string">&quot;fonts/[name].[contenthash:8].[ext]&quot;</span> &#125;,</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">test</span>: <span class="regexp">/\.s?css$/</span>,</span><br><span class="line">            use: [MiniCssExtractPlugin.loader, <span class="string">&quot;css-loader&quot;</span>, <span class="string">&quot;sass-loader&quot;</span>],</span><br><span class="line">          &#125;,</span><br><span class="line">        ],</span><br><span class="line">      &#125;,</span><br><span class="line">    ],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [htmlPlugin, miniCssExtractPlugin],</span><br><span class="line">  <span class="attr">resolve</span>: &#123;</span><br><span class="line">    <span class="attr">alias</span>: &#123;</span><br><span class="line">      <span class="string">&quot;@&quot;</span>: resolve(__dirname, <span class="string">&quot;src&quot;</span>),</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">splitChunks</span>: &#123;</span><br><span class="line">      <span class="attr">cacheGroups</span>: &#123;</span><br><span class="line">        <span class="attr">test</span>: <span class="regexp">/[\\/]node_modules[\\/]/</span>,</span><br><span class="line">        name: <span class="string">&quot;vendors&quot;</span>,</span><br><span class="line">        <span class="attr">chunks</span>: <span class="string">&quot;all&quot;</span>,</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开发环境配置webpack.config.dev.js</span></span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;development&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;js/[name].js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">devtool</span>: <span class="string">&quot;eval-cheap-module-source-map&quot;</span>,</span><br><span class="line">  <span class="attr">devServer</span>: &#123;</span><br><span class="line">    <span class="attr">static</span>: <span class="string">&quot;./dist&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 生产环境配置webpack.config.prod.js</span></span><br><span class="line"><span class="keyword">const</span> CssMinimizerWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;css-minimizer-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cssMinimizerWebpackPlugin = <span class="keyword">new</span> CssMinimizerWebpackPlugin();</span><br><span class="line"><span class="keyword">const</span> TerserWebpackPlugin = <span class="built_in">require</span>(<span class="string">&quot;terser-webpack-plugin&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> terserWebpackPlugin = <span class="keyword">new</span> TerserWebpackPlugin(&#123;</span><br><span class="line">  <span class="attr">extractComments</span>: <span class="literal">false</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  <span class="attr">mode</span>: <span class="string">&quot;production&quot;</span>,</span><br><span class="line">  <span class="attr">output</span>: &#123;</span><br><span class="line">    <span class="attr">filename</span>: <span class="string">&quot;js/[name].[contenthash:8].js&quot;</span>,</span><br><span class="line">    <span class="attr">publicPath</span>: <span class="string">&quot;/&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">optimization</span>: &#123;</span><br><span class="line">    <span class="attr">minimizer</span>: [cssMinimizerWebpackPlugin, terserWebpackPlugin],</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">performance</span>: &#123;</span><br><span class="line">    <span class="attr">hits</span>: <span class="literal">false</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装webpack-merge包</span></span><br><span class="line">npm install webpack-merge -D</span><br></pre></td></tr></table></div></figure>

<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// webpack.config.js</span></span><br><span class="line"><span class="keyword">const</span> &#123;merge&#125; = <span class="built_in">require</span>(<span class="string">&#x27;webpack-merge&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> commonConfig = reuqire(<span class="string">&#x27;./webpack.config.common&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> productionConfig = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.config.prod&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> developmentConfig = <span class="built_in">require</span>(<span class="string">&#x27;./webpack.config.dev&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">env</span>) =&gt;</span>&#123;</span><br><span class="line">    <span class="function"><span class="title">swicth</span>(<span class="params"><span class="literal">true</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">case</span> env.development:</span><br><span class="line">            <span class="keyword">return</span> merge(commonConfig,developmentConfig)</span><br><span class="line">        <span class="keyword">case</span> env.production:</span><br><span class="line">            <span class="keyword">return</span> merge(commonConfig,productionConfig)</span><br><span class="line">        <span class="attr">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&#x27;No matching configuration was found&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<figure class="highlight json"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// package.json修改npm脚本</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;server&quot;</span>: <span class="string">&quot;npx webpakc serve --config webpack.config.js --env development&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;build&quot;</span>: <span class="string">&quot;npx webpack --config webpack.config.js --env production&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<br>


        <h1 id="七-vue-cli-构建打包配置分析">
          <a href="#七-vue-cli-构建打包配置分析" class="heading-link"><i class="fas fa-link"></i></a><a href="#七-vue-cli-构建打包配置分析" class="headerlink" title="七.vue-cli 构建打包配置分析"></a>七.vue-cli 构建打包配置分析</h1>
      <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将vue开发环境的webpack配置输出</span></span><br><span class="line">npx vue-cli-service inspect --mode=development &gt; webpack.dev.js</span><br><span class="line"><span class="meta">#</span><span class="bash"> 将vue生产环境的webpack配置输出</span></span><br><span class="line">npx vue-cli-service inspect --mode=production &gt; webpack.prod.js</span><br></pre></td></tr></table></div></figure>

<br>

<blockquote>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1YU4y1g745">https://www.bilibili.com/video/BV1YU4y1g745</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
<p><span class="exturl"><a class="exturl__link" target="_blank" rel="noopener" href="https://www.bilibili.com/video/av90152963">https://www.bilibili.com/video/av90152963</a><span class="exturl__icon"><i class="fas fa-external-link-alt"></i></span></span></p>
</blockquote>
</div></div></article><article class="postlist-item post"><header class="post-header"><h1 class="post-title"><a class="post-title__link" href="/2022/01/24/axios/">axios</a></h1><div class="post-meta"><span class="post-meta-item post-meta-item--createtime"><span class="post-meta-item__icon"><i class="far fa-calendar-plus"></i></span><span class="post-meta-item__info">发表于</span><span class="post-meta-item__value">2022-01-24</span></span><span class="post-meta-item post-meta-item--updatetime"><span class="post-meta-item__icon"><i class="far fa-calendar-check"></i></span><span class="post-meta-item__info">更新于</span><span class="post-meta-item__value">2022-03-03</span></span></div></header><div class="post-body"><div class="post-excerpt">
        <h1 id="1-使用方法">
          <a href="#1-使用方法" class="heading-link"><i class="fas fa-link"></i></a><a href="#1-使用方法" class="headerlink" title="1.使用方法"></a>1.使用方法</h1>
      <figure class="highlight shell"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装axios</span></span><br><span class="line">npm i axios -S</span><br></pre></td></tr></table></div></figure>

<figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 基本使用 axios(config)</span></span><br><span class="line">axios(&#123;</span><br><span class="line">    <span class="attr">method</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">url</span>:<span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="attr">data</span>:&#123;&#125;</span><br><span class="line">&#125;).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;).catche(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// 其他方式</span></span><br><span class="line">axios.request(config)</span><br><span class="line">axios.get(url[, config])</span><br><span class="line">axios.post(url[, data[, config]])</span><br></pre></td></tr></table></div></figure>

<br>


        <h1 id="2-axios-请求响应结果">
          <a href="#2-axios-请求响应结果" class="heading-link"><i class="fas fa-link"></i></a><a href="#2-axios-请求响应结果" class="headerlink" title="2.axios 请求响应结果"></a>2.axios 请求响应结果</h1>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">config</span>:,		<span class="comment">// 请求配置</span></span><br><span class="line">    data:,			<span class="comment">// 响应体</span></span><br><span class="line">    headers:,		<span class="comment">// 响应头</span></span><br><span class="line">    request:,		<span class="comment">// 原生AJAX请求对象</span></span><br><span class="line">    status:,		<span class="comment">// 响应状态码</span></span><br><span class="line">    statusText:<span class="string">&#x27;&#x27;</span>	<span class="comment">// 响应状态字符串</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<br>


        <h1 id="3-axios-配置对象">
          <a href="#3-axios-配置对象" class="heading-link"><i class="fas fa-link"></i></a><a href="#3-axios-配置对象" class="headerlink" title="3.axios 配置对象"></a>3.axios 配置对象</h1>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  	<span class="comment">// `url` 是用于请求的服务器 URL</span></span><br><span class="line">	<span class="attr">url</span>: <span class="string">&quot;/user&quot;</span>,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `method` 是创建请求时使用的方法</span></span><br><span class="line">	<span class="attr">method</span>: <span class="string">&quot;get&quot;</span>, <span class="comment">// 默认是 get</span></span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `baseURL` 将自动加在 `url` 前面，除非 `url` 是一个绝对 URL。</span></span><br><span class="line">  	<span class="comment">// 它可以通过设置一个 `baseURL` 便于为 axios 实例的方法传递相对 URL</span></span><br><span class="line">  	<span class="attr">baseURL</span>: <span class="string">&quot;https://some-domain.com/api/&quot;</span>,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `transformRequest` 允许在向服务器发送前，修改请求数据</span></span><br><span class="line">  	<span class="comment">// 只能用在 &quot;PUT&quot;, &quot;POST&quot; 和 &quot;PATCH&quot; 这几个请求方法</span></span><br><span class="line">  	<span class="comment">// 后面数组中的函数必须返回一个字符串，或 ArrayBuffer，或 Stream</span></span><br><span class="line">  	<span class="attr">transformRequest</span>: [<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    	<span class="comment">// 对 data 进行任意转换处理</span></span><br><span class="line">    	<span class="keyword">return</span> data;</span><br><span class="line"> 	&#125;],</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `transformResponse` 在传递给 then/catch 前，允许修改响应数据</span></span><br><span class="line">  	<span class="attr">transformResponse</span>: [<span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    	<span class="comment">// 对 data 进行任意转换处理</span></span><br><span class="line">    	<span class="keyword">return</span> data;</span><br><span class="line">  	&#125;],</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `headers` 是即将被发送的自定义请求头</span></span><br><span class="line">  	<span class="attr">headers</span>: &#123;<span class="string">&quot;X-Requested-With&quot;</span>: <span class="string">&quot;XMLHttpRequest&quot;</span>&#125;,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `params` 是即将与请求一起发送的 URL 参数</span></span><br><span class="line">  	<span class="comment">// 必须是一个无格式对象(plain object)或 URLSearchParams 对象</span></span><br><span class="line">  	<span class="attr">params</span>: &#123;</span><br><span class="line">    	<span class="attr">ID</span>: <span class="number">12345</span></span><br><span class="line">  	&#125;,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `paramsSerializer` 是一个负责 `params` 序列化的函数</span></span><br><span class="line">  	<span class="attr">paramsSerializer</span>: <span class="function"><span class="keyword">function</span>(<span class="params">params</span>) </span>&#123;</span><br><span class="line">    	<span class="keyword">return</span> Qs.stringify(params, &#123;<span class="attr">arrayFormat</span>: <span class="string">&quot;brackets&quot;</span>&#125;)</span><br><span class="line">  	&#125;,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `data` 是作为请求主体被发送的数据</span></span><br><span class="line">  	<span class="comment">// 只适用于这些请求方法 &quot;PUT&quot;, &quot;POST&quot;, 和 &quot;PATCH&quot;</span></span><br><span class="line">  	<span class="comment">// 在没有设置 `transformRequest` 时，必须是以下类型之一：</span></span><br><span class="line">  	<span class="comment">// - string, plain object, ArrayBuffer, ArrayBufferView, URLSearchParams</span></span><br><span class="line">  	<span class="comment">// - 浏览器专属：FormData, File, Blob</span></span><br><span class="line">  	<span class="comment">// - Node 专属： Stream</span></span><br><span class="line">  	<span class="attr">data</span>: &#123;</span><br><span class="line">    	<span class="attr">firstName</span>: <span class="string">&quot;Fred&quot;</span></span><br><span class="line">  	&#125;,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `timeout` 指定请求超时的毫秒数(0 表示无超时时间)</span></span><br><span class="line">  	<span class="comment">// 如果请求话费了超过 `timeout` 的时间，请求将被中断</span></span><br><span class="line">  	<span class="attr">timeout</span>: <span class="number">1000</span>,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `withCredentials` 表示跨域请求时是否需要使用凭证</span></span><br><span class="line">  	<span class="attr">withCredentials</span>: <span class="literal">false</span>, <span class="comment">// 默认</span></span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `adapter` 允许自定义处理请求，以使测试更轻松</span></span><br><span class="line">  	<span class="comment">// 返回一个 promise 并应用一个有效的响应 (查阅 [response docs](#response-api)).</span></span><br><span class="line">  	<span class="attr">adapter</span>: <span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;&#125;,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `auth` 表示应该使用 HTTP 基础验证，并提供凭据</span></span><br><span class="line">  	<span class="comment">// 这将设置一个 `Authorization` 头，覆写掉现有的任意使用 `headers` 设置的自定义`Authorization`头</span></span><br><span class="line">  	<span class="attr">auth</span>: &#123;</span><br><span class="line">    	<span class="attr">username</span>: <span class="string">&quot;janedoe&quot;</span>,</span><br><span class="line">    	<span class="attr">password</span>: <span class="string">&quot;s00pers3cret&quot;</span></span><br><span class="line">  	&#125;,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `responseType` 表示服务器响应的数据类型，可以是&quot;arraybuffer&quot;,&quot;blob&quot;,&quot;document&quot;,&quot;json&quot;,&quot;text&quot;,&quot;stream&quot;</span></span><br><span class="line">  	<span class="attr">responseType</span>: <span class="string">&quot;json&quot;</span>, <span class="comment">// 默认</span></span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `responseEncoding` 表示用于解码响应的编码</span></span><br><span class="line">  	<span class="attr">responseEncoding</span>:<span class="string">&#x27;utf8&#x27;</span>,	<span class="comment">// 默认</span></span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `xsrfCookieName` 是用作 xsrf token 的值的cookie的名称</span></span><br><span class="line">  	<span class="attr">xsrfCookieName</span>: <span class="string">&quot;XSRF-TOKEN&quot;</span>, <span class="comment">// 默认</span></span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `xsrfHeaderName` 是承载 xsrf token 的值的 HTTP 头的名称</span></span><br><span class="line">  	<span class="attr">xsrfHeaderName</span>: <span class="string">&quot;X-XSRF-TOKEN&quot;</span>, <span class="comment">// 默认</span></span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `onUploadProgress` 允许为上传处理进度事件</span></span><br><span class="line">  	<span class="attr">onUploadProgress</span>: <span class="function"><span class="keyword">function</span> (<span class="params">progressEvent</span>) </span>&#123;</span><br><span class="line">    	<span class="comment">// 对原生进度事件的处理</span></span><br><span class="line">  	&#125;,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `onDownloadProgress` 允许为下载处理进度事件</span></span><br><span class="line">  	<span class="attr">onDownloadProgress</span>: <span class="function"><span class="keyword">function</span> (<span class="params">progressEvent</span>) </span>&#123;</span><br><span class="line">    	<span class="comment">// 对原生进度事件的处理</span></span><br><span class="line">  	&#125;,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `maxContentLength` 定义允许的响应内容的最大尺寸</span></span><br><span class="line">  	<span class="attr">maxContentLength</span>: <span class="number">2000</span>,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `validateStatus` 定义对于给定的HTTP 响应状态码是 resolve 或 reject  promise</span></span><br><span class="line">  	<span class="comment">// 如果 `validateStatus` 返回 `true` (或者设置为 `null`或 `undefined`)，promise 将被 resolve; 否则，promise 将被 rejecte</span></span><br><span class="line">  	<span class="attr">validateStatus</span>: <span class="function"><span class="keyword">function</span> (<span class="params">status</span>) </span>&#123;</span><br><span class="line">    	<span class="keyword">return</span> status &gt;= <span class="number">200</span> &amp;&amp; status &lt; <span class="number">300</span>; <span class="comment">// 默认</span></span><br><span class="line">  	&#125;,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `maxRedirects` 定义在 node.js 中 follow 的最大重定向数目</span></span><br><span class="line">  	<span class="comment">// 如果设置为0，将不会 follow 任何重定向</span></span><br><span class="line">  	<span class="attr">maxRedirects</span>: <span class="number">5</span>, <span class="comment">// 默认</span></span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `httpAgent` 和 `httpsAgent` 分别在 node.js 中用于定义在执行 http 和 https 时使用的自定义代理。允许像这样配置选项：</span></span><br><span class="line">  	<span class="comment">// `keepAlive` 默认没有启用</span></span><br><span class="line">  	<span class="attr">httpAgent</span>: <span class="keyword">new</span> http.Agent(&#123; <span class="attr">keepAlive</span>: <span class="literal">true</span> &#125;),</span><br><span class="line">  	<span class="attr">httpsAgent</span>: <span class="keyword">new</span> https.Agent(&#123; <span class="attr">keepAlive</span>: <span class="literal">true</span> &#125;),</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// &quot;proxy&quot; 定义代理服务器的主机名称和端口</span></span><br><span class="line">  	<span class="comment">// `auth` 表示 HTTP 基础验证应当用于连接代理，并提供凭据</span></span><br><span class="line">  	<span class="comment">// 这将会设置一个 `Proxy-Authorization` 头，覆写掉已有的通过使用 `header` 设置的自定义 `Proxy-Authorization` 头。</span></span><br><span class="line">  	<span class="attr">proxy</span>: &#123;</span><br><span class="line">    	<span class="attr">host</span>: <span class="string">&quot;127.0.0.1&quot;</span>,</span><br><span class="line">    	<span class="attr">port</span>: <span class="number">9000</span>,</span><br><span class="line">    	<span class="attr">auth</span>: : &#123;</span><br><span class="line">      		<span class="attr">username</span>: <span class="string">&quot;mikeymike&quot;</span>,</span><br><span class="line">      		<span class="attr">password</span>: <span class="string">&quot;rapunz3l&quot;</span></span><br><span class="line">    	&#125;</span><br><span class="line">  	&#125;,</span><br><span class="line"></span><br><span class="line">  	<span class="comment">// `cancelToken` 指定用于取消请求的 cancel token</span></span><br><span class="line">  	<span class="attr">cancelToken</span>: <span class="keyword">new</span> CancelToken(<span class="function"><span class="keyword">function</span> (<span class="params">cancel</span>) </span>&#123;&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></div></figure>

<br>


        <h1 id="4-axios-修改默认配置">
          <a href="#4-axios-修改默认配置" class="heading-link"><i class="fas fa-link"></i></a><a href="#4-axios-修改默认配置" class="headerlink" title="4.axios 修改默认配置"></a>4.axios 修改默认配置</h1>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">axios.defaults.method = <span class="string">&#x27;GET&#x27;</span>	<span class="comment">// 设置默认请求类型</span></span><br><span class="line">axios.defaults.baseURIL = <span class="string">&#x27;&#x27;</span>	<span class="comment">// 设置基础URL</span></span><br><span class="line">axios.defaults.timeout = <span class="number">3000</span>	<span class="comment">// 设置默认超时时间</span></span><br><span class="line">...</span><br></pre></td></tr></table></div></figure>

<br>


        <h1 id="5-axios-创建实例对象发送请求">
          <a href="#5-axios-创建实例对象发送请求" class="heading-link"><i class="fas fa-link"></i></a><a href="#5-axios-创建实例对象发送请求" class="headerlink" title="5.axios 创建实例对象发送请求"></a>5.axios 创建实例对象发送请求</h1>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 创建实例对象</span></span><br><span class="line"><span class="keyword">const</span> temp = axios.create(&#123;</span><br><span class="line">  <span class="attr">baseURL</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">timeout</span>: <span class="number">2000</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// 这里的temp和axios对象几近是一样的</span></span><br><span class="line">temp(&#123;</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;&#125;);</span><br><span class="line"><span class="comment">// 作用：对于不同的请求接口，需要传的请求头不同或者请求域名不同，此时需要一个新的axios实例进行请求</span></span><br></pre></td></tr></table></div></figure>

<br>


        <h1 id="6-拦截器">
          <a href="#6-拦截器" class="heading-link"><i class="fas fa-link"></i></a><a href="#6-拦截器" class="headerlink" title="6.拦截器"></a>6.拦截器</h1>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 请求拦截器</span></span><br><span class="line"><span class="comment">// 作用：在发送请求前对发送的数据内容进行检测</span></span><br><span class="line">axios.interceptors.request.use(</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">config</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> config;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 响应拦截器</span></span><br><span class="line"><span class="comment">// 作用：当服务器返回结果后，在处理结果之前对结果进行预处理</span></span><br><span class="line">axios.interceptors.response.use(</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">response</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> response;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">Promise</span>.reject(error);</span><br><span class="line">  &#125;</span><br><span class="line">);</span><br></pre></td></tr></table></div></figure>

<br>


        <h1 id="7-取消请求">
          <a href="#7-取消请求" class="heading-link"><i class="fas fa-link"></i></a><a href="#7-取消请求" class="headerlink" title="7.取消请求"></a>7.取消请求</h1>
      <figure class="highlight javascript"><div class="table-container"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 2.声明全局变量</span></span><br><span class="line"><span class="keyword">let</span> cancel = <span class="literal">null</span>;</span><br><span class="line">axios(&#123;</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&quot;GET&quot;</span>,</span><br><span class="line">  <span class="attr">url</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="comment">// 1.添加配置对象对象的属性</span></span><br><span class="line">  <span class="attr">cancelToken</span>: <span class="keyword">new</span> axios.CancelToken(<span class="function"><span class="keyword">function</span> (<span class="params">c</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 3.将 c 的值赋值给cancel</span></span><br><span class="line">    cancel = c;</span><br><span class="line">  &#125;),</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">response</span>) =&gt;</span> &#123;&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4.取消请求</span></span><br><span class="line">cancel();</span><br></pre></td></tr></table></div></figure>
</div></div></article></section><nav class="paginator"><div class="paginator-inner"><a class="extend prev" rel="prev" href="/"><i class="fas fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span></div></nav></div></div><div class="sidebar-wrap" id="sidebar-wrap"><aside class="sidebar" id="sidebar"><section class="sidebar-toc hide"></section><!-- ov = overview--><section class="sidebar-ov"><div class="sidebar-ov-author"><div class="sidebar-ov-author__avatar"><img class="sidebar-ov-author__avatar_img" src="/image/site/head.png" alt="avatar"></div><p class="sidebar-ov-author__text">hello world</p></div><div class="sidebar-ov-social"><a class="sidebar-ov-social-item" href="https://github.com/LonelyTaker" target="_blank" rel="noopener" data-popover="Github" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-github"></i></span></a><a class="sidebar-ov-social-item" href="Ym1104340863" target="_blank" rel="noopener" data-popover="微信" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-weixin"></i></span></a><a class="sidebar-ov-social-item" href="1104340863" target="_blank" rel="noopener" data-popover="QQ" data-popover-pos="up"><span class="sidebar-ov-social-item__icon"><i class="fab fa-qq"></i></span></a></div><div class="sidebar-ov-state"><a class="sidebar-ov-state-item sidebar-ov-state-item--posts" href="/archives/"><div class="sidebar-ov-state-item__count">14</div><div class="sidebar-ov-state-item__name">归档</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--categories" href="/categories/"><div class="sidebar-ov-state-item__count">4</div><div class="sidebar-ov-state-item__name">分类</div></a><a class="sidebar-ov-state-item sidebar-ov-state-item--tags" href="/tags/"><div class="sidebar-ov-state-item__count">4</div><div class="sidebar-ov-state-item__name">标签</div></a></div><div class="sidebar-ov-cc"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.en" target="_blank" rel="noopener" data-popover="知识共享许可协议" data-popover-pos="up"><img src="/images/cc-by-nc-sa.svg"></a></div></section></aside></div><div class="clearfix"></div></div></main><footer class="footer" id="footer"><div class="footer-inner"><div><span>Copyright © 2022</span><span class="footer__icon"><i class="fas fa-heart"></i></span><span>LonelyTaker</span></div><div><span>由 <a href="http://hexo.io/" title="Hexo" target="_blank" rel="noopener">Hexo</a> 强力驱动</span><span> v6.0.0</span></div></div></footer><div class="loading-bar" id="loading-bar"><div class="loading-bar__progress"></div></div><div class="back2top" id="back2top"><span class="back2top__icon"><i class="fas fa-rocket"></i></span></div></div><script src="https://cdn.jsdelivr.net/npm/jquery@v3.4.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@1.5.2/velocity.ui.min.js"></script><script src="/js/utils.js?v=2.6.2"></script><script src="/js/stun-boot.js?v=2.6.2"></script><script src="/js/scroll.js?v=2.6.2"></script><script src="/js/header.js?v=2.6.2"></script><script src="/js/sidebar.js?v=2.6.2"></script></body></html>